# âœ… ç”˜ç‰¹å›¾å·¥æœŸæ—¥æœŸä¿®å¤

## é—®é¢˜åˆ†æ

ç”¨æˆ·åé¦ˆï¼š**"ç”˜ç‰¹å›¾çš„å·¥æœŸå’Œæ—¥æœŸå¯¹ä¸èµ·æ¥"**

è®©æˆ‘åˆ†æDHTMLX Ganttçš„durationè®¡ç®—é€»è¾‘ï¼š

### DHTMLX Ganttçš„å·¥æœŸè®¡ç®—è§„åˆ™

```javascript
// DHTMLX Ganttçš„è®¡ç®—æ–¹å¼
start_date + duration = end_date

// ç¤ºä¾‹1ï¼šé¡¹ç›®å¯åŠ¨
start_date: 2025-01-01
duration: 5
end_date: 2025-01-06 (01-01 + 5å¤© = 01-06)

// ç¤ºä¾‹2ï¼šéœ€æ±‚åˆ†æ  
start_date: 2025-01-06
duration: 10
end_date: 2025-01-16 (01-06 + 10å¤© = 01-16)
```

### å…³é”®æ¦‚å¿µ

**Durationçš„å«ä¹‰**ï¼š
- duration = 5 è¡¨ç¤ºä»å¼€å§‹æ—¥æœŸ**ç»è¿‡5å¤©**
- **ä¸åŒ…å«**å¼€å§‹æ—¥æœŸå½“å¤©
- 1æœˆ1æ—¥å¼€å§‹ï¼Œduration=5 â†’ ç»“æŸæ—¥æœŸæ˜¯1æœˆ6æ—¥

---

## å¯èƒ½çš„é—®é¢˜åœºæ™¯

### åœºæ™¯1ï¼šDurationæ˜¾ç¤ºä¸å®é™…ä¸ç¬¦

```
æ˜¾ç¤ºï¼šé¡¹ç›®å¯åŠ¨ 5å¤©
å¼€å§‹ï¼š2025-01-01
ç»“æŸï¼š2025-01-05 âŒ é”™è¯¯ï¼ˆå®é™…åº”è¯¥æ˜¯01-06ï¼‰
```

### åœºæ™¯2ï¼šæ—¥æœŸè®¡ç®—é”™è¯¯

```
åç«¯æ•°æ®ï¼š
start_date: 2025-01-01
end_date: 2025-01-10

å‰ç«¯è®¡ç®—durationï¼š
duration = end - start = 10å¤© âŒ é”™è¯¯
æ­£ç¡®åº”è¯¥æ˜¯: duration = 10 - 1 = 9å¤©
```

### åœºæ™¯3ï¼šåŒ…å«/ä¸åŒ…å«ç»“æŸæ—¥æœŸçš„æ··æ·†

```
ç†è§£1ï¼ˆåŒ…å«æ³•ï¼‰ï¼š1æœˆ1æ—¥~1æœˆ10æ—¥ = 10å¤©
ç†è§£2ï¼ˆå·®å€¼æ³•ï¼‰ï¼š1æœˆ10æ—¥ - 1æœˆ1æ—¥ = 9å¤© âœ… DHTMLXç”¨è¿™ä¸ª

DHTMLX Ganttä½¿ç”¨"å·®å€¼æ³•"
```

---

## è¯Šæ–­å½“å‰ä»£ç 

### å½“å‰è®¡ç®—é€»è¾‘

```typescript
// ä»åç«¯åŠ è½½æ—¶çš„è®¡ç®—ï¼ˆç¬¬860è¡Œï¼‰
const startDate = dayjs(task.start_date);
const endDate = dayjs(task.end_date);
const durationDays = endDate.diff(startDate, 'day'); 
// âœ… è¿™ä¸ªæ˜¯å¯¹çš„ï¼šdiffè®¡ç®—çš„å°±æ˜¯å¤©æ•°å·®

// ç¤ºä¾‹ï¼š
// start: 2025-01-01, end: 2025-01-06
// diff = 6 - 1 = 5å¤© âœ… æ­£ç¡®
```

### æ¼”ç¤ºæ•°æ®ï¼ˆç¬¬755è¡Œï¼‰

```typescript
{ 
  text: 'é¡¹ç›®å¯åŠ¨', 
  start_date: '2025-01-01', 
  duration: 5,  // ç›´æ¥å†™æ­»çš„duration
  // æ¨ç®—ï¼šend_date = 2025-01-01 + 5å¤© = 2025-01-06 âœ…
}
```

---

## é—®é¢˜æ ¹æºåˆ†æ

åŸºäºä»£ç å®¡æŸ¥ï¼Œå¯èƒ½çš„é—®é¢˜ï¼š

### 1. **ç”¨æˆ·ç¼–è¾‘ä»»åŠ¡åçš„durationè®¡ç®—**

å½“ç”¨æˆ·æ‹–æ‹½ä»»åŠ¡æ¡ä¿®æ”¹æ—¥æœŸæ—¶ï¼ŒDHTMLXä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—durationï¼Œä½†å¦‚æœï¼š
- æ²¡æœ‰æ­£ç¡®é…ç½®`work_time`
- è®¡ç®—å·¥ä½œæ—¥vsæ—¥å†æ—¥çš„å·®å¼‚

### 2. **å­—ç¬¦ä¸²æ—¥æœŸ vs Dateå¯¹è±¡**

```typescript
// å¯èƒ½çš„é—®é¢˜
start_date: '2025-01-01'  // å­—ç¬¦ä¸²
start_date: new Date('2025-01-01')  // Dateå¯¹è±¡

// æ—¶åŒºé—®é¢˜
new Date('2025-01-01') 
// å¯èƒ½è¢«è§£æä¸ºï¼š2024-12-31 16:00:00 (UTC-8)
```

### 3. **Gantté…ç½®é—®é¢˜**

```typescript
// å½“å‰é…ç½®ï¼ˆç¬¬213-217è¡Œï¼‰
gantt.config.work_time = false;  // âœ… æ­£ç¡®ï¼šä½¿ç”¨æ—¥å†å¤©æ•°
gantt.config.skip_off_time = false;  // âœ… æ­£ç¡®ï¼šä¸è·³è¿‡å‘¨æœ«
gantt.config.duration_unit = 'day';  // âœ… æ­£ç¡®
gantt.config.duration_step = 1;  // âœ… æ­£ç¡®
```

é…ç½®çœ‹èµ·æ¥æ˜¯æ­£ç¡®çš„ã€‚

---

## ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šç»Ÿä¸€æ—¥æœŸæ ¼å¼

```typescript
// ğŸ”§ ä¿®å¤ï¼šç¡®ä¿æ‰€æœ‰æ—¥æœŸéƒ½æ˜¯Dateå¯¹è±¡ï¼Œä¸”æ— æ—¶åŒºé—®é¢˜
const parseDate = (dateStr: string): Date => {
  // ä½¿ç”¨dayjsè§£æå¹¶è½¬ä¸ºDateï¼Œé¿å…æ—¶åŒºé—®é¢˜
  return dayjs(dateStr).toDate();
};

// åº”ç”¨åˆ°æ‰€æœ‰ä»»åŠ¡
task.start_date = parseDate(task.start_date);
```

### æ–¹æ¡ˆ2ï¼šæ·»åŠ æ—¥æœŸéªŒè¯æ—¥å¿—

```typescript
// ğŸ” è°ƒè¯•ï¼šæ‰“å°æ—¥æœŸè®¡ç®—è¿‡ç¨‹
console.log('[Gantt Debug] ä»»åŠ¡æ—¥æœŸ:', {
  name: task.text,
  start: dayjs(task.start_date).format('YYYY-MM-DD'),
  duration: task.duration,
  calculated_end: dayjs(task.start_date).add(task.duration, 'day').format('YYYY-MM-DD'),
  gantt_end: window.gantt.calculateEndDate(task.start_date, task.duration)
});
```

### æ–¹æ¡ˆ3ï¼šä¿®å¤ä¿å­˜æ—¶çš„durationè®¡ç®—

```typescript
// ä¿å­˜ä»»åŠ¡æ—¶ï¼ˆç¬¬1080-1095è¡Œï¼‰
const taskData = {
  name: task.text,
  start_date: dayjs(task.start_date).format('YYYY-MM-DD'),
  end_date: dayjs(task.end_date).format('YYYY-MM-DD'), 
  // âš ï¸ è¿™é‡Œå¯èƒ½æœ‰é—®é¢˜ï¼štask.end_dateå¯èƒ½æœªå®šä¹‰
  
  // ğŸ”§ ä¿®å¤ï¼šç¡®ä¿end_dateæ­£ç¡®è®¡ç®—
  end_date: task.end_date 
    ? dayjs(task.end_date).format('YYYY-MM-DD')
    : dayjs(task.start_date).add(task.duration, 'day').format('YYYY-MM-DD'),
  
  progress: Math.round((task.progress || 0) * 100),
  // ...
};
```

---

## ç«‹å³ä¿®å¤

è®©æˆ‘å®æ–½è¿™äº›ä¿®å¤ï¼š

1. âœ… æ·»åŠ æ—¥æœŸè§£æè¾…åŠ©å‡½æ•°
2. âœ… ä¿®å¤ä¿å­˜æ—¶çš„end_dateè®¡ç®—
3. âœ… æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
4. âœ… ç¡®ä¿durationè®¡ç®—ä¸€è‡´æ€§

---

**å¼€å§‹ä¿®å¤...**


