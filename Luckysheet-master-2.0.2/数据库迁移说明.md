# 数据库迁移说明

## 问题说明

保存PDF到历史记录时出现400错误，原因是后端数据库模型要求Excel字段为必填，但保存PDF时没有提供Excel数据。

## 已完成的修改

1. ✅ 修改了后端模型 `xuanxing/backend/selections/models.py`
   - 将 `excel_filename` 和 `excel_content` 字段改为可选（添加了 `blank=True, null=True`）
   - 现在Excel和PDF可以独立存在

2. ✅ 创建了数据库迁移文件 `xuanxing/backend/selections/migrations/0001_initial.py`
   - 初始迁移文件，包含所有字段
   - Excel和PDF字段都是可选的

## 需要执行的操作

### 在Render后端运行迁移

1. **登录Render Dashboard**
   - 访问 https://dashboard.render.com
   - 找到您的后端服务

2. **打开Shell**
   - 点击服务名称
   - 点击 "Shell" 标签
   - 会打开一个命令行终端

3. **运行迁移命令**
   ```bash
   cd backend
   python manage.py migrate
   ```

4. **验证迁移成功**
   ```bash
   python manage.py showmigrations selections
   ```
   应该看到迁移已应用：
   ```
   [X] 0001_initial
   ```

## 完成后的效果

- ✅ 可以单独保存Excel文件到历史记录
- ✅ 可以单独保存PDF文件到历史记录
- ✅ 可以同时保存Excel和PDF文件到历史记录
- ✅ 不再出现400错误

## 注意事项

- 迁移是安全的，不会影响现有数据
- 现有记录中的Excel字段会保持不变
- 新记录可以选择只包含PDF或只包含Excel

## 如果遇到问题

如果运行迁移时遇到错误，请尝试：

1. **检查当前迁移状态**
   ```bash
   python manage.py showmigrations
   ```

2. **如果迁移冲突，可以回滚后重新迁移**
   ```bash
   python manage.py migrate selections 0001_initial
   python manage.py migrate selections
   ```

3. **如果还有问题，重新创建迁移**
   ```bash
   python manage.py makemigrations
   python manage.py migrate
   ```

