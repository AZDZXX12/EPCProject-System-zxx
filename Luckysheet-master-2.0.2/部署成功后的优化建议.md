# ğŸš€ éƒ¨ç½²æˆåŠŸåçš„ä¼˜åŒ–å»ºè®®

æ­å–œä½ æˆåŠŸéƒ¨ç½²äº† Luckysheet é€‰å‹ç³»ç»Ÿï¼ä»¥ä¸‹æ˜¯ä¸€äº›ä¼˜åŒ–å»ºè®®ï¼Œè®©ä½ çš„åº”ç”¨æ›´ç¨³å®šã€æ›´å¿«é€Ÿã€‚

---

## âš¡ 1. é˜²æ­¢åç«¯ä¼‘çœ ï¼ˆå¼ºçƒˆæ¨èï¼‰

### é—®é¢˜
Render å…è´¹tierä¼šåœ¨15åˆ†é’Ÿæ— æ´»åŠ¨åä¼‘çœ ï¼Œé¦–æ¬¡è®¿é—®éœ€è¦3-5ç§’å”¤é†’ã€‚

### è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ UptimeRobot

**UptimeRobot** æ˜¯ä¸€ä¸ªå…è´¹çš„ç½‘ç«™ç›‘æ§æœåŠ¡ï¼Œå¯ä»¥æ¯5åˆ†é’Ÿpingä¸€æ¬¡ä½ çš„åç«¯ï¼Œä¿æŒå…¶æ´»è·ƒã€‚

#### æ­¥éª¤ï¼š
1. è®¿é—® https://uptimerobot.com å¹¶æ³¨å†Œï¼ˆå…è´¹ï¼‰
2. ç‚¹å‡» "+ Add New Monitor"
3. é…ç½®ï¼š
   - **Monitor Type**: HTTP(s)
   - **Friendly Name**: Luckysheet Backend
   - **URL**: `https://ä½ çš„æœåŠ¡å.onrender.com/api/cables/`
   - **Monitoring Interval**: 5 minutes
4. ç‚¹å‡» "Create Monitor"

âœ… **æ•ˆæœ**ï¼šåç«¯å°†å§‹ç»ˆä¿æŒæ´»è·ƒï¼Œå“åº”é€Ÿåº¦æå‡ï¼

---

## ğŸŒ 2. é…ç½®è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰

### Vercel è‡ªå®šä¹‰åŸŸåï¼ˆå…è´¹ï¼‰

1. è¿›å…¥ Vercel é¡¹ç›® â†’ Settings â†’ Domains
2. æ·»åŠ ä½ çš„åŸŸåï¼ˆå¦‚ `selection.yourdomain.com`ï¼‰
3. æŒ‰æç¤ºåœ¨åŸŸåDNSè®¾ç½®CNAMEè®°å½•
4. è‡ªåŠ¨å¯ç”¨å…è´¹HTTPS âœ…

### Render è‡ªå®šä¹‰åŸŸåï¼ˆå…è´¹ï¼‰

1. è¿›å…¥ Render æœåŠ¡ â†’ Settings â†’ Custom Domain
2. æ·»åŠ ä½ çš„åŸŸåï¼ˆå¦‚ `api.yourdomain.com`ï¼‰
3. æŒ‰æç¤ºåœ¨åŸŸåDNSè®¾ç½®CNAMEè®°å½•
4. è‡ªåŠ¨å¯ç”¨å…è´¹HTTPS âœ…

---

## ğŸ“Š 3. æ·»åŠ ç½‘ç«™åˆ†æ

### Vercel Analyticsï¼ˆæ¨èï¼Œå…è´¹ï¼‰

**ä¼˜ç‚¹**ï¼šæ— éœ€ä»£ç ä¿®æ”¹ï¼Œè‡ªåŠ¨ç»Ÿè®¡è®¿é—®é‡ã€é¡µé¢æ€§èƒ½

#### æ­¥éª¤ï¼š
1. è¿›å…¥ Vercel é¡¹ç›® â†’ Analytics æ ‡ç­¾
2. ç‚¹å‡» "Enable Analytics"
3. å…è´¹ç‰ˆå¯æŸ¥çœ‹ï¼š
   - å®æ—¶è®¿é—®é‡
   - é¡µé¢æµè§ˆé‡
   - è®¿é—®æ¥æº
   - è®¾å¤‡ç±»å‹

### Google Analyticsï¼ˆå¯é€‰ï¼‰

åœ¨ `dist-refactored/index.html` çš„ `<head>` ä¸­æ·»åŠ ï¼š

```html
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXXXX');
</script>
```

---

## ğŸ›¡ï¸ 4. é”™è¯¯ç›‘æ§å’Œæ—¥å¿—

### Sentryï¼ˆæ¨èï¼Œå…è´¹tierï¼‰

**Sentry** å¯ä»¥è‡ªåŠ¨æ•è·å‰ç«¯å’Œåç«¯çš„é”™è¯¯ï¼Œå‘é€é‚®ä»¶é€šçŸ¥ã€‚

#### å‰ç«¯é›†æˆï¼š

1. è®¿é—® https://sentry.io æ³¨å†Œ
2. åˆ›å»ºé¡¹ç›® â†’ é€‰æ‹© JavaScript
3. åœ¨ `dist-refactored/index.html` çš„ `<head>` ä¸­æ·»åŠ ï¼š

```html
<script
  src="https://browser.sentry-cdn.com/7.x.x/bundle.min.js"
  crossorigin="anonymous"
></script>
<script>
  Sentry.init({
    dsn: 'https://ä½ çš„DSN@sentry.io/é¡¹ç›®ID',
    environment: 'production',
    tracesSampleRate: 0.1
  });
</script>
```

#### åç«¯é›†æˆï¼š

1. å®‰è£… Sentry SDKï¼š
   ```bash
   pip install sentry-sdk
   ```

2. åœ¨ `xuanxing/backend/cable_selector/settings.py` æ·»åŠ ï¼š
   ```python
   import sentry_sdk
   from sentry_sdk.integrations.django import DjangoIntegration
   
   if not DEBUG:
       sentry_sdk.init(
           dsn="https://ä½ çš„DSN@sentry.io/é¡¹ç›®ID",
           integrations=[DjangoIntegration()],
           traces_sample_rate=0.1,
           environment="production"
       )
   ```

---

## ğŸ—„ï¸ 5. æ•°æ®åº“å¤‡ä»½ï¼ˆé‡è¦ï¼ï¼‰

### é—®é¢˜
Render å…è´¹PostgreSQLä¼šåœ¨90å¤©ååˆ é™¤æ•°æ®ã€‚

### è§£å†³æ–¹æ¡ˆï¼šå®šæœŸå¤‡ä»½

#### æ‰‹åŠ¨å¤‡ä»½ï¼ˆæ¨èï¼‰

1. è¿›å…¥ Render æ•°æ®åº“é¡µé¢
2. ç‚¹å‡» "Connect" æŒ‰é’®ï¼Œå¤åˆ¶è¿æ¥å‘½ä»¤
3. åœ¨æœ¬åœ°å®‰è£… PostgreSQL å®¢æˆ·ç«¯
4. è¿è¡Œå¤‡ä»½å‘½ä»¤ï¼š
   ```bash
   pg_dump -h host -U user -d database > backup_$(date +%Y%m%d).sql
   ```

#### è‡ªåŠ¨å¤‡ä»½è„šæœ¬ï¼ˆé«˜çº§ï¼‰

åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼ˆå¦‚GitHub Actionsï¼‰æ¯å‘¨è‡ªåŠ¨å¤‡ä»½ï¼š

```yaml
# .github/workflows/backup-db.yml
name: æ•°æ®åº“å¤‡ä»½
on:
  schedule:
    - cron: '0 0 * * 0'  # æ¯å‘¨æ—¥å‡Œæ™¨
  workflow_dispatch:

jobs:
  backup:
    runs-on: ubuntu-latest
    steps:
      - name: å¤‡ä»½æ•°æ®åº“
        run: |
          pg_dump ${{ secrets.DATABASE_URL }} > backup.sql
      
      - name: ä¸Šä¼ åˆ°äº‘å­˜å‚¨
        # ä¸Šä¼ åˆ° AWS S3ã€Google Drive ç­‰
```

---

## ğŸš€ 6. æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–

1. **å¯ç”¨æµè§ˆå™¨ç¼“å­˜**ï¼ˆå·²åœ¨ `vercel.json` ä¸­é…ç½®ï¼‰
2. **å‹ç¼©é™æ€èµ„æº**ï¼š
   ```bash
   # å‹ç¼© JS/CSSï¼ˆå¯é€‰ï¼‰
   npm install -g uglify-js clean-css-cli
   uglifyjs dist-refactored/js/*.js -o dist-refactored/js/bundle.min.js
   cleancss dist-refactored/css/*.css -o dist-refactored/css/bundle.min.css
   ```

### åç«¯ä¼˜åŒ–

1. **å¯ç”¨æ•°æ®åº“è¿æ¥æ± **ï¼ˆå·²é…ç½®ï¼‰
2. **æ·»åŠ ç¼“å­˜**ï¼ˆRedisï¼‰ï¼š
   ```python
   # settings.py
   CACHES = {
       'default': {
           'BACKEND': 'django.core.cache.backends.redis.RedisCache',
           'LOCATION': os.getenv('REDIS_URL'),
       }
   }
   ```
   > æ³¨æ„ï¼šRender å…è´¹tierä¸åŒ…å« Redisï¼Œéœ€è¦ä½¿ç”¨å¤–éƒ¨æœåŠ¡å¦‚ Redis Labsï¼ˆå…è´¹30MBï¼‰

---

## ğŸ”’ 7. å®‰å…¨åŠ å›º

### åç«¯å®‰å…¨

åœ¨ `xuanxing/backend/cable_selector/settings.py` æ·»åŠ ï¼š

```python
# ç”Ÿäº§ç¯å¢ƒå®‰å…¨è®¾ç½®
if not DEBUG:
    # HTTPSå¼ºåˆ¶
    SECURE_SSL_REDIRECT = True
    SESSION_COOKIE_SECURE = True
    CSRF_COOKIE_SECURE = True
    
    # HSTS
    SECURE_HSTS_SECONDS = 31536000
    SECURE_HSTS_INCLUDE_SUBDOMAINS = True
    SECURE_HSTS_PRELOAD = True
    
    # å…¶ä»–å®‰å…¨é€‰é¡¹
    SECURE_CONTENT_TYPE_NOSNIFF = True
    SECURE_BROWSER_XSS_FILTER = True
    X_FRAME_OPTIONS = 'DENY'
```

### å‰ç«¯å®‰å…¨

1. **å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰**ï¼š
   åœ¨ `vercel.json` ä¸­æ·»åŠ ï¼š
   ```json
   {
     "headers": [
       {
         "source": "/(.*)",
         "headers": [
           {
             "key": "Content-Security-Policy",
             "value": "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline';"
           }
         ]
       }
     ]
   }
   ```

---

## ğŸ“ˆ 8. æ€§èƒ½ç›‘æ§

### å‰ç«¯æ€§èƒ½ç›‘æ§

ä½¿ç”¨ **Vercel Speed Insights**ï¼ˆå…è´¹ï¼‰ï¼š

1. è¿›å…¥ Vercel é¡¹ç›® â†’ Speed Insights
2. ç‚¹å‡» "Enable"
3. æŸ¥çœ‹ï¼š
   - é¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼ˆFCPï¼‰
   - æœ€å¤§å†…å®¹ç»˜åˆ¶ï¼ˆLCPï¼‰
   - é¦–æ¬¡è¾“å…¥å»¶è¿Ÿï¼ˆFIDï¼‰
   - ç´¯è®¡å¸ƒå±€åç§»ï¼ˆCLSï¼‰

### åç«¯ç›‘æ§

åœ¨ Render ä¸­ï¼š
1. è¿›å…¥æœåŠ¡ â†’ Metrics æ ‡ç­¾
2. æŸ¥çœ‹ï¼š
   - CPUä½¿ç”¨ç‡
   - å†…å­˜ä½¿ç”¨ç‡
   - å“åº”æ—¶é—´
   - è¯·æ±‚æ•°é‡

---

## ğŸ”„ 9. è‡ªåŠ¨éƒ¨ç½²å·¥ä½œæµ

### GitHub Actions è‡ªåŠ¨æµ‹è¯•å’Œéƒ¨ç½²

åˆ›å»º `.github/workflows/deploy.yml`ï¼š

```yaml
name: è‡ªåŠ¨æµ‹è¯•å’Œéƒ¨ç½²

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test-backend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: è®¾ç½®Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      - name: å®‰è£…ä¾èµ–
        run: |
          cd xuanxing/backend
          pip install -r requirements.txt
      - name: è¿è¡Œæµ‹è¯•
        run: |
          cd xuanxing/backend
          python manage.py test
  
  # Vercel å’Œ Render ä¼šè‡ªåŠ¨éƒ¨ç½²ï¼Œæ— éœ€é¢å¤–é…ç½®
```

---

## ğŸ’° 10. æˆæœ¬ä¼˜åŒ–ï¼ˆé•¿æœŸä½¿ç”¨ï¼‰

### å…è´¹tieré™åˆ¶

| æœåŠ¡ | å…è´¹é…é¢ | è¶…å‡ºåä»·æ ¼ |
|------|----------|------------|
| Vercel | 100GBå¸¦å®½/æœˆ | $20/æœˆèµ· |
| Render | 750å°æ—¶/æœˆ | $7/æœˆï¼ˆStarterï¼‰ |
| PostgreSQL | 90å¤©ä¿ç•™ | $7/æœˆï¼ˆæŒä¹…åŒ–ï¼‰ |

### çœé’±å»ºè®®

1. **æ•°æ®åº“**ï¼š
   - ä½¿ç”¨ **Supabase**ï¼ˆå…è´¹500MBï¼Œæ°¸ä¹…ï¼‰
   - æˆ– **ElephantSQL**ï¼ˆå…è´¹20MBï¼Œæ°¸ä¹…ï¼‰

2. **åç«¯**ï¼š
   - å¦‚æœæµé‡å¤§ï¼Œè€ƒè™‘è¿ç§»åˆ° **Railway**ï¼ˆ$5/æœˆï¼‰
   - æˆ– **Fly.io**ï¼ˆå…è´¹3ä¸ªåº”ç”¨ï¼‰

3. **å‰ç«¯**ï¼š
   - Vercel å…è´¹tieré€šå¸¸å¤Ÿç”¨
   - æˆ–ä½¿ç”¨ **Cloudflare Pages**ï¼ˆæ— é™å¸¦å®½ï¼‰

---

## âœ… æ€»ç»“

ä¼˜å…ˆçº§æ’åºï¼š
1. â­â­â­ **é˜²æ­¢ä¼‘çœ **ï¼ˆUptimeRobotï¼‰
2. â­â­â­ **æ•°æ®åº“å¤‡ä»½**
3. â­â­ **é”™è¯¯ç›‘æ§**ï¼ˆSentryï¼‰
4. â­â­ **å®‰å…¨åŠ å›º**
5. â­ **æ€§èƒ½ç›‘æ§**
6. â­ **è‡ªå®šä¹‰åŸŸå**

---

**ç¥ä½ çš„åº”ç”¨è¿è¡Œé¡ºåˆ©ï¼** ğŸš€

