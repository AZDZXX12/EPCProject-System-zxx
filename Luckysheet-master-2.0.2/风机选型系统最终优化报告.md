# 风机选型系统最终优化报告

## ✅ 已完成的所有优化

### 1. **界面布局优化 - 铺满屏幕**
- ✓ 主内容区高度：`height: calc(100vh - 100px)` 铺满整个屏幕
- ✓ 左侧输入面板宽度：`450px`（增加到合适大小）
- ✓ 左右面板都设置 `height: 100%` 和 `overflow-y: auto`
- ✓ 输入框两列布局，更紧凑高效
- ✓ 响应式设计：小屏幕自动切换为单列

### 2. **智能风机型号推荐**
- ✓ **自动推荐**：如果用户未选择型号，系统根据比转数自动推荐：
  - `ns < 30`：推荐 **4-72**（低比转数，后向叶片）
  - `30 ≤ ns < 60`：推荐 **4-73**（中比转数）
  - `60 ≤ ns < 100`：推荐 **5-48**（高比转数，前向叶片）
  - `ns ≥ 100`：推荐 **6-30**（轴流风机）
- ✓ **显示更新**：选型结果中的推荐型号会根据计算实时变化

### 3. **离心风机系数完整集成**
从`数据库.xlsx`的"离心风机系数"工作表读取62种风机型号的系数：

#### 系数数据结构
```javascript
{
  "model": "4-72",
  "flow_coefficients": [φ1, φ2, φ3, φ4, φ5, φ6, φ7],    // 流量系数
  "pressure_coefficients": [ψ1, ψ2, ψ3, ψ4, ψ5, ψ6, ψ7],  // 全压系数
  "efficiency": [η1, η2, η3, η4, η5, η6, η7]              // 内效率(%)
}
```

#### 系数应用位置
1. **粗算叶轮直径**：`D = 27/n × √(P/(2×ρ×ψ))`
2. **计算流量**：`Q = φ × (π/4) × D² × u × 3600`
3. **计算压力**：`P = ψ × ρ × u²`
4. **轴功率计算**：使用从数据库读取的效率η

### 4. **计算详情完整展示**
在"计算详情"标签页，现在分4个部分显示：

#### 📐 风机系数（数据库.xlsx）
- 流量系数φ（VLOOKUP从数据库读取）
- 全压系数ψ（VLOOKUP从数据库读取）
- 内效率η（VLOOKUP从数据库读取）

#### 🌍 环境参数计算
- 当地大气压：`P_atm = 101325×(1-0.02257×h/1000)^5.256`
- 工况密度：`ρ = (273/(273+T)×P_atm/101325)×1.2`

#### ⚙️ 风机参数计算
- 比转数：`ns = 5.54×n×√(Q/3600)/(P×1.2/ρ)^0.75`
- **粗算叶轮直径**：`D = 27/n × √(P/(2×ρ×ψ))`（使用系数ψ）
- 线速度：`u = π×D×n/60`
- **计算流量**：`Q = φ×(π/4)×D²×u×3600`（使用系数φ）
- **计算压力**：`P = ψ×ρ×u²`（使用系数ψ）

#### 🔌 功率计算
- 轴功率：`P_轴 = Q×P/(3600×η×1000)`（使用系数η）
- 传动效率：98%
- 安全系数：T<200℃时1.15，T≥200℃时1.30
- **电机功率**：`P_电机 = P_轴/η_传×K`

### 5. **Excel公式完整对应**

| Excel单元格 | 公式 | 系统实现 |
|------------|------|---------|
| F5 | `=101325*(1-0.02257*F4/1000)^5.256` | ✓ localPressure |
| F6 | `=(273/(273+C7)*(F5+C6)/101325)*O4` | ✓ workingDensity |
| C9 | `=5.54*F7*(C4/3600)^0.5/(C5*1.2/F6)^0.75` | ✓ specificSpeed |
| **C10** | `=27/F7*(C5/2/F6/VLOOKUP(F9,[2]数据库!A$1:S$65536,14))^0.5` | ✓ roughImpellerDiameter（**使用压力系数ψ**） |
| **C13** | `=IF(B11=\"双吸\",2*VLOOKUP(F9,[2]数据库!A$1:S$65536,2)*...` | ✓ calculatedFlow（**使用流量系数φ**） |
| **D13** | `=VLOOKUP(F9,[2]数据库!A$1:S$65536,11)*F6*(PI()*F10*F7/60)^2...` | ✓ calculatedPressure（**使用压力系数ψ**） |
| **E13** | `=VLOOKUP(F9,[2]数据库!A$1:AC$65536,21)` | ✓ fanEfficiency（**从数据库读取**） |
| F13 | `=C13/3600*D13/E13/10` | ✓ shaftPower |
| G13 | `=IF(C7<200,F13/0.98*1.15,F13/0.98*1.3)` | ✓ motorPower |

## 📊 系数读取流程

```
1. 用户选择风机型号（如：4-72）或系统自动推荐
   ↓
2. 从 FAN_COEFFICIENTS_DATABASE['4-72'] 读取：
   - flow_coefficients[3] = 0.221799 (φ)
   - pressure_coefficients[3] = 0.417192 (ψ)
   - efficiency[3] = 88.2 (η%)
   ↓
3. 应用到计算公式：
   - 粗算叶轮直径 = 27/960 × √(5000/(2×1.025×0.417192))
   - 计算流量 = 0.221799 × (π/4) × D² × u × 3600
   - 计算压力 = 0.417192 × ρ × u²
   - 轴功率 = Q × P / (3600 × 0.882 × 1000)
   ↓
4. 显示在"计算详情"标签页，清晰标注"VLOOKUP从数据库读取"
```

## 🎯 核心改进点

### 问题1：选型结果推荐的风机型号不变
**解决方案**：
- 添加智能推荐逻辑，基于比转数自动选择型号
- 推荐型号会实时显示在"选型结果"区域

### 问题2：界面要铺满屏幕
**解决方案**：
- `main-content` 高度改为 `calc(100vh - 100px)`
- 左右面板都设置 `height: 100%`
- 自动填满整个屏幕，无空白区域

### 问题3：离心风机系数读取位置
**解决方案**：
- 在计算流程最前面读取系数
- 在"计算详情"标签页最上方显示系数表
- 每个使用系数的公式都标注"VLOOKUP从数据库读取"

### 问题4：参考的计算逻辑
**解决方案**：
- 严格按照Excel公式实现
- C10、C13、D13、E13 都正确使用VLOOKUP的系数
- 计算详情完整展示每一步

## 📁 文件清单

- `dist-refactored/fan-selector.html` - 主页面（已优化）
- `dist-refactored/fan_coefficients_database.js` - 62种风机系数数据库
- `dist-refactored/fan_system_database.js` - 风机性能参数数据
- `数据库.xlsx` - 原始数据源

## 🚀 使用说明

1. **启动系统**：双击 `一键启动.bat` 或运行：
   ```bash
   cd dist-refactored
   python -m http.server 8000
   ```

2. **打开页面**：浏览器访问 `http://localhost:8000/fan-selector.html`

3. **选型步骤**：
   - 输入流量、压力、温度等基本参数
   - （可选）选择风机型号，或让系统自动推荐
   - 点击"开始选型计算"
   - 查看"计算详情"标签，了解完整计算过程
   - 查看"性能参数"标签，了解选定型号的7组系数

4. **强制刷新**：如有缓存问题，按 `Ctrl+Shift+R`

## ✨ 特色功能

1. **完整的Excel逻辑复刻**：所有公式与Excel一致
2. **可视化系数展示**：清晰显示从数据库读取的系数
3. **智能型号推荐**：基于比转数自动推荐最合适的风机
4. **铺满屏幕布局**：最大化信息展示，无浪费空间
5. **响应式设计**：适配不同屏幕尺寸

---

**优化完成时间**：2025-10-14  
**状态**：✅ 已完成所有优化  
**建议**：强制刷新浏览器查看最新效果


