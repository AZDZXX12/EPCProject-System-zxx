# 🗄️ 永久免费PostgreSQL数据库方案

> **问题**：Render免费数据库90天后会删除  
> **解决**：使用以下永久免费的数据库服务

---

## 🏆 推荐方案对比

| 服务 | 免费额度 | 限制 | 推荐度 | 永久性 |
|------|---------|------|--------|--------|
| **Supabase** | 500MB存储 | 每月活跃时间限制 | ⭐⭐⭐⭐⭐ | ✅ 永久 |
| **Neon** | 3GB存储 | 计算时间限制 | ⭐⭐⭐⭐⭐ | ✅ 永久 |
| **ElephantSQL** | 20MB存储 | 5个并发连接 | ⭐⭐⭐⭐ | ✅ 永久 |
| **Railway** | $5/月额度 | 需要信用卡 | ⭐⭐⭐⭐ | ✅ 永久 |
| **Aiven** | 1个免费数据库 | 90天后需迁移 | ⭐⭐⭐ | ⚠️ 有限 |

---

## 方案1：Supabase（最推荐）⭐⭐⭐⭐⭐

### 优势
- ✅ **500MB 存储空间**（足够小项目使用）
- ✅ **永久免费**
- ✅ **自动备份**
- ✅ **提供管理界面**
- ✅ **支持连接池**
- ✅ **全球CDN**

### 限制
- ⚠️ 每月活跃时间有限制（但足够用）
- ⚠️ 7天无活动会暂停（首次访问自动恢复）

### 注册和配置

#### 1. 注册Supabase（2分钟）

1. 访问：https://supabase.com
2. 点击 **"Start your project"**
3. 使用GitHub账号登录（推荐）

#### 2. 创建项目（3分钟）

1. 点击 **"New Project"**
2. 填写信息：
   ```
   Name: cable-selector
   Database Password: [生成强密码并保存]
   Region: Southeast Asia (Singapore) [选择离你近的]
   Plan: Free
   ```
3. 点击 **"Create new project"**
4. 等待2-3分钟，项目创建中...

#### 3. 获取数据库URL（1分钟）

1. 项目创建完成后，进入项目
2. 点击左侧 **"Settings"** → **"Database"**
3. 找到 **"Connection string"** 部分
4. 选择 **"URI"** 模式
5. 复制连接字符串（格式）：
   ```
   postgresql://postgres:[YOUR-PASSWORD]@db.xxx.supabase.co:5432/postgres
   ```
6. 将 `[YOUR-PASSWORD]` 替换为你设置的密码

#### 4. 更新Render配置（2分钟）

1. 登录Render
2. 进入你的Web Service
3. 点击 **"Environment"** 标签
4. 找到 `DATABASE_URL` 变量
5. 点击编辑，替换为Supabase的连接字符串
6. 点击 **"Save Changes"**
7. 等待自动重新部署

#### 5. 运行数据库迁移（自动）

Render重新部署时会自动执行：
```bash
python manage.py migrate
python manage.py load_initial_data
```

---

## 方案2：Neon（推荐，慷慨额度）⭐⭐⭐⭐⭐

### 优势
- ✅ **3GB 存储空间**（非常慷慨）
- ✅ **永久免费**
- ✅ **自动休眠和唤醒**
- ✅ **分支功能**（类似Git）
- ✅ **无需信用卡**

### 限制
- ⚠️ 计算时间每月限制（约100小时，足够用）
- ⚠️ 5分钟无活动会休眠

### 配置步骤

#### 1. 注册Neon

1. 访问：https://neon.tech
2. 点击 **"Sign up"**
3. 使用GitHub登录

#### 2. 创建项目

1. 点击 **"Create Project"**
2. 填写：
   ```
   Project name: cable-selector
   PostgreSQL version: 15 (推荐)
   Region: AWS Asia Pacific (Singapore)
   ```
3. 点击 **"Create project"**

#### 3. 获取连接字符串

1. 项目创建后，自动显示连接信息
2. 复制 **"Connection string"**：
   ```
   postgresql://username:password@ep-xxx.region.aws.neon.tech/neondb
   ```

#### 4. 配置到Render

同方案1的步骤4-5

---

## 方案3：ElephantSQL（最简单）⭐⭐⭐⭐

### 优势
- ✅ **20MB 存储**（小项目够用）
- ✅ **完全免费，永久**
- ✅ **配置最简单**
- ✅ **稳定可靠**

### 限制
- ⚠️ 存储空间较小（20MB）
- ⚠️ 最多5个并发连接

### 配置步骤

#### 1. 注册

1. 访问：https://www.elephantsql.com
2. 点击 **"Get a managed database today"**
3. 使用GitHub或邮箱注册

#### 2. 创建实例

1. 点击 **"Create New Instance"**
2. 填写：
   ```
   Name: cable-selector
   Plan: Tiny Turtle (Free)
   Data center: Asia Pacific (Singapore)
   ```
3. 点击 **"Create instance"**

#### 3. 获取URL

1. 点击刚创建的实例
2. 复制 **"URL"** 字段

#### 4. 配置到Render

同方案1的步骤4-5

---

## 方案4：Railway（需要信用卡）⭐⭐⭐⭐

### 优势
- ✅ **每月$5免费额度**
- ✅ **PostgreSQL + Redis**
- ✅ **无存储限制**
- ✅ **优秀的开发体验**

### 限制
- ⚠️ **需要绑定信用卡**（不会扣费）
- ⚠️ 超出$5额度会收费

### 配置步骤

1. 访问：https://railway.app
2. 使用GitHub登录
3. 添加信用卡（用于验证，不会扣费）
4. New Project → Provision PostgreSQL
5. 复制 `DATABASE_URL`
6. 配置到Render

---

## 🔄 如何从Render数据库迁移

### 方案A：导出并导入（推荐）

#### 1. 导出Render数据库

在Render数据库页面：
1. 点击 **"Connect"** 按钮
2. 复制连接命令
3. 在本地执行：
   ```bash
   pg_dump [Render数据库URL] > backup.sql
   ```

#### 2. 导入到新数据库

```bash
psql [新数据库URL] < backup.sql
```

### 方案B：使用Django命令（简单）

#### 1. 导出数据（JSON格式）

```bash
python manage.py dumpdata > datadump.json
```

#### 2. 更新DATABASE_URL

在Render环境变量中更新为新数据库URL

#### 3. 运行迁移并导入

```bash
python manage.py migrate
python manage.py loaddata datadump.json
```

---

## 📊 详细对比

### 存储空间对比

| 服务 | 免费存储 | 对本项目的评估 |
|------|---------|--------------|
| **Supabase** | 500MB | ✅ 非常充足 |
| **Neon** | 3GB | ✅ 极其充足 |
| **ElephantSQL** | 20MB | ⚠️ 刚好够用 |
| **Railway** | 无限制 | ✅ 完全够用 |
| **Render** | 1GB | ✅ 充足（但90天后删除）|

### 本项目数据量估算

电缆选型数据库：
- 电缆规格：约100条记录
- 电机参数：约50条记录
- 用户数据：根据使用情况

**预计总数据量：< 5MB**

✅ 所有方案都完全够用！

---

## 🎯 推荐使用顺序

### 最佳方案（推荐）

```
1️⃣ Neon (3GB，计算时间限制但很慷慨)
2️⃣ Supabase (500MB，功能丰富)
3️⃣ ElephantSQL (20MB，最稳定)
```

### 选择建议

- **追求空间和性能**：选 Neon
- **需要额外功能（认证、存储）**：选 Supabase
- **想要最简单稳定**：选 ElephantSQL
- **愿意绑卡，要最好体验**：选 Railway

---

## ⚡ 快速迁移指南（5分钟）

### 推荐：迁移到Neon

#### 步骤1：注册Neon（2分钟）
1. 访问 https://neon.tech
2. GitHub登录
3. Create Project → 获取连接字符串

#### 步骤2：更新Render（1分钟）
1. Render → Environment
2. 更新 `DATABASE_URL` 为Neon的URL
3. Save Changes

#### 步骤3：自动部署（2分钟）
- Render自动重新部署
- 自动运行迁移
- 自动加载初始数据

✅ 完成！现在使用永久免费数据库了！

---

## 🔒 数据安全建议

无论使用哪个服务，建议：

1. **定期备份**
   ```bash
   # 每周执行一次
   pg_dump [数据库URL] > backup_$(date +%Y%m%d).sql
   ```

2. **使用GitHub Actions自动备份**
   创建 `.github/workflows/backup-db.yml`：
   ```yaml
   name: 数据库备份
   on:
     schedule:
       - cron: '0 0 * * 0'  # 每周日
   jobs:
     backup:
       runs-on: ubuntu-latest
       steps:
         - name: 备份数据库
           run: |
             pg_dump ${{ secrets.DATABASE_URL }} > backup.sql
         - name: 上传到GitHub
           uses: actions/upload-artifact@v2
           with:
             name: database-backup
             path: backup.sql
   ```

3. **保存连接信息**
   将数据库URL保存在安全的地方（密码管理器）

---

## ❓ 常见问题

### Q: 会不会突然收费？
A: 不会。这些服务的免费tier是永久的，除非你主动升级。

### Q: 数据会丢失吗？
A: 只要在免费额度内，数据是永久保存的。建议定期备份。

### Q: 需要信用卡吗？
A: Supabase、Neon、ElephantSQL都不需要信用卡。

### Q: 性能够用吗？
A: 对于本项目（电缆选型系统），完全够用。几百条数据，响应速度很快。

### Q: 可以随时换吗？
A: 可以！只需导出数据，更换DATABASE_URL，导入数据即可。

---

## 🎉 总结

**最推荐的选择：**

1. **Neon** - 空间最大（3GB），永久免费
2. **Supabase** - 功能最丰富，500MB，永久免费
3. **ElephantSQL** - 最简单稳定，20MB，永久免费

**所有方案都比Render的90天限制好！**

选择任意一个，按照上面的步骤配置，5分钟就能完成迁移！

---

**建议立即迁移到Neon或Supabase，一劳永逸解决数据库问题！** 🚀

