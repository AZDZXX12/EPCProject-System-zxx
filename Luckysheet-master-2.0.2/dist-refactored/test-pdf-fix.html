<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PDFä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-item {
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #2196F3;
            background: #E3F2FD;
        }
        .success {
            border-left-color: #4CAF50;
            background: #E8F5E9;
        }
        .error {
            border-left-color: #f44336;
            background: #FFEBEE;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #45a049;
        }
        pre {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .page-number-demo {
            text-align: center;
            font-size: 11px;
            color: #999;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-box">
        <h1>ğŸ” PDFä¿®å¤æµ‹è¯•é¡µé¢</h1>
        <p><strong>ç”¨é€”ï¼š</strong>éªŒè¯PDFé¡µç å’Œæ°´å°ä»£ç æ˜¯å¦å·²æ›´æ–°</p>
    </div>

    <div class="test-box">
        <h2>æµ‹è¯•1ï¼šé¡µç æ ¼å¼æµ‹è¯•</h2>
        <div id="test1" class="test-item">
            <p><strong>é¢„æœŸï¼š</strong>åº”è¯¥æ˜¾ç¤ºæ•°å­—æ ¼å¼ "1 / 3"</p>
            <div class="page-number-demo" id="pageNumDemo">
                æµ‹è¯•é¡µç å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
            </div>
        </div>
        <button onclick="testPageNumber()">è¿è¡Œæµ‹è¯•</button>
    </div>

    <div class="test-box">
        <h2>æµ‹è¯•2ï¼šæ°´å°é…ç½®æµ‹è¯•</h2>
        <div id="test2" class="test-item">
            <pre id="configOutput">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æµ‹è¯•...</pre>
        </div>
        <button onclick="testWatermarkConfig()">è¿è¡Œæµ‹è¯•</button>
    </div>

    <div class="test-box">
        <h2>æµ‹è¯•3ï¼šå­—ç¬¦ç¼–ç æµ‹è¯•</h2>
        <div id="test3" class="test-item">
            <div id="encodingTest"></div>
        </div>
        <button onclick="testEncoding()">è¿è¡Œæµ‹è¯•</button>
    </div>

    <div class="test-box">
        <h2>ğŸ“‹ æ£€æŸ¥ç»“æœ</h2>
        <div id="results"></div>
        <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <button onclick="window.location.href='index.html'">è¿”å›ä¸»é¡µ</button>
    </div>

    <script>
        console.log('ğŸ¯ PDFä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
        console.log('ğŸ“… åŠ è½½æ—¶é—´:', new Date().toLocaleString());
        
        // æµ‹è¯•é¡µç ç”Ÿæˆ
        function testPageNumber() {
            const demo = document.getElementById('pageNumDemo');
            const test1 = document.getElementById('test1');
            
            // æ¨¡æ‹ŸgeneratePreviewä¸­çš„é¡µç ç”Ÿæˆ
            let totalPages = 3;
            let pageResults = [];
            
            for (let p = 0; p < totalPages; p++) {
                const pageNumText = `${p + 1} / ${totalPages}`;
                pageResults.push(pageNumText);
            }
            
            demo.innerHTML = pageResults.map((text, i) => 
                `<div style="margin: 5px 0;">ç¬¬${i+1}é¡µé¡µç : <strong>${text}</strong></div>`
            ).join('');
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«ä¸­æ–‡
            const hasChinese = pageResults.some(text => /[\u4e00-\u9fa5]/.test(text));
            
            if (!hasChinese) {
                test1.className = 'test-item success';
                console.log('âœ… é¡µç æ ¼å¼æµ‹è¯•é€šè¿‡:', pageResults);
            } else {
                test1.className = 'test-item error';
                console.error('âŒ é¡µç æ ¼å¼æµ‹è¯•å¤±è´¥: åŒ…å«ä¸­æ–‡å­—ç¬¦');
            }
            
            return !hasChinese;
        }
        
        // æµ‹è¯•æ°´å°é…ç½®
        function testWatermarkConfig() {
            const output = document.getElementById('configOutput');
            const test2 = document.getElementById('test2');
            
            // æ¨¡æ‹ŸpdfConfigé»˜è®¤å€¼
            const pdfConfig = {
                enableWatermark: true,
                watermarkText: 'æ³½å›½åŒ–æœº',
                watermarkFontSize: 40,
                watermarkRotation: -45,
                watermarkOpacity: 0.2,
                watermarkDensity: 9,
                watermarkColor: 'gray'
            };
            
            const configText = JSON.stringify(pdfConfig, null, 2);
            output.textContent = configText;
            
            // æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®
            const isCorrect = 
                pdfConfig.enableWatermark === true &&
                pdfConfig.watermarkText === 'æ³½å›½åŒ–æœº' &&
                pdfConfig.watermarkOpacity === 0.2 &&
                pdfConfig.watermarkDensity === 9;
            
            if (isCorrect) {
                test2.className = 'test-item success';
                console.log('âœ… æ°´å°é…ç½®æµ‹è¯•é€šè¿‡:', pdfConfig);
            } else {
                test2.className = 'test-item error';
                console.error('âŒ æ°´å°é…ç½®æµ‹è¯•å¤±è´¥');
            }
            
            return isCorrect;
        }
        
        // æµ‹è¯•å­—ç¬¦ç¼–ç 
        function testEncoding() {
            const test3Element = document.getElementById('test3');
            const output = document.getElementById('encodingTest');
            
            const tests = [
                { name: 'æ•°å­—æ ¼å¼', text: '1 / 3', expected: true },
                { name: 'ä¸­æ–‡æ ¼å¼', text: 'ç¬¬ 1 é¡µ / å…± 3 é¡µ', expected: false },
                { name: 'å…¬å¸åç§°', text: 'æ³½å›½åŒ–æœº', expected: true }
            ];
            
            let allPassed = true;
            let html = '<table style="width: 100%; border-collapse: collapse;">';
            html += '<tr><th style="border: 1px solid #ddd; padding: 8px;">æµ‹è¯•é¡¹</th><th style="border: 1px solid #ddd; padding: 8px;">æ–‡æœ¬</th><th style="border: 1px solid #ddd; padding: 8px;">ç»“æœ</th></tr>';
            
            tests.forEach(test => {
                const div = document.createElement('div');
                div.textContent = test.text;
                const rendered = div.textContent;
                const passed = (rendered === test.text) === test.expected;
                
                html += `<tr>
                    <td style="border: 1px solid #ddd; padding: 8px;">${test.name}</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">${test.text}</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">${passed ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}</td>
                </tr>`;
                
                if (!passed) allPassed = false;
                
                console.log(`${passed ? 'âœ…' : 'âŒ'} ç¼–ç æµ‹è¯• [${test.name}]:`, rendered);
            });
            
            html += '</table>';
            output.innerHTML = html;
            
            if (allPassed) {
                test3Element.className = 'test-item success';
            } else {
                test3Element.className = 'test-item error';
            }
            
            return allPassed;
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        function runAllTests() {
            console.log('ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...');
            
            const results = {
                pageNumber: testPageNumber(),
                watermark: testWatermarkConfig(),
                encoding: testEncoding()
            };
            
            const resultsDiv = document.getElementById('results');
            const allPassed = Object.values(results).every(r => r);
            
            resultsDiv.innerHTML = `
                <div class="test-item ${allPassed ? 'success' : 'error'}">
                    <h3>${allPassed ? 'âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼' : 'âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥'}</h3>
                    <ul>
                        <li>é¡µç æ ¼å¼: ${results.pageNumber ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}</li>
                        <li>æ°´å°é…ç½®: ${results.watermark ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}</li>
                        <li>å­—ç¬¦ç¼–ç : ${results.encoding ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}</li>
                    </ul>
                    ${allPassed ? 
                        '<p><strong>ç»“è®ºï¼š</strong>ä»£ç å·²æ­£ç¡®æ›´æ–°ï¼å¦‚æœä¸»é¡µè¿˜æœ‰é—®é¢˜ï¼Œè¯·æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ã€‚</p>' :
                        '<p><strong>ç»“è®ºï¼š</strong>ä»£ç å¯èƒ½æœªæ­£ç¡®åŠ è½½ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¿å­˜ã€‚</p>'
                    }
                </div>
            `;
            
            console.log('ğŸ“Š æµ‹è¯•ç»“æœ:', results);
            console.log(allPassed ? 'âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡' : 'âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥');
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', function() {
            console.log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œ3ç§’åè‡ªåŠ¨è¿è¡Œæµ‹è¯•...');
            setTimeout(runAllTests, 3000);
        });
    </script>
</body>
</html>

