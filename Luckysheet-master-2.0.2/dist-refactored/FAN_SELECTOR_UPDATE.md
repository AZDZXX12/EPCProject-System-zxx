# 离心风机选型系统 - 精确版逻辑整合完成

## ✅ 主要改进

### 1. **完全按Excel表格逻辑实现选型算法**
- **推荐算法优化**：遍历所有风机型号的7个系数点，计算每个点的Q（流量）和P（压力）
- **单/双吸系数应用**：在推荐算法中正确应用 `inletFactor`（单吸=1，双吸=2）
- **BB24/BB50压力修正**：推荐时应用 0.9784 修正系数
- **最小误差匹配**：选择与目标Q、P误差最小的工况点（压力权重x2）

### 2. **7行性能对比表（核心功能）**
- **位置**："计算详情"标签页底部
- **功能**：显示推荐风机型号的7个工况点的完整性能参数
- **高亮显示**：选中的最佳工况点以黄色背景高亮，标记 ★
- **数据列**：
  - 序号
  - 流量 (m³/h)
  - 全压 (Pa)
  - 内效率 (%)
  - 轴功率 (kW)
  - 电机功率 (kW)
  - 误差得分

### 3. **推荐原因优化**
- 显示格式：`第N工况点最接近（Q误差XX%，P误差XX%）`
- 清晰展示流量和压力的误差百分比
- 便于验证选型是否合理

### 4. **全压默认值修正**
- 从 5000 Pa 改为 **4500 Pa**
- 与Excel测试截图保持一致

### 5. **计算公式完整性**
所有关键公式与Excel完全一致：
```javascript
// 流量（考虑单/双吸）
Q = φ * (π/4) * D² * u * 3600 * (单吸=1, 双吸=2)

// 压力（考虑BB修正）
P = ψ * ρ * u² * (BB24/BB50=0.9784, 其他=1)

// 轴功率
Psh = Q * P / (3600 * η * 1000)

// 电机功率（考虑温度）
Pm = Psh / 0.98 * (T<200?1.15:1.3)
```

## 🎯 测试方法

1. 访问：`http://localhost:8000/fan-selector.html`
2. 使用以下参数测试（与Excel截图一致）：
   - 流量：16000 m³/h
   - 全压：4500 Pa（已修正默认值）
   - 温度：60℃
   - 海拔：33m
   - 转速：960 r/min
   - 叶轮直径：2.2 m
   - 吸入型式：单吸
3. 点击"开始选型计算"
4. 切换到"计算详情"标签页
5. 查看最底部的"7个工况点性能对比表"
6. 确认黄色高亮行与Excel的第3行（或其他最佳行）一致

## 📊 预期结果

- 推荐风机型号应与Excel推荐一致
- 7行对比表中的流量、压力、效率、功率应与Excel计算值接近
- 误差得分最小的那一行应被黄色高亮
- 推荐原因应显示具体的Q、P误差百分比

## 🔧 技术细节

### 新增函数
```javascript
generate7PointComparisonTable(model, selectedIndex, params)
```
- 参数：风机型号、选中系数点索引、计算参数（D, n, ρ, inletFactor, T, targetQ, targetP）
- 功能：生成7行HTML表格，高亮最佳工况点

### 样式改进
```css
tr style="background: #fff9c4; font-weight: 600;" /* 黄色高亮 */
```

## 📌 注意事项

1. 请使用 `Ctrl+Shift+R` 强制刷新浏览器缓存
2. 确保本地服务器正在运行：`python -m http.server 8000`
3. 7行对比表位于"计算详情"（第4个标签页）的最底部
4. 风机系数数据来自 `fan_coefficients_database.js`

## 🚀 下一步优化建议

1. 添加权重调节UI（wQ、wP滑杆）
2. 支持导出7行对比表为Excel
3. 添加性能曲线上标注当前工况点
4. 支持批量选型（多组参数）

---

**更新时间**：2025-10-14  
**更新内容**：完全按Excel表格逻辑重写选型算法，新增7行性能对比表


