<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ¤æ è®¡ç®— - è®¾å¤‡å‚æ•°é€‰å‹ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../css/tool-common.css">
</head>
<body>
    <div class="tool-container">
        <div class="tool-header">
            <button class="back-btn" onclick="goBack()">â† è¿”å›</button>
            <h1>ğŸ›¡ï¸ æŠ¤æ é’¢æç”¨é‡è®¡ç®—</h1>
            <p class="subtitle">ç¬¦åˆ GB4053.3-2009 æ ‡å‡†</p>
        </div>

        <div class="tool-content">
            <div class="input-section">
                <div class="input-group">
                    <label for="length">æŠ¤æ é•¿åº¦ (m)</label>
                    <input type="number" id="length" placeholder="è¯·è¾“å…¥æŠ¤æ é•¿åº¦" step="0.01" value="">
                </div>

                <div class="input-group">
                    <label for="height">æŠ¤æ é«˜åº¦ (m)</label>
                    <input type="number" id="height" placeholder="è¯·è¾“å…¥æŠ¤æ é«˜åº¦" step="0.01" value="1.05">
                </div>

                <div class="input-group radio-group">
                    <label><input type="radio" name="type" value="platform" checked> å¹³å°æŠ¤æ </label>
                    <label><input type="radio" name="type" value="stair"> æ¥¼æ¢¯æŠ¤æ </label>
                </div>

                <button class="calc-btn" onclick="calculate()">ğŸ”¨ è®¡ç®—ç”¨é‡</button>
            </div>

            <div class="result-section" id="resultSection" style="display: none;">
                <h3>ğŸ“Š ææ–™æ˜ç»†è¡¨</h3>
                <ul class="result-list" id="resultList"></ul>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        (function() {
            const sessionInfo = sessionStorage.getItem('currentSession');
            if (!sessionInfo) {
                window.location.href = '../login.html';
            }
        })();

        function calculate() {
            const length = parseFloat(document.getElementById('length').value);
            const height = parseFloat(document.getElementById('height').value);
            const isPlatform = document.querySelector('input[name="type"]:checked').value === 'platform';

            if (!length || length <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æŠ¤æ é•¿åº¦');
                return;
            }

            if (!height || height <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æŠ¤æ é«˜åº¦');
                return;
            }

            // æ£€æŸ¥GB4053.3-2009æ ‡å‡†
            if (height < 1.05) {
                if (!confirm('æ ‡å‡†GB4053.3-2009è¦æ±‚æŠ¤æ é«˜åº¦ä¸åº”å°äº1.05mï¼\næ˜¯å¦ç»§ç»­ä½¿ç”¨å½“å‰é«˜åº¦ï¼Ÿ')) {
                    return;
                }
            }

            const materials = calculateMaterials(length, height, isPlatform);
            displayResults(materials);
        }

        function calculateMaterials(length, height, isPlatform) {
            const results = [];
            
            // ç«‹æŸ±é—´è·(m)
            const postSpacing = 1.2;
            const postCount = Math.ceil(length / postSpacing) + 1;
            
            // 40*60*3æ–¹ç®¡ç«‹æŸ±
            const postLength = postCount * height;
            const postWeight = postLength * 5.42; // kg/m
            results.push(['ç«‹æŸ±', '40*60*3æ–¹ç®¡', postCount + 'æ ¹', postWeight.toFixed(2) + ' kg']);
            
            // 40*40*3æ‰¶æ‰‹
            const handrailWeight = length * 3.52;
            results.push(['æ‰¶æ‰‹', '40*40*3æ–¹ç®¡', length.toFixed(2) + ' m', handrailWeight.toFixed(2) + ' kg']);
            
            // 50*5æ‰é“ä¸­æ¨ªæ¡£(2é“)
            const midRailWeight = length * 2 * 1.963;
            results.push(['ä¸­æ¨ªæ¡£', '50*5æ‰é“ (2é“)', (length * 2).toFixed(2) + ' m', midRailWeight.toFixed(2) + ' kg']);
            
            // è¸¢è„šçº¿(ä»…å¹³å°æŠ¤æ )
            let kickboardWeight = 0;
            if (isPlatform) {
                kickboardWeight = length * 3.14;
                results.push(['è¸¢è„šçº¿', '100*4æ‰é“', length.toFixed(2) + ' m', kickboardWeight.toFixed(2) + ' kg']);
            }
            
            // æ€»é‡é‡
            const totalWeight = postWeight + handrailWeight + midRailWeight + kickboardWeight;
            results.push(['æ€»é‡é‡', '-', '-', totalWeight.toFixed(2) + ' kg']);
            
            return results;
        }

        function displayResults(materials) {
            const resultList = document.getElementById('resultList');
            resultList.innerHTML = '';
            
            // æ·»åŠ è¡¨å¤´
            const header = document.createElement('li');
            header.innerHTML = '<span>ææ–™åç§°</span><span>è§„æ ¼å‹å·</span><span>æ•°é‡</span><span>é‡é‡</span>';
            resultList.appendChild(header);
            
            // æ·»åŠ æ•°æ®
            materials.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${item[0]}</span><span>${item[1]}</span><span>${item[2]}</span><span>${item[3]}</span>`;
                resultList.appendChild(li);
            });
            
            document.getElementById('resultSection').style.display = 'block';
        }

        function goBack() {
            window.location.href = '../index.html';
        }

        // å›è½¦é”®è§¦å‘è®¡ç®—
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculate();
            }
        });
    </script>
</body>
</html>

