<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—‹é£é™¤å°˜é€‰å‹ - è®¾å¤‡å‚æ•°é€‰å‹ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../css/tool-common.css">
</head>
<body>
    <div class="tool-container">
        <div class="tool-header">
            <button class="back-btn" onclick="goBack()">â† è¿”å›</button>
            <h1>ğŸŒªï¸ æ—‹é£é™¤å°˜å™¨é€‰å‹</h1>
            <p class="subtitle">æ—‹é£é™¤å°˜å™¨å‚æ•°è®¡ç®—</p>
        </div>

        <div class="tool-content">
            <div class="input-section">
                <div class="input-group">
                    <label for="airflow">å…¥å£é£é‡ (mÂ³/h)</label>
                    <input type="number" id="airflow" placeholder="è¯·è¾“å…¥é£é‡" step="100" value="">
                </div>

                <div class="input-group">
                    <label for="velocity">å…¥å£é£é€Ÿ (m/s)</label>
                    <input type="number" id="velocity" placeholder="æ¨è12-18m/s" value="15" step="0.5" min="10" max="25">
                </div>

                <div class="input-group">
                    <label for="dustType">ç²‰å°˜ç±»å‹</label>
                    <select id="dustType">
                        <option value="light" selected>è½»è´¨ç²‰å°˜ï¼ˆæœ¨å±‘ç­‰ï¼‰</option>
                        <option value="medium">ä¸­ç­‰ç²‰å°˜ï¼ˆæ°´æ³¥ç­‰ï¼‰</option>
                        <option value="heavy">é‡è´¨ç²‰å°˜ï¼ˆé‡‘å±ç²‰ç­‰ï¼‰</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="temperature">çƒŸæ°”æ¸©åº¦ (â„ƒ)</label>
                    <input type="number" id="temperature" placeholder="å¸¸æ¸©20â„ƒ" value="20" step="5">
                </div>

                <button class="calc-btn" onclick="calculate()">ğŸ”§ è®¡ç®—é€‰å‹</button>
            </div>

            <div class="result-section" id="resultSection" style="display: none;">
                <h3>ğŸ“Š é™¤å°˜å™¨å‚æ•°</h3>
                <div class="result-item">
                    <span class="result-label">ç­’ä½“ç›´å¾„ï¼š</span>
                    <span class="result-value" id="diameter">-</span>
                    <span class="result-unit">mm</span>
                </div>
                <div class="result-item">
                    <span class="result-label">æ€»é«˜åº¦ï¼š</span>
                    <span class="result-value" id="height">-</span>
                    <span class="result-unit">m</span>
                </div>
                <div class="result-item">
                    <span class="result-label">å‹åŠ›æŸå¤±ï¼š</span>
                    <span class="result-value" id="pressureLoss">-</span>
                    <span class="result-unit">Pa</span>
                </div>
                <div class="result-item">
                    <span class="result-label">é™¤å°˜æ•ˆç‡ï¼š</span>
                    <span class="result-value" id="efficiency">-</span>
                    <span class="result-unit">%</span>
                </div>
                <div class="result-item">
                    <span class="result-label">æ¨èå‹å·ï¼š</span>
                    <span class="result-value" id="model" style="font-size: 18px;">-</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        (function() {
            const sessionInfo = sessionStorage.getItem('currentSession');
            if (!sessionInfo) {
                window.location.href = '../login.html';
            }
        })();

        function calculate() {
            const airflow = parseFloat(document.getElementById('airflow').value);
            const velocity = parseFloat(document.getElementById('velocity').value);
            const dustType = document.getElementById('dustType').value;
            const temperature = parseFloat(document.getElementById('temperature').value);

            // éªŒè¯è¾“å…¥
            if (!airflow || airflow <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é£é‡');
                return;
            }
            if (!velocity || velocity < 10 || velocity > 25) {
                alert('å…¥å£é£é€Ÿå»ºè®®åœ¨10-25m/sä¹‹é—´');
                return;
            }

            // è®¡ç®—ç­’ä½“ç›´å¾„
            // Q = v Ã— A, A = Ï€ Ã— DÂ² / 4
            // D = âˆš(4Q / (3600 Ã— Ï€ Ã— v))
            const airflowM3s = airflow / 3600; // è½¬æ¢ä¸ºmÂ³/s
            const diameter = Math.sqrt((4 * airflowM3s) / (Math.PI * velocity)) * 1000; // mm

            // æ ‡å‡†åŒ–ç›´å¾„ï¼ˆå–æ ‡å‡†å°ºå¯¸ï¼‰
            const standardDiameters = [300, 400, 500, 600, 700, 800, 900, 1000, 1200, 1400, 1600, 1800, 2000, 2200, 2400, 2600, 2800, 3000];
            const selectedDiameter = standardDiameters.find(d => d >= diameter) || standardDiameters[standardDiameters.length - 1];

            // è®¡ç®—æ€»é«˜åº¦ï¼ˆæŒ‰æ ‡å‡†æ¯”ä¾‹ H = 4Dï¼‰
            const totalHeight = (selectedDiameter * 4) / 1000; // è½¬æ¢ä¸ºç±³

            // è®¡ç®—å‹åŠ›æŸå¤±ï¼ˆç»éªŒå…¬å¼ï¼‰
            // Î”P = Î¾ Ã— Ï Ã— vÂ² / 2
            // Î¾: é˜»åŠ›ç³»æ•°ï¼ˆ8-12ï¼‰ï¼ŒÏ: ç©ºæ°”å¯†åº¦ï¼ˆ1.2kg/mÂ³ï¼‰
            let resistanceCoeff = 10;
            if (dustType === 'light') {
                resistanceCoeff = 8;
            } else if (dustType === 'heavy') {
                resistanceCoeff = 12;
            }

            // æ¸©åº¦ä¿®æ­£
            const densityCorrection = 293 / (273 + temperature);
            const pressureLoss = resistanceCoeff * 1.2 * densityCorrection * Math.pow(velocity, 2) / 2;

            // é™¤å°˜æ•ˆç‡ï¼ˆç»éªŒå€¼ï¼‰
            let efficiency = 85;
            if (dustType === 'heavy') {
                efficiency = 92;
            } else if (dustType === 'light') {
                efficiency = 78;
            }

            // æ¨èå‹å·
            const model = `CLT/A-${Math.round(selectedDiameter / 100)}`;

            // æ˜¾ç¤ºç»“æœ
            document.getElementById('diameter').textContent = selectedDiameter;
            document.getElementById('height').textContent = totalHeight.toFixed(2);
            document.getElementById('pressureLoss').textContent = Math.round(pressureLoss);
            document.getElementById('efficiency').textContent = efficiency;
            document.getElementById('model').textContent = model;
            
            document.getElementById('resultSection').style.display = 'block';
        }

        function goBack() {
            window.location.href = '../index.html';
        }

        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') calculate();
        });
    </script>
</body>
</html>

