<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸¦æ¶ç®—æ–™ - è®¾å¤‡å‚æ•°é€‰å‹ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../css/tool-common.css">
</head>
<body>
    <div class="tool-container">
        <div class="tool-header">
            <button class="back-btn" onclick="goBack()">â† è¿”å›</button>
            <h1>ğŸ“ çš®å¸¦æ”¯æ¶ç®—æ–™</h1>
            <p class="subtitle">çš®å¸¦è¾“é€æœºæ”¯æ¶ææ–™è®¡ç®—</p>
        </div>

        <div class="tool-content">
            <div class="input-section">
                <div class="input-group">
                    <label for="angle">çš®å¸¦å€¾æ–œè§’åº¦ (åº¦)</label>
                    <input type="number" id="angle" placeholder="0-45åº¦" value="0" step="1" min="0" max="45">
                </div>

                <div class="input-group">
                    <label for="width">çš®å¸¦å®½åº¦ (mm)</label>
                    <select id="width">
                        <option value="500" selected>B500</option>
                        <option value="650">B650</option>
                        <option value="800">B800</option>
                        <option value="1000">B1000</option>
                        <option value="1200">B1200</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="minHeight">æœ€ä½ç‚¹é«˜åº¦ (m)</label>
                    <input type="number" id="minHeight" placeholder="çš®å¸¦æœ€ä½ç‚¹é«˜åº¦" value="0.5" step="0.1">
                </div>

                <div class="input-group">
                    <label for="length">çš®å¸¦é•¿åº¦ (m)</label>
                    <input type="number" id="length" placeholder="è¾“é€å¸¦æ€»é•¿åº¦" value="10" step="1">
                </div>

                <div class="input-group checkbox-group">
                    <input type="checkbox" id="hasOverlap">
                    <label for="hasOverlap">æœ‰é‡å æ®µ</label>
                </div>

                <div class="input-group" id="overlapGroup" style="display: none;">
                    <label for="overlap">é‡å è·ç¦» (m)</label>
                    <input type="number" id="overlap" placeholder="é‡å æ®µè·ç¦»" value="0" step="0.1">
                </div>

                <div class="input-group" id="edgeCountGroup" style="display: none;">
                    <label for="edgeCount">æŒ¡è¾¹æ•°é‡</label>
                    <select id="edgeCount">
                        <option value="1" selected>1é“</option>
                        <option value="2">2é“</option>
                    </select>
                </div>

                <button class="calc-btn" onclick="calculate()">ğŸ”¨ è®¡ç®—ææ–™</button>
            </div>

            <div class="result-section" id="resultSection" style="display: none;">
                <h3>ğŸ“Š è®¡ç®—ç»“æœ</h3>
                <ul class="result-list" id="resultList"></ul>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        (function() {
            const sessionInfo = sessionStorage.getItem('currentSession');
            if (!sessionInfo) {
                window.location.href = '../login.html';
            }
        })();

        // åˆ‡æ¢é‡å æ®µæ§ä»¶æ˜¾ç¤º
        document.getElementById('hasOverlap').addEventListener('change', function() {
            const display = this.checked ? 'block' : 'none';
            document.getElementById('overlapGroup').style.display = display;
            document.getElementById('edgeCountGroup').style.display = display;
        });

        function calculate() {
            const angle = parseFloat(document.getElementById('angle').value);
            const width = parseInt(document.getElementById('width').value);
            const minHeight = parseFloat(document.getElementById('minHeight').value);
            const length = parseFloat(document.getElementById('length').value);
            const hasOverlap = document.getElementById('hasOverlap').checked;
            const overlap = hasOverlap ? parseFloat(document.getElementById('overlap').value) || 0 : 0;
            const edgeCount = hasOverlap ? parseInt(document.getElementById('edgeCount').value) : 0;

            // éªŒè¯è¾“å…¥
            if (angle < 0 || angle > 45) {
                alert('çš®å¸¦è§’åº¦å¿…é¡»åœ¨0-45åº¦ä¹‹é—´');
                return;
            }
            if (!minHeight || minHeight <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æœ€ä½ç‚¹é«˜åº¦');
                return;
            }
            if (!length || length <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„çš®å¸¦é•¿åº¦');
                return;
            }
            if (hasOverlap && overlap <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡å è·ç¦»');
                return;
            }

            const results = calculateBeltSupport(angle, width, minHeight, length, hasOverlap, overlap, edgeCount);
            displayResults(results, width, length, angle);
        }

        function calculateBeltSupport(angle, width, minHeight, length, hasOverlap, overlap, edgeCount) {
            const results = [];
            
            // è®¡ç®—æœ«ç«¯é«˜åº¦
            const angleRad = angle * Math.PI / 180;
            const endHeight = minHeight + length * Math.tan(angleRad);
            results.push(['çš®å¸¦æœ«ç«¯é«˜åº¦', endHeight.toFixed(2) + ' m', '', '']);
            
            // æ”¯è…¿é—´è·ï¼ˆæ ‡å‡†1.2mï¼‰
            const legSpacing = 1.2;
            const legCount = Math.ceil(length / legSpacing) + 1;
            const avgSpacing = length / (legCount - 1);
            results.push(['æ”¯è…¿å¹³å‡é—´è·', avgSpacing.toFixed(1) + ' m', '', '']);
            results.push(['æ”¯è…¿æ•°é‡', legCount + 'æ ¹', '', '']);
            
            // æ”¯è…¿è¯¦æƒ…
            let legDetails = [];
            let totalChannelSteel = 0;
            for (let i = 0; i < legCount; i++) {
                const position = i * avgSpacing;
                const legHeight = minHeight + position * Math.tan(angleRad);
                legDetails.push(`L${i + 1}=${legHeight.toFixed(2)}m`);
                totalChannelSteel += legHeight * 2; // æ¯æ ¹æ”¯è…¿2æ ¹æ§½é’¢
            }
            results.push(['æ”¯è…¿è¯¦æƒ…', legDetails.join(', '), '', '']);
            
            // æ–œæ‹‰æ†ï¼ˆæ¯æ ¹æ”¯è…¿2æ ¹ï¼‰
            const diagonalCount = legCount * 2;
            const avgDiagonalLength = Math.sqrt(Math.pow(avgSpacing, 2) + Math.pow(avgSpacing * Math.tan(angleRad), 2));
            const totalAngleIron = diagonalCount * avgDiagonalLength;
            results.push(['æ–œæ‹‰æ†æ•°é‡', diagonalCount + 'æ ¹', '', '']);
            
            // æŒ¡è¾¹æ”¯è…¿
            let edgeLegCount = 0;
            let edgeBeamLength = 0;
            if (hasOverlap && overlap > 0) {
                edgeLegCount = Math.ceil(overlap / legSpacing) + 2; // é¢å¤–2ä¸ª
                edgeBeamLength = overlap * edgeCount;
                results.push(['æŒ¡è¾¹æ”¯è…¿æ•°é‡', edgeLegCount + ' (å«é¢å¤–2ä¸ª)', '', '']);
                results.push(['æŒ¡è¾¹æ¨ªæ¢é•¿åº¦', edgeBeamLength.toFixed(2) + ' m (è§’é“)', '', '']);
            }
            
            // æ€»æ§½é’¢é•¿åº¦ï¼ˆæ”¯è…¿ + ä¸»æ¢ï¼‰
            const mainBeamLength = length * 2; // 2æ ¹ä¸»æ¢
            totalChannelSteel += mainBeamLength;
            results.push(['æ§½é’¢æ€»é•¿åº¦', totalChannelSteel.toFixed(2) + ' m', '', '']);
            
            // æ€»è§’é“é•¿åº¦
            const totalAngleIronLength = totalAngleIron + edgeBeamLength;
            results.push(['è§’é“æ€»é•¿åº¦', totalAngleIronLength.toFixed(2) + ' m', '', '']);
            
            // é‡é‡è®¡ç®—
            const channelWeight = totalChannelSteel * 8.007; // 10#æ§½é’¢
            const angleWeight = totalAngleIronLength * 2.332; // 50*5è§’é“
            const weldingRod = (channelWeight + angleWeight) * 0.015; // ç„Šæ¡1.5%
            
            results.push(['æ§½é’¢æ€»é‡é‡', channelWeight.toFixed(2) + ' kg', '', '']);
            results.push(['è§’é“æ€»é‡é‡', angleWeight.toFixed(2) + ' kg', '', '']);
            results.push(['ç„Šæ¡é¢„ä¼°ç”¨é‡', weldingRod.toFixed(2) + ' kg', '', '']);
            results.push(['é’¢ææ€»é‡é‡', (channelWeight + angleWeight).toFixed(2) + ' kg', '', '']);
            
            return results;
        }

        // è·å–çš®å¸¦ä»·æ ¼ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
        function getBeltPrice(width, length) {
            const priceTable = {
                500: 180, 650: 230, 800: 280, 1000: 380, 1200: 480
            };
            const unitPrice = priceTable[width] || 200;
            return unitPrice * length;
        }

        // è·å–çš®å¸¦åŠŸç‡
        function getBeltPower(width, length, angle) {
            const powerTable = {
                500: 1.5, 650: 2.2, 800: 3, 1000: 4, 1200: 5.5
            };
            let basePower = powerTable[width] || 3;
            
            // é•¿åº¦è°ƒæ•´
            if (width === 1000 && length > 30) {
                basePower = basePower * (length / 30);
            }
            
            // è§’åº¦è°ƒæ•´
            if (angle > 15) {
                basePower = basePower * 1.2;
            }
            
            return basePower;
        }

        function displayResults(results, width, length, angle) {
            const resultList = document.getElementById('resultList');
            resultList.innerHTML = '';
            
            // æ·»åŠ è¡¨å¤´
            const header = document.createElement('li');
            header.innerHTML = '<span>é¡¹ç›®</span><span>æ•°å€¼</span><span></span><span></span>';
            resultList.appendChild(header);
            
            // æ·»åŠ è®¡ç®—ç»“æœ
            results.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${item[0]}</span><span>${item[1]}</span><span>${item[2]}</span><span>${item[3]}</span>`;
                resultList.appendChild(li);
            });
            
            // æ·»åŠ çš®å¸¦ä»·æ ¼å’ŒåŠŸç‡
            const beltPrice = getBeltPrice(width, length);
            const beltPower = getBeltPower(width, length, angle);
            
            const priceLi = document.createElement('li');
            priceLi.innerHTML = `<span>çš®å¸¦ä»·æ ¼</span><span>ï¿¥${beltPrice.toLocaleString()}</span><span></span><span></span>`;
            resultList.appendChild(priceLi);
            
            const powerLi = document.createElement('li');
            powerLi.innerHTML = `<span>çš®å¸¦åŠŸç‡</span><span>${beltPower.toFixed(1)} KW</span><span></span><span></span>`;
            resultList.appendChild(powerLi);
            
            // åŠŸç‡è¯´æ˜
            if (angle > 15) {
                const basePower = getBeltPower(width, length, 0);
                const remarkLi = document.createElement('li');
                remarkLi.innerHTML = `<span>åŠŸç‡è¯´æ˜</span><span>å› è§’åº¦>15Â°ï¼ŒåŠŸç‡ä»${basePower.toFixed(1)}KWè°ƒæ•´ä¸º${beltPower.toFixed(1)}KW</span><span></span><span></span>`;
                resultList.appendChild(remarkLi);
            }
            
            document.getElementById('resultSection').style.display = 'block';
        }

        function goBack() {
            window.location.href = '../index.html';
        }
    </script>
</body>
</html>

