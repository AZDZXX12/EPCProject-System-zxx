<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çˆ¬æ¢¯ææ–™è¡¨ - è®¾å¤‡å‚æ•°é€‰å‹ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../css/tool-common.css">
</head>
<body>
    <div class="tool-container">
        <div class="tool-header">
            <button class="back-btn" onclick="goBack()">â† è¿”å›</button>
            <h1>ğŸªœ çˆ¬æ¢¯é’¢æç”¨é‡è®¡ç®—</h1>
            <p class="subtitle">ç¬¦åˆ GB4053.1-2009 æ ‡å‡†</p>
        </div>

        <div class="tool-content">
            <div class="input-section">
                <div class="input-group">
                    <label for="height">çˆ¬æ¢¯é«˜åº¦ (mm)</label>
                    <input type="number" id="height" placeholder="è¯·è¾“å…¥çˆ¬æ¢¯é«˜åº¦" step="1" value="">
                </div>

                <div class="input-group">
                    <label for="width">æ¢¯å®½ (mm)</label>
                    <input type="number" id="width" placeholder="æ ‡å‡†400-600mm" step="1" value="500">
                </div>

                <div class="input-group checkbox-group">
                    <input type="checkbox" id="hasCage" checked>
                    <label for="hasCage">è®¾ç½®æŠ¤ç¬¼ï¼ˆé«˜åº¦>3må¿…éœ€ï¼‰</label>
                </div>

                <button class="calc-btn" onclick="calculate()">ğŸ”¨ è®¡ç®—ææ–™</button>
            </div>

            <div class="result-section" id="resultSection" style="display: none;">
                <h3>ğŸ“Š çˆ¬æ¢¯å‚æ•°</h3>
                <div class="result-item">
                    <span class="result-label">å¹³å°æ•°é‡ï¼š</span>
                    <span class="result-value" id="platformCount">-</span>
                    <span class="result-unit">ä¸ª</span>
                </div>
                <div class="result-item">
                    <span class="result-label">å¹³å°é«˜åº¦ï¼š</span>
                    <span class="result-value" id="platformHeights" style="font-size: 16px;">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">è¸æ£é—´è·ï¼š</span>
                    <span class="result-value" id="rungSpacing">-</span>
                    <span class="result-unit">mm</span>
                </div>

                <h3>ğŸ“Š ææ–™æ˜ç»†è¡¨</h3>
                <ul class="result-list" id="resultList"></ul>
                
                <div class="result-item">
                    <span class="result-label">æ€»é‡é‡ï¼š</span>
                    <span class="result-value" id="totalWeight">-</span>
                    <span class="result-unit">kg</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        (function() {
            const sessionInfo = sessionStorage.getItem('currentSession');
            if (!sessionInfo) {
                window.location.href = '../login.html';
            }
        })();

        function calculate() {
            const height = parseFloat(document.getElementById('height').value);
            const width = parseFloat(document.getElementById('width').value);
            let hasCage = document.getElementById('hasCage').checked;

            // éªŒè¯è¾“å…¥
            if (!height || height <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„çˆ¬æ¢¯é«˜åº¦');
                return;
            }
            if (!width || width <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ¢¯å®½');
                return;
            }

            // GB4053.1-2009è¦æ±‚æ¢¯å®½åœ¨400-600mmä¹‹é—´
            if (width < 400 || width > 600) {
                if (!confirm('æ ‡å‡†GB4053.1-2009è¦æ±‚æ¢¯å®½åœ¨400-600mmä¹‹é—´ï¼Œæ˜¯å¦ç»§ç»­ä½¿ç”¨å½“å‰å€¼ï¼Ÿ')) {
                    return;
                }
            }

            // æ£€æŸ¥æŠ¤ç¬¼è¦æ±‚ï¼ˆé«˜åº¦>3må¿…é¡»è®¾ç½®ï¼‰
            if (height > 3000 && !hasCage) {
                if (confirm('æ ¹æ®GB4053.1-2009æ ‡å‡†ï¼Œçˆ¬æ¢¯é«˜åº¦è¶…è¿‡3måº”è®¾ç½®æŠ¤ç¬¼ï¼\næ˜¯å¦è¦æ·»åŠ æŠ¤ç¬¼ï¼Ÿ')) {
                    hasCage = true;
                    document.getElementById('hasCage').checked = true;
                }
            }

            // è®¡ç®—å¹³å°æ•°é‡ï¼ˆæ¯6mä¸€ä¸ªï¼‰
            const platformCount = Math.floor(height / 6000);
            document.getElementById('platformCount').textContent = platformCount;

            // è®¡ç®—å¹³å°é«˜åº¦
            if (platformCount > 0) {
                const heights = [];
                for (let i = 1; i <= platformCount; i++) {
                    heights.push((i * 6).toFixed(1) + 'm');
                }
                document.getElementById('platformHeights').textContent = heights.join(', ');
            } else {
                document.getElementById('platformHeights').textContent = 'æ— ';
            }

            // è®¡ç®—è¸æ£é—´è·ï¼ˆGB4053.1-2009æ ‡å‡†ï¼š250-300mmï¼‰
            const rungSpacing = 300; // æ ‡å‡†é—´è·
            document.getElementById('rungSpacing').textContent = rungSpacing;

            // è®¡ç®—ææ–™
            const materials = calculateMaterials(height, width, hasCage, platformCount);
            displayResults(materials);
        }

        function calculateMaterials(height, width, hasCage, platformCount) {
            const results = [];
            const heightM = height / 1000;
            const widthM = width / 1000;
            
            // è¸æ£æ•°é‡ï¼ˆé—´è·300mmï¼‰
            const rungCount = Math.ceil(height / 300);
            const rungWeight = rungCount * widthM * 1.58; // Î¦25åœ†é’¢1.58kg/m
            results.push(['è¸æ£', 'Î¦25åœ†é’¢', rungCount + 'æ ¹ Ã— ' + widthM.toFixed(2) + 'm', rungWeight.toFixed(2) + ' kg']);
            
            // ä¸»ç«‹æŸ±ï¼ˆ2æ ¹ï¼‰
            const columnWeight = 2 * heightM * 5.42; // 40*60*3æ–¹ç®¡
            results.push(['ä¸»ç«‹æŸ±', '40*60*3æ–¹ç®¡', '2æ ¹ Ã— ' + heightM.toFixed(2) + 'm', columnWeight.toFixed(2) + ' kg']);
            
            // æŠ¤ç¬¼ææ–™
            let cageWeight = 0;
            if (hasCage) {
                // æŠ¤ç¬¼åœ†ç¯ï¼ˆÎ¦800mmï¼Œé—´è·600mmï¼‰
                const cageRingCount = Math.ceil((height - 2000) / 600); // ä»2må¼€å§‹è®¾ç½®
                const cageRingLength = cageRingCount * Math.PI * 0.8; // å‘¨é•¿
                cageWeight = cageRingLength * 1.58; // Î¦25åœ†é’¢
                results.push(['æŠ¤ç¬¼åœ†ç¯', 'Î¦25åœ†é’¢ Î¦800mm', cageRingCount + 'ä¸ª', cageWeight.toFixed(2) + ' kg']);
                
                // æŠ¤ç¬¼ç«–æ†ï¼ˆ6æ ¹ï¼‰
                const verticalRodLength = 6 * (heightM - 2); // ä»2må¼€å§‹
                const verticalRodWeight = verticalRodLength * 1.21; // Î¦20åœ†é’¢
                cageWeight += verticalRodWeight;
                results.push(['æŠ¤ç¬¼ç«–æ†', 'Î¦20åœ†é’¢', '6æ ¹ Ã— ' + (heightM - 2).toFixed(2) + 'm', verticalRodWeight.toFixed(2) + ' kg']);
            }
            
            // å¹³å°ææ–™ï¼ˆå¦‚æœæœ‰ï¼‰
            let platformWeight = 0;
            if (platformCount > 0) {
                // æ¯ä¸ªå¹³å°ï¼š1mÃ—0.8m
                const platformArea = platformCount * 1.0 * 0.8;
                platformWeight = platformArea * 0.005 * 7850; // 5mmèŠ±çº¹æ¿
                results.push(['å¹³å°æ¿', '5mmèŠ±çº¹æ¿', platformCount + 'ä¸ª (1mÃ—0.8m)', platformWeight.toFixed(2) + ' kg']);
                
                // å¹³å°æ¡†æ¶
                const frameLength = platformCount * ((1.0 + 0.8) * 2);
                const frameWeight = frameLength * 3.52; // 40*40*3æ–¹ç®¡
                platformWeight += frameWeight;
                results.push(['å¹³å°æ¡†æ¶', '40*40*3æ–¹ç®¡', frameLength.toFixed(2) + ' m', frameWeight.toFixed(2) + ' kg']);
            }
            
            // ç„Šæ¡ä¼°ç®—
            const weldingRodWeight = (rungWeight + columnWeight + cageWeight + platformWeight) * 0.02;
            results.push(['ç„Šæ¡', 'ä¼°ç®—ç”¨é‡', '', weldingRodWeight.toFixed(2) + ' kg']);
            
            // æ€»é‡é‡
            const totalWeight = rungWeight + columnWeight + cageWeight + platformWeight + weldingRodWeight;
            
            return {materials: results, totalWeight: totalWeight};
        }

        function displayResults(data) {
            const resultList = document.getElementById('resultList');
            resultList.innerHTML = '';
            
            // æ·»åŠ è¡¨å¤´
            const header = document.createElement('li');
            header.innerHTML = '<span>ææ–™åç§°</span><span>è§„æ ¼å‹å·</span><span>æ•°é‡</span><span>é‡é‡</span>';
            resultList.appendChild(header);
            
            // æ·»åŠ æ•°æ®
            data.materials.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${item[0]}</span><span>${item[1]}</span><span>${item[2]}</span><span>${item[3]}</span>`;
                resultList.appendChild(li);
            });
            
            document.getElementById('totalWeight').textContent = data.totalWeight.toFixed(2);
            document.getElementById('resultSection').style.display = 'block';
        }

        function goBack() {
            window.location.href = '../index.html';
        }

        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') calculate();
        });
    </script>
</body>
</html>

