<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çº¿ç¼†é€‰å‹æ¨è - è®¾å¤‡å‚æ•°é€‰å‹ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../css/tool-common.css">
</head>
<body>
    <div class="tool-container">
        <div class="tool-header">
            <button class="back-btn" onclick="goBack()">â† è¿”å›</button>
            <h1>âš¡ çº¿ç¼†é€‰å‹æ¨è</h1>
            <p class="subtitle">ç”µç¼†æˆªé¢ç§¯æ™ºèƒ½è®¡ç®—</p>
        </div>

        <div class="tool-content">
            <div class="input-section">
                <div class="input-group">
                    <label for="cableLength">ç”µç¼†é•¿åº¦ (m)</label>
                    <input type="number" id="cableLength" placeholder="è¯·è¾“å…¥ç”µç¼†é•¿åº¦" step="1" value="">
                </div>

                <div class="input-group">
                    <label for="motorPower">ç”µæœºåŠŸç‡ (kW)</label>
                    <select id="motorPower">
                        <option value="">è¯·é€‰æ‹©ç”µæœºåŠŸç‡</option>
                        <option value="0.75">0.75</option>
                        <option value="1.1">1.1</option>
                        <option value="1.5">1.5</option>
                        <option value="2.2">2.2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5.5">5.5</option>
                        <option value="7.5">7.5</option>
                        <option value="11">11</option>
                        <option value="15">15</option>
                        <option value="18.5">18.5</option>
                        <option value="22">22</option>
                        <option value="30">30</option>
                        <option value="37">37</option>
                        <option value="45">45</option>
                        <option value="55">55</option>
                        <option value="75">75</option>
                        <option value="90">90</option>
                        <option value="110">110</option>
                        <option value="132">132</option>
                        <option value="160">160</option>
                        <option value="200">200</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="voltage">ç”µå‹ (kV)</label>
                    <select id="voltage">
                        <option value="0.6" selected>0.6kV (ä½å‹)</option>
                        <option value="6">6kV (é«˜å‹)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="startMethod">å¯åŠ¨æ–¹å¼</label>
                    <select id="startMethod">
                        <option value="direct" selected>ç›´æ¥å¯åŠ¨</option>
                        <option value="star-delta">æ˜Ÿä¸‰è§’å¯åŠ¨</option>
                        <option value="vfd">å˜é¢‘å¯åŠ¨</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="installType">å®‰è£…æ–¹å¼</label>
                    <select id="installType">
                        <option value="bridge" selected>æ¡¥æ¶é“ºè®¾</option>
                        <option value="pipe-steel">ç©¿çº¿ç®¡-é’¢</option>
                        <option value="pipe-pvc">ç©¿çº¿ç®¡-èƒ¶</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="coreType">èŠ¯æ•°</label>
                    <select id="coreType">
                        <option value="1">1èŠ¯</option>
                        <option value="2">2èŠ¯</option>
                        <option value="3" selected>3èŠ¯</option>
                        <option value="4">4èŠ¯</option>
                        <option value="5">5èŠ¯</option>
                        <option value="31">3+1èŠ¯</option>
                        <option value="32">3+2èŠ¯</option>
                        <option value="41">4+1èŠ¯</option>
                    </select>
                </div>

                <button class="calc-btn" onclick="calculate()">ğŸ”Œ è®¡ç®—çº¿ç¼†</button>
            </div>

            <div class="result-section" id="resultSection" style="display: none;">
                <h3>ğŸ“Š æ¨èçº¿ç¼†</h3>
                <div class="result-item">
                    <span class="result-label">æ¨èå‹å·ï¼š</span>
                    <span class="result-value" id="cableModel" style="font-size: 20px;">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">é¢å®šç”µæµï¼š</span>
                    <span class="result-value" id="current">-</span>
                    <span class="result-unit">A</span>
                </div>
                <div class="result-item">
                    <span class="result-label">å®‰å…¨è½½æµï¼š</span>
                    <span class="result-value" id="safeCurrent">-</span>
                    <span class="result-unit">A</span>
                </div>
                <div class="result-item" id="remarkItem" style="display: none;">
                    <span class="result-label">å¤‡æ³¨ï¼š</span>
                    <span class="result-value" id="remark" style="font-size: 14px; color: #ff9800;">-</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        (function() {
            const sessionInfo = sessionStorage.getItem('currentSession');
            if (!sessionInfo) {
                window.location.href = '../login.html';
            }
        })();

        function calculate() {
            const cableLength = parseFloat(document.getElementById('cableLength').value);
            const motorPower = parseFloat(document.getElementById('motorPower').value);
            const voltage = parseFloat(document.getElementById('voltage').value);
            const startMethod = document.getElementById('startMethod').value;
            const installType = document.getElementById('installType').value;
            const coreType = parseInt(document.getElementById('coreType').value);

            // éªŒè¯è¾“å…¥
            if (!cableLength || cableLength <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç”µç¼†é•¿åº¦');
                return;
            }
            if (!motorPower) {
                alert('è¯·é€‰æ‹©ç”µæœºåŠŸç‡');
                return;
            }

            // è®¡ç®—é¢å®šç”µæµ
            let ratedCurrent;
            if (voltage === 0.6) {
                // ä½å‹: I = P / (âˆš3 Ã— U Ã— cosÏ†)
                // cosÏ†å–0.85ï¼Œæ•ˆç‡å–0.9
                ratedCurrent = motorPower / (Math.sqrt(3) * 0.38 * 0.85 * 0.9);
            } else {
                // é«˜å‹6kV
                ratedCurrent = motorPower / (Math.sqrt(3) * 6 * 0.85 * 0.9);
            }

            // å¯åŠ¨ç”µæµç³»æ•°
            let startCoeff = 1.0;
            if (startMethod === 'direct') {
                startCoeff = 1.5; // ç›´æ¥å¯åŠ¨å†²å‡»å¤§
            } else if (startMethod === 'star-delta') {
                startCoeff = 1.2;
            } else {
                startCoeff = 1.1; // å˜é¢‘å¯åŠ¨æœ€å°
            }

            // å®‰è£…æ–¹å¼é™å®¹ç³»æ•°
            let installCoeff = 1.0;
            if (installType === 'pipe-steel') {
                installCoeff = 0.85;
            } else if (installType === 'pipe-pvc') {
                installCoeff = 0.8;
            }

            // è®¡ç®—æ‰€éœ€ç”µæµï¼ˆè€ƒè™‘è£•é‡1.25å€ï¼‰
            const requiredCurrent = ratedCurrent * startCoeff * 1.25 / installCoeff;

            // é€‰æ‹©ç”µç¼†æˆªé¢
            const cableSelection = selectCable(requiredCurrent, voltage, coreType, cableLength);

            // æ˜¾ç¤ºç»“æœ
            displayResult(cableSelection, ratedCurrent, requiredCurrent);
        }

        function selectCable(current, voltage, coreType, length) {
            // é“œèŠ¯ç”µç¼†è½½æµé‡å‚è€ƒè¡¨ (YJVç”µç¼†)
            const cableData = [
                {section: 1.5, current: 18},
                {section: 2.5, current: 26},
                {section: 4, current: 35},
                {section: 6, current: 45},
                {section: 10, current: 65},
                {section: 16, current: 85},
                {section: 25, current: 110},
                {section: 35, current: 140},
                {section: 50, current: 180},
                {section: 70, current: 225},
                {section: 95, current: 270},
                {section: 120, current: 320},
                {section: 150, current: 365},
                {section: 185, current: 420},
                {section: 240, current: 500}
            ];

            // æŸ¥æ‰¾åˆé€‚çš„æˆªé¢
            let selected = cableData.find(cable => cable.current >= current);
            if (!selected) {
                selected = cableData[cableData.length - 1];
            }

            // ç”µå‹é™æ ¡éªŒï¼ˆé•¿è·ç¦»éœ€è¦æ”¾å¤§æˆªé¢ï¼‰
            if (length > 100) {
                const voltageDrop = (2 * length * current * 0.0175) / (selected.section);
                if (voltage === 0.6 && voltageDrop > 20) { // å…è®¸å‹é™5%
                    // éœ€è¦æ”¾å¤§æˆªé¢
                    const minSection = (2 * length * current * 0.0175) / 20;
                    selected = cableData.find(cable => cable.section >= minSection) || selected;
                }
            }

            // æ„å»ºç”µç¼†å‹å·
            let coreDesc;
            if (coreType === 1) coreDesc = '1Ã—';
            else if (coreType === 2) coreDesc = '2Ã—';
            else if (coreType === 3) coreDesc = '3Ã—';
            else if (coreType === 4) coreDesc = '4Ã—';
            else if (coreType === 5) coreDesc = '5Ã—';
            else if (coreType === 31) coreDesc = '3Ã—' + selected.section + '+1Ã—';
            else if (coreType === 32) coreDesc = '3Ã—' + selected.section + '+2Ã—';
            else if (coreType === 41) coreDesc = '4Ã—' + selected.section + '+1Ã—';

            const voltageType = voltage === 0.6 ? 'YJV-0.6/1kV' : 'YJV-6/10kV';
            const cableModel = `${voltageType} ${coreDesc}${selected.section}mmÂ²`;

            return {
                model: cableModel,
                section: selected.section,
                safeCurrent: selected.current,
                needUpgrade: length > 100
            };
        }

        function displayResult(cable, ratedCurrent, requiredCurrent) {
            document.getElementById('cableModel').textContent = cable.model;
            document.getElementById('current').textContent = ratedCurrent.toFixed(1);
            document.getElementById('safeCurrent').textContent = cable.safeCurrent;

            if (cable.needUpgrade) {
                document.getElementById('remark').textContent = 'é•¿è·ç¦»è¾“ç”µï¼Œå·²è€ƒè™‘å‹é™ï¼Œæˆªé¢å·²é€‚å½“æ”¾å¤§';
                document.getElementById('remarkItem').style.display = 'flex';
            } else {
                document.getElementById('remarkItem').style.display = 'none';
            }

            document.getElementById('resultSection').style.display = 'block';
        }

        function goBack() {
            window.location.href = '../index.html';
        }
    </script>
</body>
</html>

