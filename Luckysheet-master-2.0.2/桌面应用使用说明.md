# 📱 Luckysheet 选型系统 - 桌面应用使用说明

## 🎉 更新内容

**重要更新**：已解决电缆选型工具在桌面版中无法使用的问题！

现在**所有功能**都已集成到桌面应用中，包括：
- ✅ 主页面（设备参数选型）
- ✅ Word 文档编辑器
- ✅ 离心风机选型工具
- ✅ **电缆选型工具（React版）** ← 新增支持！
- ✅ **YJV电缆数据表** ← 新增支持！

## 🚀 快速启动

### 开发模式（推荐调试使用）

```bash
npm run electron-dev
```

**特点**：
- 自动打开开发者工具（DevTools）
- 可以查看控制台日志
- 支持实时调试

### 普通模式

```bash
npm start
# 或
npm run electron
```

**特点**：
- 不打开开发者工具
- 更接近最终用户体验
- 可按 F12 手动打开DevTools

## 🔧 技术原理

### 内置 HTTP 服务器

桌面应用启动时会自动运行一个本地HTTP服务器：

```
✅ HTTP服务器已启动: http://localhost:8765
```

这样做的好处：
1. **解决了React应用的运行问题**（电缆选型工具使用Vite构建，需要HTTP协议）
2. **统一的资源加载方式**（所有页面都通过HTTP访问）
3. **避免了file://协议的限制**（CORS、模块加载等问题）

### 工具窗口打开方式

所有辅助工具都会在**新窗口**中打开：

| 工具 | 按钮位置 | 窗口大小 | 说明 |
|------|---------|---------|------|
| Word编辑器 | 左侧工具栏 | 1200×800 | 文档编辑 |
| 离心风机选型 | 左侧工具栏 | 1600×1000 | 风机计算 |
| 电缆选型工具 | 左侧工具栏 | 1600×1000 | React版，智能选型 |
| YJV数据表 | 左侧工具栏 | 1600×1000 | 电缆参数查询 |

**注意**：所有新窗口都是独立的，关闭后不影响主窗口。

## 🎯 常见操作

### 查看控制台日志

开发模式下，控制台会显示详细的日志信息：

```
✅ HTTP服务器已启动: http://localhost:8765
✅ Electron内置HTTP服务器运行中，所有功能正常。
✅ jQuery 已注册到全局: 2.2.4
✅ 所有核心库加载完成
✅ 设备数据库模块已加载
✅ 电缆选型工具打开功能已初始化（React版，Electron内置HTTP服务器）
```

这些日志帮助你了解应用的运行状态。

### 刷新页面

如果页面出现问题，可以使用以下快捷键：

- **Ctrl+R**（Windows/Linux）或 **Cmd+R**（Mac）：刷新当前页面
- **Ctrl+Shift+R** / **Cmd+Shift+R**：强制重新加载整个应用
- **F12**：打开/关闭开发者工具
- **F11**：全屏/退出全屏

### 修改代码后重新加载

如果你修改了 `dist-refactored` 目录下的文件：

1. 保存文件
2. 在应用中按 **Ctrl+Shift+R** 强制刷新
3. 查看控制台确认更新已生效

## 📦 打包成安装程序

### Windows 安装包

```bash
npm run dist:win
```

生成的文件在 `release/` 目录：
- `Luckysheet选型系统-1.0.0-x64.exe` - 64位安装程序
- 双击安装即可

### 测试打包（不生成安装程序）

```bash
npm run pack
```

这会创建一个未打包的应用目录，用于测试打包后的效果。

### 所有平台

```bash
npm run dist
```

会根据配置生成所有平台的安装包（需要相应的构建环境）。

## ⚠️ 注意事项

### 1. 端口占用

应用使用 **8765** 端口作为内置HTTP服务器。

如果端口被占用，应用可能无法启动。解决方法：
- 检查是否有其他程序占用8765端口
- 关闭占用端口的程序
- 或修改 `main.js` 中的 `HTTP_PORT` 常量

### 2. 防火墙提示

Windows可能会弹出防火墙提示：
```
Windows 安全警报
Windows 防火墙已阻止此应用的某些功能
```

这是正常的，因为应用启动了HTTP服务器。
- **安全性**：服务器只监听 `localhost`，外部网络无法访问
- **建议**：点击"允许访问"即可

### 3. 启动延迟

应用启动时会有约 **500ms** 的延迟，这是为了等待HTTP服务器启动完成。

控制台会显示：
```
✅ HTTP服务器已启动: http://localhost:8765
```

看到这条消息后，窗口才会显示。

## 🐛 故障排查

### 问题1：应用无法启动

**可能原因**：
- Node.js 未安装或版本过低
- 依赖包未安装

**解决方法**：
```bash
# 检查 Node.js 版本（需要 12.0.0 以上）
node -v

# 重新安装依赖
npm install

# 清除缓存后重装
npm cache clean --force
npm install
```

### 问题2：电缆选型工具打不开

**可能原因**：
- HTTP服务器未启动
- 端口被占用

**解决方法**：
1. 打开开发者工具（F12）
2. 查看控制台是否有错误
3. 确认是否看到 "✅ HTTP服务器已启动" 消息
4. 检查8765端口是否被占用

### 问题3：页面显示空白

**可能原因**：
- 资源加载失败
- JavaScript错误

**解决方法**：
1. 按 F12 打开开发者工具
2. 查看 Console 标签页的错误信息
3. 查看 Network 标签页确认资源是否加载成功
4. 尝试按 Ctrl+Shift+R 强制刷新

### 问题4：显示"file://"协议警告

**正常情况**：
- 在 Electron 中不应该显示此警告
- 控制台应显示 "✅ Electron内置HTTP服务器运行中"

**如果显示警告**：
- 检查 `main.js` 是否正确修改
- 确认使用的是 `loadURL()` 而不是 `loadFile()`
- 查看是否有报错信息

## 📊 性能优化建议

### 1. 数据库缓存

应用会自动缓存设备数据库到 localStorage：
```javascript
✅ 数据库已从缓存恢复
```

如需清除缓存：
1. 打开开发者工具（F12）
2. 在 Console 中执行：`localStorage.clear()`
3. 刷新页面

### 2. 内存管理

如果应用运行缓慢：
- 关闭不需要的工具窗口
- 按 Ctrl+Shift+R 重新加载应用
- 重启 Electron 应用

## 🔒 安全性

### 内置HTTP服务器安全性

- ✅ **仅本地访问**：只监听 `localhost`，外网无法访问
- ✅ **路径检查**：防止目录遍历攻击
- ✅ **无持久化**：关闭应用后服务器立即停止
- ✅ **无敏感数据**：仅服务静态资源文件

### Electron 安全配置

开发模式下的安全警告：
```
Electron Security Warning (Disabled webSecurity)
```

这是开发模式的正常警告，**打包后会自动消失**。

## 📝 更新日志

### v1.0.2 (2025-10-15)

**新增**：
- ✅ 内置HTTP服务器支持
- ✅ 电缆选型工具（React版）集成
- ✅ YJV电缆数据表集成

**优化**：
- ✅ 统一资源加载方式（HTTP协议）
- ✅ 改进工具窗口打开逻辑
- ✅ 更好的环境检测（Electron vs 浏览器）

**修复**：
- ✅ 解决React应用无法在桌面版运行的问题
- ✅ 修复file://协议限制导致的功能异常

---

## 💡 提示

**最佳实践**：
1. 开发/调试时使用 `npm run electron-dev`
2. 测试用户体验时使用 `npm start`
3. 发布前使用 `npm run pack` 测试打包效果
4. 确认无误后使用 `npm run dist:win` 生成安装包

**获取帮助**：
- 查看控制台日志（F12 → Console）
- 检查网络请求（F12 → Network）
- 阅读 `ELECTRON_HTTP_SERVER_UPDATE.md` 了解技术细节

**祝使用愉快！** 🎉

