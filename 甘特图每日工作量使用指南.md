# 甘特图每日工作量功能 - 完整使用指南

## ⚠️ 重要提示

**每日工作量功能已经完整实现！** 如果您在浏览器中没有看到效果，请按照以下步骤操作：

### 🔄 强制刷新步骤：

1. **清空浏览器缓存**：
   - 按 `Ctrl + Shift + Delete`
   - 选择"缓存的图片和文件"
   - 点击"清除数据"

2. **硬刷新页面**：
   - 按 `Ctrl + F5` （Windows）
   - 或 `Ctrl + Shift + R`

3. **重新访问**：
   - 关闭所有浏览器标签
   - 重新打开 http://localhost:3000
   - 进入"施工进度甘特图"页面

---

## 📊 功能说明

### 什么是每日工作量？

每日工作量功能允许您在甘特图上追踪每个任务**每一天**的具体工作内容，包括：
- 🏭 **设备信息** - 当天作业的设备编号/名称
- 📝 **工作内容** - 具体的施工内容
- 👷 **工人数量** - 参与施工的工人数
- ⏱️ **工作小时数** - 实际工作时长
- ✅ **完成状态** - 该日工作是否完成

---

## 🎯 视觉效果

### 在甘特图上的显示

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
任务条示例：

┌──────────────────────────────────────┐
│  反应釜主体吊装          85%          │
│  🟢 🟢 🟢 🟢 🟡                      │ ← 每日工作标记
└──────────────────────────────────────┘
   ↑  ↑  ↑  ↑  ↑
  25日 26日 27日 28日 29日

🟢 绿色圆点 = 该日工作已完成
🟡 黄色圆点 = 该日工作未完成/进行中
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 每日工作的标记规则

| 标记颜色 | 含义 | 说明 |
|---------|------|------|
| 🟢 **绿色** | 已完成 | 该天的工作已经完成 |
| 🟡 **黄色** | 未完成 | 该天的工作正在进行或尚未开始 |

---

## 💻 如何使用

### 步骤1：查看甘特图

1. 打开系统首页
2. 点击左侧菜单"进度甘特图"
3. 查看任务条上的彩色圆点

### 步骤2：查看每日明细

1. **点击**任意任务条
2. 右侧会弹出详情面板
3. 显示该任务的每日工作列表

### 步骤3：查看工作详情

详情面板包含以下信息：

| 列名 | 说明 | 示例 |
|------|------|------|
| 日期 | 工作日期 | 2024-01-25 |
| 设备 | 作业设备 | R-001反应釜 |
| 工作内容 | 具体工作 | 吊装准备 |
| 工人数 | 参与人数 | 12人 |
| 工时 | 工作时长 | 8小时 |
| 状态 | 完成情况 | 已完成/未完成 |

### 步骤4：关闭详情

- 点击详情面板右上角的"关闭"按钮
- 或者点击其他任务条切换显示

---

## 📝 实际案例

### 案例1：反应釜主体吊装

**任务信息**：
- 任务名称：反应釜主体吊装
- 开始日期：2024-01-25
- 结束日期：2024-02-10
- 总进度：85%
- 负责人：李队长

**每日工作明细**：

| 日期 | 设备 | 工作内容 | 工人 | 工时 | 状态 |
|------|------|----------|------|------|------|
| 2024-01-25 | R-001反应釜 | 吊装准备 | 12人 | 8h | ✅ 已完成 |
| 2024-01-26 | R-001反应釜 | 主体吊装 | 15人 | 10h | ✅ 已完成 |
| 2024-01-27 | R-001反应釜 | 就位调整 | 10人 | 8h | ✅ 已完成 |
| 2024-01-28 | R-001反应釜 | 固定焊接 | 8人 | 8h | ✅ 已完成 |
| 2024-01-29 | R-001反应釜 | 固定焊接 | 8人 | 8h | ⚠️ 未完成 |

**在甘特图上显示**：
```
反应釜主体吊装 [━━━━━━━━━━━━━━━━━━] 85%
                🟢🟢🟢🟢🟡
```

### 案例2：换热器组安装（多设备）

**任务信息**：
- 任务名称：换热器组安装
- 涉及设备：H-001、H-002两台换热器

**每日工作明细**：

| 日期 | 设备 | 工作内容 | 工人 | 工时 | 状态 |
|------|------|----------|------|------|------|
| 2024-01-20 | **H-001**换热器 | 设备检查 | 4人 | 6h | ✅ 已完成 |
| 2024-01-21 | **H-001**换热器 | 基础准备 | 6人 | 8h | ✅ 已完成 |
| 2024-01-22 | **H-002**换热器 | 设备检查 | 4人 | 6h | ✅ 已完成 |
| 2024-01-23 | **H-002**换热器 | 基础准备 | 6人 | 8h | ✅ 已完成 |
| 2024-01-24 | **H-001**换热器 | 吊装安装 | 10人 | 8h | ⚠️ 未完成 |

**在甘特图上显示**：
```
换热器组安装 [━━━━━━━━━━━━━] 70%
              🟢🟢🟢🟢🟡
```

---

## 🔍 常见问题

### Q1: 为什么我看不到彩色圆点？

**答**：请检查以下几点：
1. 是否清空了浏览器缓存？（Ctrl + Shift + Delete）
2. 是否硬刷新了页面？（Ctrl + F5）
3. 是否在"施工进度甘特图"页面？（不是"进度甘特图"）
4. 任务是否包含每日工作数据？（演示数据已包含）

### Q2: 点击任务条没有反应？

**答**：
1. 确保点击的是任务条本身（彩色进度条区域）
2. 右侧应该会弹出详情面板
3. 如果没有反应，请刷新页面重试

### Q3: 详情面板显示为空？

**答**：
1. 演示数据中的前4个任务都包含每日工作
2. 如果为空，说明该任务没有每日工作数据
3. 后续可以通过API添加每日工作数据

### Q4: 如何添加新的每日工作？

**答**：当前版本使用演示数据，需要后续版本开发以下功能：
- 每日工作编辑界面
- 与后端API对接
- 支持在线添加/修改

---

## 💡 应用场景

### 场景1：设备安装进度追踪

**需求**：追踪多台设备的安装进度

**解决方案**：
- 创建设备安装任务
- 每天记录各设备的工作内容
- 通过甘特图直观查看进度

**示例**：
```
任务：化工装置设备安装
├─ Day 1: R-001反应釜 - 设备检查 ✅
├─ Day 2: R-001反应釜 - 基础施工 ✅
├─ Day 3: H-001换热器 - 设备检查 ✅
├─ Day 4: H-001换热器 - 吊装就位 ⚠️
└─ Day 5: P-001管道 - 预制加工 ⏳
```

### 场景2：工时统计

**需求**：统计项目总工时和人工成本

**解决方案**：
- 每日记录工人数和工作小时
- 系统自动汇总总工时
- 计算人工成本

**示例**：
```
反应釜吊装任务：
- 总工时：12人×8h + 15人×10h + 10人×8h + 8人×8h + 8人×8h = 408人时
- 人工单价：¥100/人时
- 总成本：¥40,800
```

### 场景3：质量追溯

**需求**：出现质量问题时快速定位

**解决方案**：
- 详细记录每天的工作内容
- 包含操作人员、设备、时间
- 出问题时可追溯到具体某天某人

**示例**：
```
问题：反应釜焊接处发现裂纹
追溯：
- 查看甘特图 → 点击"固定焊接"任务
- 查看每日明细 → 找到1月28日
- 详情：8名工人，8小时，已完成
- 进一步调查当天的焊接工艺和人员
```

---

## 📈 数据结构

### 任务数据（Task）

```typescript
interface Task {
  id: string;                    // 任务ID，例如：'T-002'
  name: string;                  // 任务名称
  start_date: string;            // 开始日期 'YYYY-MM-DD'
  end_date: string;              // 结束日期 'YYYY-MM-DD'
  progress: number;              // 总进度 0-100
  dependencies: string[];        // 依赖任务ID列表
  assignee: string;              // 负责人
  status: string;                // 状态：completed/in_progress/pending
  priority: string;              // 优先级：critical/high/medium/low
  daily_workload?: DailyWork[];  // ⭐ 每日工作量数组
}
```

### 每日工作（DailyWork）

```typescript
interface DailyWork {
  date: string;         // 工作日期 'YYYY-MM-DD'
  device: string;       // 设备编号/名称，例如：'R-001反应釜'
  work_content: string; // 工作内容，例如：'吊装准备'
  workers: number;      // 工人数量
  hours: number;        // 工作小时数
  completed: boolean;   // 是否已完成 true/false
}
```

### 示例JSON

```json
{
  "id": "T-002",
  "name": "反应釜主体吊装",
  "start_date": "2024-01-25",
  "end_date": "2024-02-10",
  "progress": 85,
  "assignee": "李队长",
  "status": "in_progress",
  "priority": "critical",
  "daily_workload": [
    {
      "date": "2024-01-25",
      "device": "R-001反应釜",
      "work_content": "吊装准备",
      "workers": 12,
      "hours": 8,
      "completed": true
    },
    {
      "date": "2024-01-26",
      "device": "R-001反应釜",
      "work_content": "主体吊装",
      "workers": 15,
      "hours": 10,
      "completed": true
    }
  ]
}
```

---

## 🚀 技术实现

### Canvas绘制

每日工作在甘特图上的圆点使用Canvas API绘制：

```typescript
// 绘制每日工作量标记
if (task.daily_workload && task.daily_workload.length > 0) {
  task.daily_workload.forEach(daily => {
    // 计算圆点位置
    const workDate = new Date(daily.date);
    const workDiff = Math.ceil((workDate.getTime() - minDate.getTime()) / (1000 * 60 * 60 * 24));
    const workX = chartStartX + workDiff * dayWidth + dayWidth / 2;
    
    // 绘制圆点
    const dotSize = Math.min(dayWidth * 0.4, 8);
    ctx.beginPath();
    ctx.arc(workX, barY + barHeight / 2, dotSize, 0, Math.PI * 2);
    
    // 根据完成状态设置颜色
    ctx.fillStyle = daily.completed ? '#52c41a' : '#faad14';  // 绿色/黄色
    ctx.fill();
    
    // 白色边框
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 1;
    ctx.stroke();
  });
}
```

### 详情面板

点击任务后显示详情：

```typescript
// 点击事件处理
onClick={(e) => {
  const rect = canvasRef.current?.getBoundingClientRect();
  const y = e.clientY - rect.top;
  const taskIndex = Math.floor((y - 120) / 50);  // 计算点击的任务索引
  if (taskIndex >= 0 && taskIndex < filteredTasks.length) {
    setSelectedTask(filteredTasks[taskIndex]);  // 设置选中任务
  }
}}

// 详情面板渲染
{selectedTask && selectedTask.daily_workload && (
  <Card title={`${selectedTask.name} - 每日工作明细`}>
    <Table
      dataSource={selectedTask.daily_workload}
      columns={dailyWorkColumns}
    />
  </Card>
)}
```

---

## 📌 图例说明

### 甘特图图例

| 符号/颜色 | 含义 | 说明 |
|----------|------|------|
| 🟢 绿色圆点 | 已完成 | 该天的工作已经完成 |
| 🟡 黄色圆点 | 未完成 | 该天的工作未完成或进行中 |
| 🔴 红色小点 | 关键任务 | 优先级为critical的任务 |
| 📍 红色虚线 | 今日标记 | 当前日期位置 |
| ━ 蓝色进度条 | 进行中 | 任务正在进行 |
| ━ 绿色进度条 | 已完成 | 任务已完成 |
| ━ 橙色进度条 | 待开始 | 任务尚未开始 |

---

## 🎓 最佳实践

### 1. 及时记录

每天下班前记录当日工作，确保数据准确。

### 2. 详细描述

工作内容应具体明确，便于后续追溯。

### 3. 真实数据

工人数和工时应如实填写，用于成本核算。

### 4. 状态更新

及时更新完成状态，保持进度准确性。

### 5. 设备编号规范

统一设备编号格式，例如：R-001、H-002、P-003

---

## 📞 技术支持

### 如遇问题，请检查：

1. ✅ 浏览器是否已清空缓存
2. ✅ 页面是否已硬刷新（Ctrl+F5）
3. ✅ 前端服务是否正常运行
4. ✅ 是否在正确的甘特图页面

### 浏览器要求：

- ✅ Chrome 90+
- ✅ Edge 90+
- ✅ Firefox 88+
- ⚠️ IE不支持

---

**文档版本**：v1.2.0  
**最后更新**：2025-01-17  
**作者**：开发团队

**如果看到这个文档，每日工作量功能已经完全实现！请清空浏览器缓存并刷新页面查看效果。**

