# 甘特图每日工作量功能说明

## 📋 功能概述

甘特图现已升级，支持**每日工作量**详细追踪。每个任务可以记录每天的具体工作内容，包括设备、工作项、工人数、工时等信息。

---

## ✨ 主要特性

### 1. **每日工作标记** 🟢🟡
在甘特图的任务条上，每天的工作会用彩色圆点标记：
- **绿色圆点 🟢** - 该日工作已完成
- **黄色圆点 🟡** - 该日工作未完成或进行中

### 2. **设备安装追踪** 🏭
每个任务可以包含多个设备的安装工作，每台设备每天的工作都单独记录。

**示例：**
- 任务：反应釜基础施工
  - 2024-01-05：R-001反应釜 - 基坑开挖
  - 2024-01-06：R-001反应釜 - 基坑开挖
  - 2024-01-07：R-001反应釜 - 基底处理
  - 2024-01-08：R-001反应釜 - 钢筋绑扎

### 3. **交互式详情查看** 📊
- **点击任务条** → 右侧弹出详细面板
- 显示该任务所有每日工作明细
- 包含：日期、设备、工作内容、工人数、工时、完成状态

---

## 🎯 数据结构

### 任务数据（Task）
```typescript
interface Task {
  id: string;                    // 任务ID
  name: string;                  // 任务名称
  start_date: string;            // 开始日期
  end_date: string;              // 结束日期
  progress: number;              // 总进度 0-100
  assignee: string;              // 负责人
  status: string;                // 状态
  priority: string;              // 优先级
  daily_workload?: DailyWork[];  // 每日工作量（新增）
}
```

### 每日工作（DailyWork）
```typescript
interface DailyWork {
  date: string;         // 工作日期 (YYYY-MM-DD)
  device: string;       // 设备编号/名称
  work_content: string; // 工作内容描述
  workers: number;      // 工人数量
  hours: number;        // 工作小时数
  completed: boolean;   // 是否已完成
}
```

---

## 📝 演示数据示例

### 示例1：反应釜主体吊装
```typescript
{
  id: 'T-002',
  name: '反应釜主体吊装',
  start_date: '2024-01-25',
  end_date: '2024-02-10',
  progress: 85,
  assignee: '李队长',
  status: 'in_progress',
  priority: 'critical',
  daily_workload: [
    {
      date: '2024-01-25',
      device: 'R-001反应釜',
      work_content: '吊装准备',
      workers: 12,
      hours: 8,
      completed: true
    },
    {
      date: '2024-01-26',
      device: 'R-001反应釜',
      work_content: '主体吊装',
      workers: 15,
      hours: 10,
      completed: true
    },
    {
      date: '2024-01-27',
      device: 'R-001反应釜',
      work_content: '就位调整',
      workers: 10,
      hours: 8,
      completed: true
    },
    {
      date: '2024-01-28',
      device: 'R-001反应釜',
      work_content: '固定焊接',
      workers: 8,
      hours: 8,
      completed: true
    },
    {
      date: '2024-01-29',
      device: 'R-001反应釜',
      work_content: '固定焊接',
      workers: 8,
      hours: 8,
      completed: false  // 未完成，显示黄点
    }
  ]
}
```

### 示例2：换热器组安装（多设备）
```typescript
{
  id: 'T-003',
  name: '换热器组安装',
  daily_workload: [
    {
      date: '2024-01-20',
      device: 'H-001换热器',    // 设备1
      work_content: '设备检查',
      workers: 4,
      hours: 6,
      completed: true
    },
    {
      date: '2024-01-21',
      device: 'H-001换热器',    // 设备1继续
      work_content: '基础准备',
      workers: 6,
      hours: 8,
      completed: true
    },
    {
      date: '2024-01-22',
      device: 'H-002换热器',    // 设备2开始
      work_content: '设备检查',
      workers: 4,
      hours: 6,
      completed: true
    },
    {
      date: '2024-01-23',
      device: 'H-002换热器',    // 设备2继续
      work_content: '基础准备',
      workers: 6,
      hours: 8,
      completed: true
    }
  ]
}
```

---

## 🖼️ 视觉设计

### 甘特图显示效果
```
任务条示例：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
┌───────────────────────────────────────┐
│  反应釜主体吊装    85%                  │
│  🟢🟢🟢🟢🟡                            │  ← 每日工作标记
└───────────────────────────────────────┘
  ↑   ↑   ↑   ↑   ↑
 25日 26日 27日 28日 29日

绿点 = 已完成
黄点 = 未完成
```

### 详情面板
```
┌─────────────────────────────────────────┐
│ 反应釜主体吊装 - 每日工作明细     [关闭] │
├─────────────────────────────────────────┤
│ 日期       │ 设备      │ 工作内容 │ 状态│
├─────────────────────────────────────────┤
│ 2024-01-25 │ R-001... │ 吊装准备 │已完成│
│ 2024-01-26 │ R-001... │ 主体吊装 │已完成│
│ 2024-01-27 │ R-001... │ 就位调整 │已完成│
│ 2024-01-28 │ R-001... │ 固定焊接 │已完成│
│ 2024-01-29 │ R-001... │ 固定焊接 │未完成│
└─────────────────────────────────────────┘
```

---

## 🔧 使用方法

### 查看每日工作
1. 打开"施工进度甘特图"页面
2. 观察任务条上的彩色圆点
3. **点击任意任务条**
4. 右侧弹出详情面板，显示每日工作明细

### 关闭详情面板
- 点击面板右上角的"关闭"按钮
- 或点击其他任务条切换显示

---

## 📊 图例说明

| 标记 | 含义 |
|------|------|
| 🟢 绿色圆点 | 该日工作已完成 |
| 🟡 黄色圆点 | 该日工作未完成/进行中 |
| 🔴 红色小点 | 关键任务标记（优先级：critical） |
| 📍 红色虚线 | 今日日期标记 |

---

## 💡 应用场景

### 1. 设备安装管理
- 每台设备每天的安装进度
- 不同设备可以并行或串行
- 清晰追踪设备安装状态

### 2. 工时统计
- 记录每天实际工人数
- 统计每天工作小时数
- 便于成本核算和资源调配

### 3. 进度监控
- 一目了然看到每日完成情况
- 快速识别延期风险
- 实时调整施工计划

### 4. 质量追溯
- 记录每天的具体工作内容
- 便于质量问题追溯
- 支持施工日志管理

---

## 🚀 后续优化方向

### 计划中的功能：
1. **每日工作编辑** - 支持在线添加/修改每日工作
2. **工时汇总** - 自动统计总工时和人工成本
3. **照片上传** - 每日工作可上传现场照片
4. **异常标记** - 标记延期、质量问题等异常
5. **日报生成** - 自动生成每日施工日报
6. **移动端支持** - 现场人员手机录入每日工作

---

## 🔗 技术细节

### 数据存储
- 前端：演示数据硬编码在组件中
- 后端：需要扩展API支持每日工作数据的CRUD
- 建议数据库表结构：
  ```sql
  CREATE TABLE daily_workload (
    id SERIAL PRIMARY KEY,
    task_id VARCHAR(50),
    work_date DATE,
    device_id VARCHAR(50),
    work_content TEXT,
    workers INT,
    hours DECIMAL(4,2),
    completed BOOLEAN,
    created_at TIMESTAMP DEFAULT NOW()
  );
  ```

### Canvas绘制
- 每日工作点使用 `ctx.arc()` 绘制圆形
- 颜色根据 `completed` 状态动态设置
- 点击检测通过 Canvas 坐标计算任务索引

---

## ⚠️ 注意事项

1. **演示数据** - 当前使用硬编码演示数据，实际使用需对接后端API
2. **性能考虑** - 大量每日工作数据可能影响渲染性能，建议分页或虚拟滚动
3. **移动适配** - 详情面板在小屏幕上需要响应式调整
4. **数据校验** - 添加每日工作时需校验日期在任务时间范围内

---

**版本**：v1.2.0  
**最后更新**：2025-01-17  
**文档作者**：系统开发团队

