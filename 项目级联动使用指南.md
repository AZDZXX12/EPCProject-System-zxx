# 🎯 项目级联动系统使用指南

## ✅ 已完成功能概览

### 1. **全局项目管理** ✨

**位置**: Header顶部导航栏

**功能**:
- 📋 实时显示当前选中的项目
- 🔄 下拉选择切换不同项目
- 📊 显示项目状态和进度百分比
- ⚡ 项目切换自动刷新所有页面数据

**使用方法**:
1. 登录系统后，Header中央会显示当前项目
2. 点击项目选择器下拉菜单
3. 选择要切换的项目
4. 系统自动刷新，所有模块数据更新

**项目状态说明**:
- 🔵 **规划中** - 项目处于前期规划阶段
- 🟢 **进行中** - 项目正在施工建设中  
- ⚪ **已完成** - 项目已竣工验收
- 🟠 **已暂停** - 项目因故暂停

---

### 2. **甘特图项目联动** 📊

**位置**: 施工进度甘特图页面

**功能**:
- 🎯 只显示当前项目的任务
- 🔄 项目切换自动加载新项目任务
- ⚡ 30秒自动同步后端数据
- 📥 Excel导入任务自动关联当前项目

**URL过滤**:
```
当前项目: CHEM-2024-001
API请求: GET /api/v1/tasks/?project_id=CHEM-2024-001
```

**使用场景**:
1. **多项目并行管理**  
   在Header切换到"化工园区一期项目" → 甘特图只显示该项目的施工任务

2. **任务导入**  
   当前项目为"石化装置改造" → 导入的Excel任务自动关联该项目ID

3. **进度跟踪**  
   每个项目独立的任务进度，互不干扰

---

### 3. **进度快速编辑** 🎚️

**功能**:
- 🖱️ 点击任务列表的进度条
- 📊 弹出Slider滑块快速调整进度
- ⚡ 实时保存到后端数据库
- 🔄 甘特图和列表自动同步

**使用方法**:
1. 打开**施工进度甘特图**页面
2. 在下方**任务列表**中找到目标任务
3. 点击**进度**列的进度条（显示提示"点击快速编辑进度"）
4. 在弹出的Modal中拖动Slider调整进度
5. 点击**确定**保存

**进度编辑Modal内容**:
- 📊 当前进度 → 新进度（对比显示）
- 🎚️ Slider滑块（0% - 100%，带25%步进标记）
- 📋 任务详细信息（名称、负责人、日期）
- ✅ 一键保存到后端

**效果**:
- 任务进度立即更新
- 甘特图任务条颜色变化（100%显示绿色）
- 任务列表进度条实时变化
- 统计卡片自动更新（已完成/进行中/待开始数量）

---

### 4. **Excel批量导入** 📥

**功能**:
- 📋 下载标准模板
- 📊 批量导入任务数据
- 🎯 自动关联当前项目
- 🔄 智能识别中英文列名

**使用流程**:
1. 点击**下载模板**按钮 → 获取`EPC任务导入模板_YYYYMMDD.xlsx`
2. 填写任务数据（任务名称、日期、负责人等）
3. 点击**导入Excel**按钮上传文件
4. 系统自动解析并添加到当前项目

**自动关联逻辑**:
```typescript
// 当前项目: 化工园区一期项目 (CHEM-2024-001)
// 导入的任务 project_id 自动设置为: CHEM-2024-001
```

**支持的Excel列**:
| 中文列名 | 英文列名 | 必填 | 说明 |
|---------|---------|------|------|
| 任务名称 | Task Name | ✅ | 任务标识名称 |
| 开始日期 | Start Date | ✅ | YYYY-MM-DD格式 |
| 结束日期 | End Date | ✅ | YYYY-MM-DD格式 |
| 负责人 | Assignee | ❌ | 默认：未指定 |
| 优先级 | Priority | ❌ | high/medium/low |
| 状态 | Status | ❌ | pending/in_progress/completed |
| 进度 | Progress | ❌ | 0-100 |

---

### 5. **实时数据同步** 🔄

**自动刷新机制**:
- ⏱️ 每30秒自动同步后端数据
- 🔄 手动点击刷新按钮立即同步
- 📡 添加/编辑/删除任务实时保存

**联动效果**:
1. **任务列表 ↔ 甘特图**  
   修改任务信息 → 甘特图自动重绘

2. **进度编辑 ↔ 统计卡片**  
   更新任务进度 → 统计数字实时变化

3. **项目切换 ↔ 所有数据**  
   切换项目 → 任务/设备/文档全部切换

---

## 🚀 典型使用场景

### 场景1：多项目并行管理

**需求**: 同时管理2个化工项目，切换查看各自进度

**操作步骤**:
1. 登录系统，默认显示"化工园区一期项目"
2. 查看当前项目甘特图，有50个施工任务
3. 点击Header项目选择器，切换到"石化装置改造项目"
4. 页面自动刷新，甘特图显示新项目的30个任务
5. 修改某个任务进度 → 只影响当前项目

**效果**:
- ✅ 两个项目数据完全隔离
- ✅ 切换流畅，无需手动刷新
- ✅ 任务进度独立跟踪

---

### 场景2：快速更新施工进度

**需求**: 每日下班前快速更新所有任务进度

**操作步骤**:
1. 打开**施工进度甘特图**页面
2. 滚动到**任务列表**
3. 逐个点击**进度**列的进度条
4. 拖动Slider到实际完成百分比
5. 点击确定保存（0.5秒完成一个任务）

**效率对比**:
- ❌ 传统方式：点击编辑 → 填写表单 → 保存（~10秒/任务）
- ✅ 快速编辑：点击进度条 → 拖动Slider → 确定（~3秒/任务）
- 📊 **效率提升70%**

---

### 场景3：批量导入施工计划

**需求**: 从Excel导入200个施工任务到新项目

**操作步骤**:
1. 在Header切换到新项目"某某化工扩建工程"
2. 打开甘特图，点击**下载模板**
3. 在Excel中填写200行任务数据
4. 点击**导入Excel**上传文件
5. 系统自动导入并关联到当前项目

**数据处理**:
- 🔄 自动过滤表头行
- ✅ 验证日期格式
- 🎯 project_id自动设置为当前项目
- 📊 导入后显示"✅ 成功导入 200 个任务"

---

### 场景4：项目总结报告

**需求**: 项目完成后导出完整甘特图和任务列表

**操作步骤**:
1. 切换到已完成的项目
2. 打开甘特图页面
3. 点击**导出PDF**按钮
4. 获得包含甘特图和任务详情的PDF报告

**PDF内容**:
- 📊 甘特图可视化（A3横向高清）
- 📋 任务详细列表（Task Name, Start Date, End Date, Assignee, Progress, Status）
- 📝 元数据（生成时间、任务总数、版本号、EPC团队署名）

---

## 💡 高级技巧

### 技巧1：快捷键和快速操作

**进度编辑快捷操作**:
- 点击进度条 → 快速编辑
- 拖动Slider → 实时预览
- Enter键 → 保存（在Modal中）
- Esc键 → 取消编辑

### 技巧2：数据筛选和排序

**任务列表智能筛选**:
- 按**优先级**筛选（高/中/低）
- 按**状态**筛选（已完成/进行中/待开始）
- 按**开始日期**排序
- 按**工期**排序
- 按**进度**排序

**筛选组合**:
```
筛选: 优先级=高 + 状态=进行中
排序: 按进度升序
结果: 显示所有高优先级且进行中的任务，按完成度从低到高排列
```

### 技巧3：项目数据隔离

**数据安全**:
- 每个项目的任务、设备、文档完全独立
- 切换项目不会影响其他项目数据
- project_id作为数据隔离的唯一标识

**示例**:
```
项目A (CHEM-2024-001):
- 任务: 50个
- 设备: 30台
- 进度: 45%

项目B (PETRO-2024-002):
- 任务: 30个
- 设备: 20台
- 进度: 10%

两个项目完全独立，互不影响
```

---

## 📊 数据流程图

### 项目切换流程
```
用户点击项目选择器
     ↓
选择新项目
     ↓
ProjectContext更新currentProject
     ↓
localStorage保存项目ID
     ↓
页面监听到currentProject变化
     ↓
重新fetch数据（带project_id参数）
     ↓
页面更新显示新项目数据
```

### 进度编辑流程
```
用户点击进度条
     ↓
弹出进度编辑Modal
     ↓
拖动Slider调整进度
     ↓
点击确定
     ↓
发送PUT请求到后端
     ↓
后端更新数据库
     ↓
前端重新loadTasks()
     ↓
甘特图和列表自动刷新
```

### Excel导入流程
```
用户上传Excel文件
     ↓
前端解析XLSX数据
     ↓
转换为Task格式
     ↓
自动添加project_id=当前项目ID
     ↓
发送POST请求到后端
     ↓
后端保存到数据库
     ↓
前端重新loadTasks()
     ↓
甘特图显示新任务
```

---

## 🔧 故障排查

### 问题1：切换项目后数据没有更新

**可能原因**:
- 浏览器缓存
- 后端未返回project_id过滤的数据

**解决方法**:
1. 点击Header的刷新按钮（ReloadOutlined图标）
2. 清除浏览器缓存并刷新页面（Ctrl+Shift+R）
3. 检查浏览器控制台，查看API请求URL是否包含`?project_id=xxx`

### 问题2：进度编辑后没有保存

**可能原因**:
- 后端服务未运行
- 认证Token过期
- 网络连接问题

**解决方法**:
1. 检查后端服务是否运行（`http://localhost:8000/docs`）
2. 重新登录系统（刷新Token）
3. 查看页面消息提示（会显示"⚠️ 已更新本地数据"表示后端保存失败但本地已更新）

### 问题3：Excel导入后任务不显示

**可能原因**:
- Excel格式不正确
- 任务名称列为空
- 日期格式无效

**解决方法**:
1. 使用标准模板填写数据
2. 确保"任务名称"列不为空
3. 日期格式使用`YYYY-MM-DD`（如2024-01-15）
4. 查看控制台日志，确认导入了多少任务

---

## 🎓 最佳实践

### 1. 项目命名规范
```
格式: [类型]-[年份]-[编号]
示例:
- CHEM-2024-001（化工类项目）
- PETRO-2024-002（石化类项目）
- POWER-2024-003（电力类项目）
```

### 2. 任务编号规范
```
格式: [类别字母]-[编号] [任务名称]
示例:
- R-001 反应釜基础施工
- P-002 泵类设备吊装
- E-003 电气设备安装
```

### 3. 进度更新频率
- 日常施工：每日下班前更新
- 关键节点：实时更新（如设备到货、验收完成）
- 定期检查：每周统一核对进度

### 4. Excel导入最佳实践
- 单次导入不超过100条任务（保持响应速度）
- 大批量任务分批导入
- 导入前先备份现有数据（导出PDF）

---

## 📞 技术支持

**开发团队**: EPC开发团队  
**系统版本**: 2.0.0-zxx  
**更新日期**: 2024-10-18

**核心特性**:
- ✅ 全局项目状态管理
- ✅ 跨页面数据联动
- ✅ 快速进度编辑
- ✅ Excel批量导入
- ✅ 实时数据同步
- ✅ 项目级数据隔离

**联系方式**:
- 📧 Email: support@epc-system.com
- 📖 文档: http://localhost:3000/docs
- 🔧 API: http://localhost:8000/docs



