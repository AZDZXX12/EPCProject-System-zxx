<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¦»å¿ƒé£æœºé€‰å‹ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* é¡¶éƒ¨æ ‡é¢˜æ  */
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-info {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ä¸»å†…å®¹åŒº - é“ºæ»¡å±å¹• */
        .main-content {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 0;
            height: calc(100vh - 90px);
        }

        /* å·¦ä¾§è¾“å…¥åŒº */
        .input-panel {
            background: #ecf0f1;
            padding: 20px;
            border-right: 1px solid #bdc3c7;
            overflow-y: auto;
            height: 100%;
        }

        .input-section {
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 15px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 2px solid #16a085;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* ä¸¤åˆ—å¸ƒå±€ */
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 10px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-size: 13px;
            color: #555;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .input-wrapper {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .input-wrapper input,
        .input-wrapper select {
            flex: 1;
            padding: 7px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.3s;
        }

        .input-wrapper input:focus,
        .input-wrapper select:focus {
            outline: none;
            border-color: #16a085;
            box-shadow: 0 0 0 3px rgba(22, 160, 133, 0.1);
        }

        .input-wrapper .unit {
            min-width: 50px;
            padding: 7px 8px;
            background: #e9ecef;
            border-radius: 5px;
            text-align: center;
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        .calculate-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 12px;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .calculate-btn:hover {
            background: linear-gradient(135deg, #229954 0%, #1e8449 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        /* å³ä¾§ç»“æœåŒº */
        .result-panel {
            padding: 30px;
            overflow-y: auto;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            font-size: 15px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #16a085;
            border-bottom-color: #16a085;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* é€‰å‹ç»“æœå¡ç‰‡ */
        .result-card {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 15px 18px;
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: 0 6px 18px rgba(52, 152, 219, 0.25);
        }

        .result-card h3 {
            font-size: 17px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .result-item {
            background: rgba(255,255,255,0.15);
            padding: 8px 12px;
            border-radius: 6px;
            backdrop-filter: blur(10px);
        }

        .result-item-label {
            font-size: 11px;
            opacity: 0.85;
            margin-bottom: 4px;
        }

        .result-item-value {
            font-size: 16px;
            font-weight: 600;
        }

        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            background: white;
            padding: 15px 18px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            margin-bottom: 12px;
        }

        .chart-container h3 {
            font-size: 15px;
            color: #2c3e50;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #ecf0f1;
        }

        /* è®¡ç®—è¯¦æƒ… + ç³»æ•°å¹¶æ’å¸ƒå±€ */
        .two-col {
            display: grid;
            grid-template-columns: 1.3fr 1fr;
            gap: 20px;
        }

        .chart-wrapper {
            position: relative;
            height: 350px;
        }

        /* æ ‡å‡†ç¬¦åˆæ€§ */
        .standards-grid {
            display: grid;
            gap: 15px;
        }

        .standard-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #34495e;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .standard-item.compliant {
            border-left-color: #27ae60;
        }

        .standard-item.warning {
            border-left-color: #f39c12;
        }

        .standard-item.non-compliant {
            border-left-color: #e74c3c;
        }

        .standard-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .standard-status {
            font-size: 20px;
        }

        .standard-title {
            font-weight: 600;
            font-size: 15px;
            color: #2c3e50;
        }

        .standard-desc {
            font-size: 13px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        .standard-requirements {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ecf0f1;
            font-size: 13px;
            color: #555;
        }

        /* æ€§èƒ½æ›²çº¿å›¾ç‰‡å±•ç¤º */
        .performance-images {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .image-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .image-card h4 {
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }

        .image-card img {
            width: 100%;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        /* è®¡ç®—è¯¦æƒ…è¡¨æ ¼ */
        .calc-details-table {
            width: 100%;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .calc-details-table th,
        .calc-details-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .calc-details-table th {
            background: #34495e;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .calc-details-table td {
            font-size: 14px;
            color: #555;
        }

        .calc-details-table tr:last-child td {
            border-bottom: none;
        }

        .calc-details-table tr:hover {
            background: #f8f9fa;
        }

        /* å“åº”å¼ */
        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 400px 1fr;
            }
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .input-panel, .result-panel {
                height: auto;
            }
            
            .performance-images {
                grid-template-columns: 1fr;
            }

            .result-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 1200px) {
            .result-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .input-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨æ ‡é¢˜ -->
        <div class="header">
            <h1>
                <span>ğŸŒ€</span>
                ç¦»å¿ƒé£æœºé€‰å‹ç³»ç»Ÿ
            </h1>
            <div class="header-info">
                <div>åŸºäºGB/T 12939-2021æ ‡å‡†</div>
                <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">é£æœºé€‰å‹è½¯ä»¶ - ä¸“ä¸šç‰ˆ</div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <!-- å·¦ä¾§è¾“å…¥é¢æ¿ -->
            <div class="input-panel">
                <div class="input-section">
                    <div class="section-title">
                        <span>ğŸ“Š</span>
                        åŸºæœ¬å‚æ•°
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label>æµé‡ (Q)</label>
                            <div class="input-wrapper">
                                <input type="number" id="flowRate" value="16000" step="100" min="0" max="2000000">
                                <span class="unit">mÂ³/h</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label>å…¨å‹ (P)</label>
                            <div class="input-wrapper">
                                <input type="number" id="totalPressure" value="4500" step="10" min="0" max="100000">
                                <span class="unit">Pa</span>
                            </div>
                        </div>
                    </div>

                    <div class="input-row">
                        <div class="input-group">
                            <label>å·¥ä½œæ¸©åº¦ (T)</label>
                            <div class="input-wrapper">
                                <input type="number" id="temperature" value="60" step="1" min="-50" max="600">
                                <span class="unit">â„ƒ</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label>ä»‹è´¨ç±»å‹</label>
                            <div class="input-wrapper">
                                <select id="gasType">
                                    <option value="air">ç©ºæ°”</option>
                                    <option value="steam">æ°´è’¸æ°”</option>
                                    <option value="other">å…¶ä»–æ°”ä½“</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-section">
                    <div class="section-title">
                        <span>ğŸŒ</span>
                        ç¯å¢ƒå‚æ•°
                    </div>

                    <div class="input-row">
                        <div class="input-group">
                            <label>æµ·æ‹”é«˜åº¦</label>
                            <div class="input-wrapper">
                                <input type="number" id="altitude" value="33" step="1" min="0" max="5000">
                                <span class="unit">m</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label>ç»çƒ­æŒ‡æ•°</label>
                            <div class="input-wrapper">
                                <input type="number" id="adiabaticIndex" value="1.4" step="0.01" min="1.00" max="1.67">
                                <span class="unit">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-section">
                    <div class="section-title">
                        <span>âš™ï¸</span>
                        é£æœºå‚æ•°
                    </div>

                    <div class="input-row">
                        <div class="input-group">
                            <label>å·¥ä½œè½¬é€Ÿ</label>
                            <div class="input-wrapper">
                                <input type="number" id="fanSpeed" value="960" step="10" min="100" max="6000">
                                <span class="unit">r/min</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label>å®‰å…¨ç³»æ•°</label>
                            <div class="input-wrapper">
                                <input type="number" id="safetyFactor" value="1.15" step="0.01" min="1.00" max="1.50">
                                <span class="unit">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="input-row">
                        <div class="input-group">
                            <label>å¸å…¥å‹å¼</label>
                            <div class="input-wrapper">
                                <select id="inletType">
                                    <option value="single">å•å¸</option>
                                    <option value="double">åŒå¸</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ç»™å®šå¶è½®ç›´å¾„</label>
                            <div class="input-wrapper">
                                <input type="number" id="impellerDiameter" value="2.2" step="0.1" min="0.2" max="5.0">
                                <span class="unit">m</span>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculateFanSelection()">
                    ğŸ” å¼€å§‹é€‰å‹è®¡ç®—
                </button>
            </div>

            <!-- å³ä¾§ç»“æœé¢æ¿ -->
            <div class="result-panel">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab(0)">é€‰å‹ç»“æœ</button>
                    <button class="tab" onclick="switchTab(1)">æ€§èƒ½æ›²çº¿</button>
                    <button class="tab" onclick="switchTab(2)">æ ‡å‡†ç¬¦åˆæ€§</button>
                    <button class="tab" onclick="switchTab(3)">è®¡ç®—è¯¦æƒ…</button>
                </div>

                <!-- Tab 0: é€‰å‹ç»“æœ -->
                <div class="tab-content active" id="tab-0">
                    <div class="result-card">
                        <h3>
                            <span>âœ…</span>
                            æ¨èé£æœºå‹å·
                        </h3>
                        <div style="font-size: 28px; font-weight: 700; margin: 10px 0;" id="fanModel">
                            5-48
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 6px; margin-bottom: 10px; font-size: 13px;">
                            <strong>ğŸ’¡ æ¨èåŸå› ï¼š</strong>
                            <span id="recommendReason">ç­‰å¾…è®¡ç®—...</span>
                        </div>
                        <div id="smartDInfo" style="background: rgba(52,152,219,0.3); padding: 8px; border-radius: 6px; margin-bottom: 10px; font-size: 12px; display: none;">
                            <strong>ğŸ¯ æ™ºèƒ½å¶è½®ç›´å¾„ï¼š</strong><span id="smartDValue">-</span> m 
                            <span id="smartDReason" style="opacity: 0.9;"></span>
                        </div>
                        <div class="result-grid">
                            <div class="result-item">
                                <div class="result-item-label">å®é™…é£é‡</div>
                                <div class="result-item-value" id="actualFlow">16,000 mÂ³/h</div>
                            </div>
                            <div class="result-item">
                                <div class="result-item-label">å®é™…é£å‹</div>
                                <div class="result-item-value" id="actualPressure">5,000 Pa</div>
                            </div>
                            <div class="result-item">
                                <div class="result-item-label">å·¥å†µå¯†åº¦</div>
                                <div class="result-item-value" id="workingDensity">1.056 kg/mÂ³</div>
                            </div>
                            <div class="result-item">
                                <div class="result-item-label">å½“åœ°å¤§æ°”å‹</div>
                                <div class="result-item-value" id="localPressure">100,929 Pa</div>
                            </div>
                            <div class="result-item">
                                <div class="result-item-label">æ¯”è½¬æ•°</div>
                                <div class="result-item-value" id="specificSpeed">17.13</div>
                            </div>
                            <div class="result-item">
                                <div class="result-item-label">å‹ç¼©æ€§ç³»æ•°</div>
                                <div class="result-item-value" id="compressibility">0.983</div>
                            </div>
                            <div class="result-item">
                                <div class="result-item-label">çº¿é€Ÿåº¦</div>
                                <div class="result-item-value" id="lineSpeed">0.00 m/s</div>
                            </div>
                            <div class="result-item" style="background: rgba(52,152,219,0.25); border-left: 4px solid #3498db;">
                                <div class="result-item-label">æ™ºèƒ½å¶è½®ç›´å¾„</div>
                                <div class="result-item-value" id="smartDDisplay">- m</div>
                            </div>
                            <div class="result-item">
                                <div class="result-item-label">éœ€æ±‚è½´åŠŸç‡</div>
                                <div class="result-item-value" id="shaftPower">0.00 kW</div>
                            </div>
                            <div class="result-item" style="grid-column: span 2; background: linear-gradient(135deg, #27ae60 0%, #229954 100%);">
                                <div class="result-item-label" style="font-size: 15px;">âš¡ éœ€æ±‚ç”µæœºåŠŸç‡ï¼ˆå«å®‰å…¨ç³»æ•°ï¼‰</div>
                                <div class="result-item-value" style="font-size: 24px; font-weight: 700;" id="motorPower">0.00 kW</div>
                            </div>
                            <div class="result-item" style="background: rgba(255,193,7,0.2); border-left: 4px solid #ff9800;">
                                <div class="result-item-label">é€‰å‹è½´åŠŸç‡</div>
                                <div class="result-item-value" id="actualShaftPower">0.00 kW</div>
                            </div>
                            <div class="result-item" style="grid-column: span 2; background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);">
                                <div class="result-item-label" style="font-size: 15px;">âš™ï¸ é€‰å‹ç”µæœºåŠŸç‡ï¼ˆå½“å‰Då€¼ï¼‰</div>
                                <div class="result-item-value" style="font-size: 24px; font-weight: 700;" id="actualMotorPower">0.00 kW</div>
                            </div>
                        </div>
                    </div>

                    <!-- åŠŸç‡è¯´æ˜ -->
                    <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 15px; margin: 20px 0; border-radius: 4px;">
                        <h4 style="color: #e65100; margin: 0 0 10px 0; font-size: 14px;">ğŸ’¡ åŠŸç‡è¯´æ˜</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: #424242; line-height: 1.6;">
                            <li><strong>éœ€æ±‚åŠŸç‡</strong>ï¼šåŸºäºæ‚¨è¾“å…¥çš„æµé‡å’Œå‹åŠ›è®¡ç®—ï¼Œä»£è¡¨å®é™…éœ€æ±‚</li>
                            <li><strong>é€‰å‹åŠŸç‡</strong>ï¼šåŸºäºæ¨èå‹å·å’Œå½“å‰Då€¼è®¡ç®—çš„å®é™…åŠŸç‡</li>
                            <li>âœ… <strong>ä¸¤è€…æ¥è¿‘</strong>è¯´æ˜Då€¼é€‰æ‹©åˆç†</li>
                            <li>âš ï¸ <strong>é€‰å‹åŠŸç‡è¿œå¤§äºéœ€æ±‚åŠŸç‡</strong>è¯´æ˜Då€¼åå¤§ï¼Œå»ºè®®è°ƒæ•´</li>
                        </ul>
                    </div>

                    <div class="chart-container">
                        <h3>ğŸ“ˆ åŠŸç‡-æµé‡æ›²çº¿</h3>
                        <div class="chart-wrapper">
                            <canvas id="powerChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Tab 1: æ€§èƒ½å‚æ•° -->
                <div class="tab-content" id="tab-1">
                    <!-- é£æœºç³»æ•°æ•°æ®è¡¨ -->
                    <div class="chart-container" style="margin-bottom: 20px;">
                        <h3>ğŸ“ æ¨èé£æœºæ€§èƒ½ç³»æ•°ï¼ˆæ•°æ®åº“.xlsxï¼‰</h3>
                        <div id="fanCoefficientsDisplay" style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; color: #7f8c8d;">
                            ç­‰å¾…è®¡ç®—æ¨è...
                        </div>
                    </div>
                
                    <div class="performance-images">
                        <div class="image-card">
                            <h4>é£æœºæ€§èƒ½æ›²çº¿ - æµé‡Â·å‹åŠ›Â·æ•ˆç‡</h4>
                            <canvas id="staticCurve1" width="800" height="500" style="width: 100%; border: 1px solid #e0e0e0; border-radius: 8px;"></canvas>
                        </div>
                        <div class="image-card">
                            <h4>é£æœºæ€§èƒ½æ›²çº¿ - æµé‡Â·å‹åŠ›Â·åŠŸç‡</h4>
                            <canvas id="staticCurve2" width="800" height="500" style="width: 100%; border: 1px solid #e0e0e0; border-radius: 8px;"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container" style="margin-top: 20px;">
                        <h3>ğŸ“Š äº¤äº’å¼æ€§èƒ½æ›²çº¿ï¼ˆChart.jsï¼‰</h3>
                        <div class="chart-wrapper">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Tab 2: æ ‡å‡†ç¬¦åˆæ€§ -->
                <div class="tab-content" id="tab-2">
                    <div class="standards-grid" id="standardsGrid">
                        <div class="loading">æ­£åœ¨åŠ è½½æ ‡å‡†æ•°æ®</div>
                    </div>
                </div>

                <!-- Tab 3: è®¡ç®—è¯¦æƒ…ï¼ˆå·¦ï¼‰ + ç³»æ•°ï¼ˆå³ï¼‰ -->
                <div class="tab-content" id="tab-3">
                    <div class="two-col">
                        <div class="chart-container">
                            <h3>ğŸ§® è®¡ç®—è¿‡ç¨‹è¯¦æƒ…</h3>
                            <table class="calc-details-table" id="calcDetailsTable">
                                <thead>
                                    <tr>
                                        <th>è®¡ç®—é¡¹ç›®</th>
                                        <th>å…¬å¼</th>
                                        <th>è®¡ç®—å€¼</th>
                                        <th>å•ä½</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td colspan="4" style="text-align: center; color: #999;">ç­‰å¾…è®¡ç®—...</td></tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="chart-container">
                            <h3>ğŸ“ æ¨èé£æœºç³»æ•°ï¼ˆå¹¶æ’æ˜¾ç¤ºï¼‰</h3>
                            <div id="coeffInlineContainer" style="background:#f8f9fa; padding:12px; border-radius:8px; color:#7f8c8d;">ç­‰å¾…è®¡ç®—æ¨è...</div>
                        </div>
                    </div>
                    
                    <!-- æ–°å¢ï¼š7è¡Œæ€§èƒ½å¯¹æ¯”è¡¨ï¼ˆå®Œå…¨æŒ‰Excelé€»è¾‘ï¼‰ -->
                    <div class="chart-container" style="grid-column: span 2;">
                        <h3>ğŸ“Š 7ä¸ªå·¥å†µç‚¹æ€§èƒ½å¯¹æ¯”è¡¨ï¼ˆä¸Excelå®Œå…¨ä¸€è‡´ï¼‰</h3>
                        <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 12px; margin-bottom: 15px; border-radius: 4px; font-size: 13px; color: #1565c0;">
                            <strong>ğŸ’¡ Excelé€‰å‹é€»è¾‘ï¼š</strong>éå†æ¨èé£æœºå‹å·çš„7ä¸ªç³»æ•°ç‚¹ï¼Œè®¡ç®—æ¯ä¸ªç‚¹çš„Qã€Pã€Î·ã€åŠŸç‡ï¼Œé€‰æ‹©ä¸ç›®æ ‡å€¼è¯¯å·®æœ€å°çš„å·¥å†µç‚¹ï¼ˆé»„è‰²é«˜äº®ï¼‰ã€‚
                        </div>
                        <table class="calc-details-table" id="comparison7Table">
                            <thead>
                                <tr>
                                    <th>åºå·</th>
                                    <th>æµé‡ (mÂ³/h)</th>
                                    <th>å…¨å‹ (Pa)</th>
                                    <th>å†…æ•ˆç‡ (%)</th>
                                    <th>è½´åŠŸç‡ (kW)</th>
                                    <th>ç”µæœºåŠŸç‡ (kW)</th>
                                    <th>è¯¯å·®å¾—åˆ†</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="7" style="text-align: center; padding: 20px; color: #999;">ç­‰å¾…è®¡ç®—...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js åº“ - ä½¿ç”¨å›½å†…CDN -->
    <script>
        // åŠ¨æ€åŠ è½½Chart.js
        (function() {
            const cdnUrls = [
                'https://cdn.bootcdn.net/ajax/libs/Chart.js/4.4.0/chart.umd.min.js',
                'https://unpkg.com/chart.js@4.4.0/dist/chart.umd.min.js',
                'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js'
            ];
            
            let currentIndex = 0;
            
            function loadChart() {
                if (currentIndex >= cdnUrls.length) {
                    console.error('æ‰€æœ‰Chart.js CDNåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨Canvasç»˜å›¾');
                    window.Chart = null; // æ ‡è®°Chart.jsä¸å¯ç”¨
                    return;
                }
                
                const script = document.createElement('script');
                script.src = cdnUrls[currentIndex];
                script.onload = function() {
                    console.log('Chart.jsåŠ è½½æˆåŠŸ:', cdnUrls[currentIndex]);
                };
                script.onerror = function() {
                    console.warn('Chart.jsåŠ è½½å¤±è´¥:', cdnUrls[currentIndex]);
                    currentIndex++;
                    loadChart();
                };
                document.head.appendChild(script);
            }
            
            loadChart();
        })();
    </script>
    
    <script src="fan_system_database.js"></script>
    <script src="fan_coefficients_database.js"></script>
    <script>
        // ==================== å…¨å±€å˜é‡ ====================
        let powerChart = null;
        let performanceChart = null;
        let CURRENT_SELECTION = null; // { model, idx, flowPoints, pressurePoints, efficiencyPoints, powerPoints, operating }
        // è¯¯å·®æƒé‡ï¼ˆå¯æŒ‰éœ€è°ƒæ•´ï¼‰ï¼šæµé‡æƒé‡ã€å‹åŠ›æƒé‡
        const WEIGHT_Q = 1.0;
        const WEIGHT_P = 2.0;

        // ==================== Tabåˆ‡æ¢ ====================
        function switchTab(index) {
            // åˆ‡æ¢tabæŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.tab').forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
            });
            
            // åˆ‡æ¢å†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.tab-content').forEach((content, i) => {
                content.classList.toggle('active', i === index);
            });
        }

        // ==================== æ ¸å¿ƒè®¡ç®—å‡½æ•° ====================
        function calculateFanSelection() {
            // è·å–è¾“å…¥å‚æ•°ï¼ˆä¸å†æœ‰fanModelè¾“å…¥ï¼‰
            const inputs = {
                fanModel: '',  // å§‹ç»ˆä¸ºç©ºï¼Œè®©ç³»ç»Ÿæ™ºèƒ½æ¨è
                flowRate: parseFloat(document.getElementById('flowRate').value),
                totalPressure: parseFloat(document.getElementById('totalPressure').value),
                temperature: parseFloat(document.getElementById('temperature').value),
                altitude: parseFloat(document.getElementById('altitude').value),
                adiabaticIndex: parseFloat(document.getElementById('adiabaticIndex').value),
                fanSpeed: parseFloat(document.getElementById('fanSpeed').value),
                impellerDiameter: parseFloat(document.getElementById('impellerDiameter').value),
                safetyFactor: parseFloat(document.getElementById('safetyFactor').value)
            };

            // ===== ExcelçœŸå®è®¡ç®—å…¬å¼ =====
            
            // F5: å½“åœ°å¤§æ°”å‹ = 101325*(1-0.02257*F4/1000)^5.256
            const localPressure = 101325 * Math.pow(1 - 0.02257 * inputs.altitude / 1000, 5.256);
            
            // F6: å·¥å†µå¯†åº¦ = (273/(273+C7)*(F5+C6)/101325)*O4
            // æ³¨ï¼šC6æ˜¯è¿›å£å‹åŠ›ï¼Œè¿™é‡Œå‡è®¾ä¸º0ï¼›O4æ˜¯æ ‡å‡†å¯†åº¦1.2
            const C6 = 0; // è¿›å£å‹åŠ›ï¼ˆé€šå¸¸ä¸º0ï¼‰
            const O4 = 1.2; // æ ‡å‡†å¯†åº¦
            const workingDensity = (273 / (273 + inputs.temperature) * (localPressure + C6) / 101325) * O4;
            
            // F8: å‹ç¼©æ€§ç³»æ•° = (C8/(C8-1))*((1+C5/(F5+C6))^((C8-1)/C8)-1)*(C5/(F5+C6))^(-1)
            const k = inputs.adiabaticIndex; // C8
            const P = inputs.totalPressure; // C5
            const compressibility = (k / (k - 1)) * 
                                   ((Math.pow(1 + P / (localPressure + C6), (k - 1) / k) - 1) * 
                                   Math.pow(P / (localPressure + C6), -1));
            
            // C9: æ¯”è½¬æ•° = 5.54*F7*(C4/3600)^0.5/(C5*1.2/F6)^0.75
            const specificSpeed = 5.54 * inputs.fanSpeed * Math.pow(inputs.flowRate / 3600, 0.5) / 
                                  Math.pow(inputs.totalPressure * 1.2 / workingDensity, 0.75);
            
            // ===== ç¬¬ä¸€æ­¥ï¼šæ™ºèƒ½æ¨èå¶è½®ç›´å¾„ï¼ˆå…³é”®ä¼˜åŒ–ï¼ï¼‰ =====
            // æå‰è·å–å•/åŒå¸ç³»æ•°
            const inletFactor = (document.getElementById('inletType').value === 'double') ? 2 : 1;
            
            // é¢„è®¾é»˜è®¤ç³»æ•°ï¼ˆç”¨äºç²—ç®—Dï¼‰
            let flowCoeff = 0.2;        // Ï† - æµé‡ç³»æ•°
            let pressureCoeff = 0.5;    // Ïˆ - å…¨å‹ç³»æ•°  
            let fanEfficiency = 0.82;   // Î· - å†…æ•ˆç‡
            
            // ç¬¬ä¸€è½®ï¼šå¿«é€Ÿéå†æ‰€æœ‰å‹å·ï¼Œæ‰¾åˆ°æœ€å¯èƒ½åŒ¹é…çš„å‹å·å’Œç³»æ•°
            // ç”¨äºæ›´å‡†ç¡®åœ°ä¼°ç®—Då€¼
            if (typeof FAN_COEFFICIENTS_DATABASE !== 'undefined') {
                const targetQ = inputs.flowRate;
                const targetP = inputs.totalPressure;
                
                // ä½¿ç”¨æ¯”è½¬æ•°å¿«é€Ÿç­›é€‰å¯èƒ½çš„å‹å·
                let bestPreselect = { error: Infinity };
                for (const [model, data] of Object.entries(FAN_COEFFICIENTS_DATABASE)) {
                    for (let i = 0; i < 7; i++) {
                        const phi = Number(data.flow_coefficients[i]);
                        const psi = Number(data.pressure_coefficients[i]);
                        const etaPct = Number(data.efficiency[i]);
                        if (!isFinite(phi) || !isFinite(psi) || !isFinite(etaPct) || phi <= 0 || psi <= 0) continue;
                        
                        // ä½¿ç”¨æ¯”è½¬æ•°ä½œä¸ºåˆæ­¥ç­›é€‰ä¾æ®
                        // ns = 5.54 * n * sqrt(Q) / (P^0.75)
                        // ç†æƒ³æƒ…å†µä¸‹ï¼Œé€‰æ‹©çš„å‹å·åº”è¯¥æœ‰åˆé€‚çš„Ï†å’ŒÏˆä½¿å¾—è®¡ç®—å€¼æ¥è¿‘ç›®æ ‡å€¼
                        const nsPred = 5.54 * inputs.fanSpeed * Math.pow(targetQ / 3600, 0.5) / Math.pow(targetP, 0.75);
                        
                        // ç®€å•è¯„åˆ†ï¼šå‡è®¾è¯¥å‹å·çš„ç³»æ•°åˆé€‚
                        const score = Math.abs(phi - 0.2) + Math.abs(psi - 0.5); // åå¥½ä¸­ç­‰ç³»æ•°
                        if (score < bestPreselect.error) {
                            bestPreselect = { error: score, phi, psi, eta: etaPct/100 };
                        }
                    }
                }
                if (bestPreselect.phi) {
                    flowCoeff = bestPreselect.phi;
                    pressureCoeff = bestPreselect.psi;
                    fanEfficiency = bestPreselect.eta;
                }
            }
            
            // C10: ç²—ç®—å¶è½®ç›´å¾„ï¼ˆExcelå…¬å¼ï¼‰
            // D = 27/n * sqrt(P / (2 * Ï * Ïˆ))
            const roughImpellerDiameter = 27 / inputs.fanSpeed * Math.sqrt(
                inputs.totalPressure / (2 * workingDensity * pressureCoeff)
            );
            
            // æ™ºèƒ½é€‰æ‹©Då€¼ï¼š
            // 1. å¦‚æœç”¨æˆ·è¾“å…¥çš„Dä¸ç²—ç®—Dç›¸å·®>30%ï¼Œä½¿ç”¨ç²—ç®—Dï¼ˆæ™ºèƒ½æ¨èï¼‰
            // 2. å¦åˆ™ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„D
            const userInputD = inputs.impellerDiameter;
            const roughD = roughImpellerDiameter;
            const deviationPct = Math.abs(userInputD - roughD) / roughD * 100;
            
            let smartImpellerDiameter;
            let isDSmartRecommended = false;
            
            if (deviationPct > 30) {
                // åå·®å¤ªå¤§ï¼Œä½¿ç”¨æ™ºèƒ½æ¨è
                smartImpellerDiameter = roughD;
                isDSmartRecommended = true;
                console.log(`ğŸ¯ æ™ºèƒ½æ¨èD: ${roughD.toFixed(2)}m (ç”¨æˆ·è¾“å…¥${userInputD}måå·®${deviationPct.toFixed(0)}%)`);
            } else {
                // ä½¿ç”¨ç”¨æˆ·è¾“å…¥
                smartImpellerDiameter = userInputD;
                isDSmartRecommended = false;
                console.log(`âœ“ ä½¿ç”¨ç”¨æˆ·è¾“å…¥D: ${userInputD}m (ç²—ç®—${roughD.toFixed(2)}måå·®${deviationPct.toFixed(0)}%)`);
            }
            
            // G11: çº¿é€Ÿåº¦ = PI()*D*n/60ï¼ˆä½¿ç”¨æ™ºèƒ½Dï¼‰
            const lineSpeed = Math.PI * smartImpellerDiameter * inputs.fanSpeed / 60;
            
            // ===== ç¬¬äºŒæ­¥ï¼šæ™ºèƒ½æ¨èé£æœºå‹å·ï¼ˆä½¿ç”¨æ™ºèƒ½Då€¼ï¼‰ =====
            let selectedModel = '';  // ä¸å†æ”¯æŒæ‰‹åŠ¨é€‰æ‹©
            let recommendedModel = ''; // æ¨èçš„å‹å·
            let recommendReason = '';
            let chosenCoeffIndex = 3; // é»˜è®¤ç¬¬4ç»„
            
            if (typeof FAN_COEFFICIENTS_DATABASE !== 'undefined') {
                const targetQ = inputs.flowRate;
                const targetP = inputs.totalPressure;
                const u = Math.PI * smartImpellerDiameter * inputs.fanSpeed / 60; // ä½¿ç”¨æ™ºèƒ½Dè®¡ç®—çº¿é€Ÿåº¦
                
                let best = { error: Infinity };
                for (const [model, data] of Object.entries(FAN_COEFFICIENTS_DATABASE)) {
                    const flows = data.flow_coefficients || [];
                    const pressures = data.pressure_coefficients || [];
                    const effs = data.efficiency || [];
                    for (let i = 0; i < 7; i++) {
                        const phi = Number(flows[i]);
                        const psi = Number(pressures[i]);
                        const etaPct = Number(effs[i]);
                        if (!isFinite(phi) || !isFinite(psi) || !isFinite(etaPct) || phi <= 0 || psi <= 0) continue;
                        
                        // å®Œå…¨æŒ‰Excelé€»è¾‘ï¼šQ = Ï†*(Ï€/4)*DÂ²*u*3600*(å•å¸=1,åŒå¸=2)ï¼ˆä½¿ç”¨æ™ºèƒ½Dï¼‰
                        const Qpred = phi * Math.PI / 4 * Math.pow(smartImpellerDiameter, 2) * u * 3600 * inletFactor;
                        // P = Ïˆ*Ï*uÂ²*(BB24/BB50ä¿®æ­£=0.9784)
                        const pressureCorrection = (model === 'BB24' || model === 'BB50') ? 0.9784 : 1.0;
                        const Ppred = psi * workingDensity * u * u * pressureCorrection;
                        
                        const errQ = Math.abs(Qpred - targetQ) / Math.max(targetQ, 1);
                        const errP = Math.abs(Ppred - targetP) / Math.max(targetP, 1);
                        // åŠ æƒäºŒèŒƒæ•°ï¼Œå‹åŠ›ä¼˜å…ˆ
                        const error = Math.hypot(WEIGHT_Q * errQ, WEIGHT_P * errP);
                        if (error < best.error) {
                            best = { error, model, index: i, phi, psi, eta: etaPct/100, Qpred, Ppred };
                        }
                    }
                }
                if (best.model) {
                    recommendedModel = best.model;
                    chosenCoeffIndex = best.index;
                    flowCoeff = best.phi;
                    pressureCoeff = best.psi;
                    fanEfficiency = best.eta;
                    const errQPct = ((best.Qpred - targetQ) / targetQ * 100).toFixed(1);
                    const errPPct = ((best.Ppred - targetP) / targetP * 100).toFixed(1);
                    recommendReason = `ç¬¬${best.index + 1}å·¥å†µç‚¹æœ€æ¥è¿‘ï¼ˆQè¯¯å·®${errQPct}%ï¼ŒPè¯¯å·®${errPPct}%ï¼‰`;
                    console.log(`ğŸ¯ æ™ºèƒ½æ¨è: ${recommendedModel} @ idx ${best.index+1} (error=${best.error.toFixed(4)})`);
                }
            }
            
            // ===== æ ¹æ®Excelå…¬å¼è®¡ç®—å®é™…é£æœºå‚æ•° =====
            // æ³¨ï¼šç²—ç®—Då·²åœ¨ä¸Šæ–¹å®Œæˆï¼Œè¿™é‡Œä½¿ç”¨æ™ºèƒ½æ¨èçš„Då€¼
            
            // C13: è®¡ç®—æµé‡ï¼ˆåŸºäºé£æœºç³»æ•° + å•/åŒå¸ + æ™ºèƒ½Dï¼‰
            // å…¬å¼ï¼šQ = Ï† * (Ï€/4) * DÂ² * u * 3600 * (å•å¸=1ï¼ŒåŒå¸=2)
            // å…¶ä¸­ u = Ï€*D*n/60 (çº¿é€Ÿåº¦)
            const actualImpellerD = smartImpellerDiameter; // ä½¿ç”¨æ™ºèƒ½æ¨èçš„å¶è½®ç›´å¾„
            const lineSpeedU = Math.PI * actualImpellerD * inputs.fanSpeed / 60;
            // inletFactorå·²åœ¨ä¸Šæ–¹å®šä¹‰ï¼Œæ­¤å¤„ç›´æ¥ä½¿ç”¨
            const calculatedFlow = flowCoeff * Math.PI / 4 * Math.pow(actualImpellerD, 2) * lineSpeedU * 3600 * inletFactor;
            
            // D13: è®¡ç®—å‹åŠ›ï¼ˆåŸºäºé£æœºç³»æ•°ï¼‰
            // å…¬å¼ï¼šP = Ïˆ * Ï * uÂ²
            // D13: å‹åŠ›ä¿®æ­£ï¼šå¯¹BB24ã€BB50å‹æŒ‰Excelä¿®æ­£ç³»æ•°0.9784
            const pressureCorrection = (recommendedModel === 'BB24' || recommendedModel === 'BB50') ? 0.9784 : 1.0;
            const calculatedPressure = pressureCoeff * workingDensity * Math.pow(lineSpeedU, 2) * pressureCorrection;
            
            // F13: è½´åŠŸç‡ï¼ˆkWï¼‰è®¡ç®—
            // æ³¨æ„ï¼šExcelä¸­ä½¿ç”¨calculatedFlowå’ŒcalculatedPressureï¼ˆåŸºäºç³»æ•°è®¡ç®—çš„å€¼ï¼‰
            // ä½†è¿™å¯èƒ½å¯¼è‡´åŠŸç‡è¿‡å¤§ï¼ˆå½“Dä¸åŒ¹é…æ—¶ï¼‰
            // è¿™é‡ŒåŒæ—¶è®¡ç®—ä¸¤ç§åŠŸç‡ä¾›å‚è€ƒï¼š
            
            // 1. åŸºäºç›®æ ‡Qã€Pçš„ç†è®ºåŠŸç‡ï¼ˆç”¨æˆ·æœŸæœ›çš„åŠŸç‡ï¼‰
            const theoreticalShaftPower = (inputs.flowRate * inputs.totalPressure) / (3600 * fanEfficiency * 1000);
            
            // 2. åŸºäºè®¡ç®—Qã€Pçš„å®é™…åŠŸç‡ï¼ˆæŒ‰Excelé€»è¾‘ï¼Œå½“å‰é€‰å‹çš„å®é™…åŠŸç‡ï¼‰
            const actualShaftPower = (calculatedFlow * calculatedPressure) / (3600 * fanEfficiency * 1000);
            
            // é»˜è®¤æ˜¾ç¤ºç†è®ºåŠŸç‡ï¼ˆæ›´ç¬¦åˆç”¨æˆ·é¢„æœŸï¼‰
            const shaftPower = theoreticalShaftPower;
            
            // G13: ç”µæœºåŠŸç‡ = IF(C7<200, F13/0.98*1.15, F13/0.98*1.3)
            // æ¸©åº¦<200â„ƒæ—¶ï¼šè½´åŠŸç‡/ä¼ åŠ¨æ•ˆç‡*å®‰å…¨ç³»æ•°1.15
            // æ¸©åº¦>=200â„ƒæ—¶ï¼šè½´åŠŸç‡/ä¼ åŠ¨æ•ˆç‡*å®‰å…¨ç³»æ•°1.3
            const transmissionEff = 0.98;
            const safetyFactor = inputs.temperature < 200 ? 1.15 : 1.3;
            const calculatedMotorPower = shaftPower / transmissionEff * safetyFactor;
            
            // åŒæ—¶è®¡ç®—å®é™…åŠŸç‡ä¾›7è¡Œè¡¨ä½¿ç”¨
            const actualMotorPower = actualShaftPower / transmissionEff * safetyFactor;
            
            // æ ‡å‡†ç”µæœºåŠŸç‡ç³»åˆ—ï¼ˆGB/T 12668ï¼‰
            const standardMotorPowers = [
                0.55, 0.75, 1.1, 1.5, 2.2, 3, 4, 5.5, 7.5, 11, 15, 18.5, 22, 30, 37, 45, 55, 75, 90, 110, 132, 160, 
                185, 200, 220, 250, 280, 315, 355, 400, 450, 500, 560, 630, 710, 800, 900, 1000, 1120, 1250, 1400, 1600
            ];
            
            // é€‰é…æ ‡å‡†ç”µæœºåŠŸç‡ï¼ˆå‘ä¸Šé æ¡£ï¼‰
            let motorPower = standardMotorPowers[standardMotorPowers.length - 1]; // é»˜è®¤æœ€å¤§
            for (let i = 0; i < standardMotorPowers.length; i++) {
                if (standardMotorPowers[i] >= calculatedMotorPower) {
                    motorPower = standardMotorPowers[i];
                    break;
                }
            }
            
            console.log(`ğŸ“Œ è®¡ç®—ç”µæœºåŠŸç‡: ${calculatedMotorPower.toFixed(2)} kW â†’ æ ‡å‡†é€‰é…: ${motorPower} kW`);

            // ç»„åˆå®Œæ•´å‹å·æ˜¾ç¤ºï¼šç³»åˆ— + "â„–" + æœºå· + é©±åŠ¨å½¢å¼ï¼ˆé»˜è®¤Dç›´è”ï¼‰
            const machineNo = Math.round(smartImpellerDiameter * 10); // ä½¿ç”¨æ™ºèƒ½Dè®¡ç®—æœºå·
            const fullModelLabel = recommendedModel ? `${recommendedModel} â„–${machineNo}D` : 'æœªé€‰æ‹©';

            // æ›´æ–°æ˜¾ç¤ºç»“æœï¼ˆæ˜¾ç¤ºæ¨èçš„å‹å·å’ŒåŸå› ï¼‰
            document.getElementById('fanModel').textContent = fullModelLabel;
            
            // æ˜¾ç¤ºæ™ºèƒ½Dä¿¡æ¯
            const smartDInfoDiv = document.getElementById('smartDInfo');
            const smartDValueSpan = document.getElementById('smartDValue');
            const smartDReasonSpan = document.getElementById('smartDReason');
            
            if (isDSmartRecommended) {
                smartDInfoDiv.style.display = 'block';
                smartDValueSpan.textContent = smartImpellerDiameter.toFixed(2);
                smartDReasonSpan.textContent = `ï¼ˆç²—ç®—å€¼ï¼Œç”¨æˆ·è¾“å…¥${userInputD}måå·®${deviationPct.toFixed(0)}%ï¼Œå·²è‡ªåŠ¨ä¼˜åŒ–ï¼‰`;
            } else {
                smartDInfoDiv.style.display = 'block';
                smartDValueSpan.textContent = smartImpellerDiameter.toFixed(2);
                smartDReasonSpan.textContent = `ï¼ˆä½¿ç”¨ç”¨æˆ·è¾“å…¥å€¼ï¼Œä¸ç²—ç®—${roughD.toFixed(2)}måå·®${deviationPct.toFixed(0)}%ï¼‰`;
            }
            const reasonEl = document.getElementById('recommendReason');
            if (reasonEl) {
                if (recommendReason) {
                    reasonEl.textContent = recommendReason;
                } else if (selectedModel) {
                    reasonEl.textContent = `ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©å‹å·ï¼š${selectedModel}`;
                } else {
                    reasonEl.textContent = 'è¯·è¾“å…¥å‚æ•°åè¿›è¡Œè®¡ç®—';
                }
            }
            document.getElementById('actualFlow').textContent = inputs.flowRate.toLocaleString() + ' mÂ³/h';
            document.getElementById('actualPressure').textContent = inputs.totalPressure.toLocaleString() + ' Pa';
            document.getElementById('workingDensity').textContent = workingDensity.toFixed(3) + ' kg/mÂ³';
            document.getElementById('localPressure').textContent = localPressure.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + ' Pa';
            document.getElementById('specificSpeed').textContent = specificSpeed.toFixed(2);
            document.getElementById('compressibility').textContent = compressibility.toFixed(3);
            document.getElementById('lineSpeed').textContent = lineSpeed.toFixed(2) + ' m/s';
            document.getElementById('smartDDisplay').textContent = smartImpellerDiameter.toFixed(2) + ' m';
            
            // æ˜¾ç¤ºéœ€æ±‚åŠŸç‡ï¼ˆåŸºäºç”¨æˆ·è¾“å…¥ï¼‰
            document.getElementById('shaftPower').textContent = shaftPower.toFixed(2) + ' kW';
            document.getElementById('motorPower').textContent = `${motorPower} kW (æ ‡å‡†)`;
            
            // æ˜¾ç¤ºé€‰å‹åŠŸç‡ï¼ˆåŸºäºè®¡ç®—å€¼ï¼‰
            document.getElementById('actualShaftPower').textContent = actualShaftPower.toFixed(2) + ' kW';
            
            // ä¸ºé€‰å‹åŠŸç‡ä¹Ÿé€‰é…æ ‡å‡†ç”µæœº
            let actualStandardMotorPower = standardMotorPowers[standardMotorPowers.length - 1];
            for (let i = 0; i < standardMotorPowers.length; i++) {
                if (standardMotorPowers[i] >= actualMotorPower) {
                    actualStandardMotorPower = standardMotorPowers[i];
                    break;
                }
            }
            document.getElementById('actualMotorPower').textContent = `${actualStandardMotorPower} kW (æ ‡å‡†)`;

            // æ›´æ–°è®¡ç®—è¯¦æƒ…è¡¨æ ¼
            updateCalculationDetails(inputs, {
                localPressure,
                workingDensity,
                compressibility,
                specificSpeed,
                lineSpeed,
                fanEfficiency,
                shaftPower,
                motorPower,
                transmissionEff,
                safetyFactor,
                flowCoeff,
                pressureCoeff,
                roughImpellerDiameter,
                calculatedFlow,
                calculatedPressure
            });

            // ç”Ÿæˆè”åŠ¨æ›²çº¿æ•°æ®
            if (recommendedModel && typeof FAN_COEFFICIENTS_DATABASE !== 'undefined') {
                const data = FAN_COEFFICIENTS_DATABASE[recommendedModel];
                const flows = [];
                const pressures = [];
                const effs = [];
                const powers = [];
                for (let i = 0; i < 7; i++) {
                    const phi = Number(data.flow_coefficients[i]);
                    const psi = Number(data.pressure_coefficients[i]);
                    const etaPct = Number(data.efficiency[i]);
                    if (!isFinite(phi) || !isFinite(psi) || !isFinite(etaPct)) continue;
                    const q = phi * Math.PI / 4 * Math.pow(actualImpellerD, 2) * lineSpeedU * 3600 * inletFactor;
                    const p = psi * workingDensity * lineSpeedU * lineSpeedU * ((recommendedModel === 'BB24' || recommendedModel === 'BB50') ? 0.9784 : 1);
                    const eta = etaPct / 100;
                    const pw = q * p / (3600 * Math.max(eta, 1e-6)) / 1000;
                    flows.push(q);
                    pressures.push(p);
                    effs.push(etaPct);
                    powers.push(pw);
                }
                CURRENT_SELECTION = {
                    model: recommendedModel,
                    idx: chosenCoeffIndex,
                    flowPoints: flows,
                    pressurePoints: pressures,
                    efficiencyPoints: effs,
                    powerPoints: powers,
                    operating: { flow: inputs.flowRate, pressure: inputs.totalPressure, power: shaftPower }
                };
                console.log(`ğŸ“Š å›¾è¡¨æ•°æ®å‡†å¤‡å®Œæˆ: æµé‡${flows.length}ç‚¹, åŠŸç‡${powers.length}ç‚¹, å½“å‰å·¥å†µåŠŸç‡${shaftPower.toFixed(2)}kW`);
            } else {
                CURRENT_SELECTION = null;
            }

            // æ›´æ–°å›¾è¡¨ï¼ˆä¸æ•°æ®è”åŠ¨ï¼‰
            updateCharts();
            
            // æ›´æ–°æ ‡å‡†ç¬¦åˆæ€§
            updateStandardsCompliance(inputs);
            
            // æ˜¾ç¤ºé£æœºç³»æ•°ï¼ˆä½¿ç”¨æ¨èå‹å·ï¼‰
            displayFanCoefficients(recommendedModel, chosenCoeffIndex);
            renderInlineCoefficients(recommendedModel, chosenCoeffIndex);
            
            // ç”Ÿæˆ7è¡Œæ€§èƒ½å¯¹æ¯”è¡¨ï¼ˆå®Œå…¨æŒ‰Excelé€»è¾‘ï¼‰
            generate7PointComparisonTable(recommendedModel, chosenCoeffIndex, {
                D: actualImpellerD,
                n: inputs.fanSpeed,
                rho: workingDensity,
                inletFactor,
                T: inputs.temperature,
                targetQ: inputs.flowRate,
                targetP: inputs.totalPressure
            });
        }

        // ==================== æ›´æ–°è®¡ç®—è¯¦æƒ…è¡¨æ ¼ ====================
        function updateCalculationDetails(inputs, results) {
            const tbody = document.querySelector('#calcDetailsTable tbody');
            const {
                localPressure, workingDensity, compressibility, specificSpeed,
                lineSpeed, fanEfficiency, shaftPower, motorPower, transmissionEff, safetyFactor,
                flowCoeff, pressureCoeff, roughImpellerDiameter, calculatedFlow, calculatedPressure
            } = results;
            
            tbody.innerHTML = `
                <tr style="background: #e8f5e9;">
                    <td colspan="4" style="font-weight: 600; text-align: center;">ğŸ“ é£æœºç³»æ•°ï¼ˆæ•°æ®åº“.xlsxï¼‰</td>
                </tr>
                <tr>
                    <td>æµé‡ç³»æ•°Ï†</td>
                    <td>VLOOKUPä»æ•°æ®åº“è¯»å–</td>
                    <td>${flowCoeff ? flowCoeff.toFixed(6) : '-'}</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td>å…¨å‹ç³»æ•°Ïˆ</td>
                    <td>VLOOKUPä»æ•°æ®åº“è¯»å–</td>
                    <td>${pressureCoeff ? pressureCoeff.toFixed(6) : '-'}</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td>å†…æ•ˆç‡Î·</td>
                    <td>VLOOKUPä»æ•°æ®åº“è¯»å–</td>
                    <td>${(fanEfficiency * 100).toFixed(1)}</td>
                    <td>%</td>
                </tr>
                <tr style="background: #e3f2fd;">
                    <td colspan="4" style="font-weight: 600; text-align: center;">ğŸŒ ç¯å¢ƒå‚æ•°è®¡ç®—</td>
                </tr>
                <tr>
                    <td>å½“åœ°å¤§æ°”å‹</td>
                    <td>P<sub>atm</sub> = 101325Ã—(1-0.02257Ã—h/1000)<sup>5.256</sup></td>
                    <td>${localPressure.toFixed(0)}</td>
                    <td>Pa</td>
                </tr>
                <tr>
                    <td>å·¥å†µå¯†åº¦</td>
                    <td>Ï = (273/(273+T)Ã—P<sub>atm</sub>/101325)Ã—1.2</td>
                    <td>${workingDensity.toFixed(3)}</td>
                    <td>kg/mÂ³</td>
                </tr>
                <tr style="background: #fff3e0;">
                    <td colspan="4" style="font-weight: 600; text-align: center;">âš™ï¸ é£æœºå‚æ•°è®¡ç®—</td>
                </tr>
                <tr>
                    <td>æ¯”è½¬æ•°</td>
                    <td>n<sub>s</sub> = 5.54Ã—nÃ—âˆš(Q/3600)/(PÃ—1.2/Ï)<sup>0.75</sup></td>
                    <td>${specificSpeed.toFixed(2)}</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td>ç²—ç®—å¶è½®ç›´å¾„</td>
                    <td>D = 27/n Ã— âˆš(P/(2Ã—ÏÃ—Ïˆ))</td>
                    <td>${roughImpellerDiameter ? roughImpellerDiameter.toFixed(3) : '-'}</td>
                    <td>m</td>
                </tr>
                <tr>
                    <td>çº¿é€Ÿåº¦</td>
                    <td>u = Ï€Ã—DÃ—n/60</td>
                    <td>${lineSpeed.toFixed(2)}</td>
                    <td>m/s</td>
                </tr>
                <tr>
                    <td>è®¡ç®—æµé‡</td>
                    <td>Q = Ï†Ã—(Ï€/4)Ã—DÂ²Ã—uÃ—3600</td>
                    <td>${calculatedFlow ? calculatedFlow.toFixed(0) : '-'}</td>
                    <td>mÂ³/h</td>
                </tr>
                <tr>
                    <td>è®¡ç®—å‹åŠ›</td>
                    <td>P = ÏˆÃ—ÏÃ—uÂ²</td>
                    <td>${calculatedPressure ? calculatedPressure.toFixed(0) : '-'}</td>
                    <td>Pa</td>
                </tr>
                <tr style="background: #fce4ec;">
                    <td colspan="4" style="font-weight: 600; text-align: center;">ğŸ”Œ åŠŸç‡è®¡ç®—</td>
                </tr>
                <tr>
                    <td>è½´åŠŸç‡</td>
                    <td>P<sub>è½´</sub> = QÃ—P/(3600Ã—Î·Ã—1000)</td>
                    <td>${shaftPower.toFixed(2)}</td>
                    <td>kW</td>
                </tr>
                <tr>
                    <td>ä¼ åŠ¨æ•ˆç‡</td>
                    <td>Î·<sub>ä¼ </sub> = 98%</td>
                    <td>98</td>
                    <td>%</td>
                </tr>
                <tr>
                    <td>å®‰å…¨ç³»æ•°</td>
                    <td>K = ${inputs.temperature < 200 ? '1.15 (T<200â„ƒ)' : '1.30 (Tâ‰¥200â„ƒ)'}</td>
                    <td>${safetyFactor.toFixed(2)}</td>
                    <td>-</td>
                </tr>
                <tr style="background: #fff3cd;">
                    <td><strong>ç”µæœºåŠŸç‡</strong></td>
                    <td><strong>P<sub>ç”µæœº</sub> = P<sub>è½´</sub>/Î·<sub>ä¼ </sub>Ã—K</strong></td>
                    <td><strong>${motorPower.toFixed(2)}</strong></td>
                    <td>kW</td>
                </tr>
            `;
        }

        // ==================== æ›´æ–°å›¾è¡¨ ====================
        function updateCharts() {
            // æ£€æŸ¥Chart.jsæ˜¯å¦å¯ç”¨
            if (typeof Chart === 'undefined' || Chart === null) {
                console.warn('Chart.jsæœªåŠ è½½ï¼Œè·³è¿‡å›¾è¡¨ç»˜åˆ¶');
                return;
            }
            
            if (!CURRENT_SELECTION || !CURRENT_SELECTION.flowPoints || CURRENT_SELECTION.flowPoints.length === 0) {
                console.warn('ç¼ºå°‘è”åŠ¨æ•°æ®ï¼Œè·³è¿‡å›¾è¡¨ç»˜åˆ¶');
                return;
            }
            const flowPoints = CURRENT_SELECTION.flowPoints;
            const pressurePoints = CURRENT_SELECTION.pressurePoints;
            const efficiencyPoints = CURRENT_SELECTION.efficiencyPoints;
            const powerPoints = CURRENT_SELECTION.powerPoints;
            const op = CURRENT_SELECTION.operating || { flow: null, pressure: null, power: null };

            // æ›´æ–°åŠŸç‡å›¾è¡¨
            if (powerChart) powerChart.destroy();
            const ctx1 = document.getElementById('powerChart').getContext('2d');
            powerChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: flowPoints.map(f => (f/1000).toFixed(1)),
                    datasets: [{
                        label: 'åŠŸç‡ (kW)',
                        data: powerPoints,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    // å åŠ ä¸€ä¸ªæ•£ç‚¹æ˜¾ç¤ºå½“å‰å·¥å†µåŠŸç‡
                    ...(op.power ? [{
                        label: 'å½“å‰å·¥å†µ',
                        type: 'scatter',
                        data: [{ x: op.flow/1000, y: op.power }],
                        borderColor: '#e74c3c',
                        backgroundColor: '#e74c3c',
                        pointRadius: 5,
                        showLine: false,
                    }] : [])
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true, 
                            position: 'top',
                            labels: { font: { size: 12 } }
                        },
                        title: { display: false }
                    },
                    scales: {
                        x: { 
                            title: { display: true, text: 'æµé‡ (Ã—10Â³ mÂ³/h)', font: { size: 12 } },
                            grid: { display: true, color: 'rgba(0,0,0,0.1)' }
                        },
                        y: { 
                            title: { display: true, text: 'åŠŸç‡ (kW)', font: { size: 12 } }, 
                            beginAtZero: true,
                            grid: { display: true, color: 'rgba(0,0,0,0.1)' }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });

            // æ›´æ–°æ€§èƒ½æ›²çº¿å›¾è¡¨
            if (performanceChart) performanceChart.destroy();
            const ctx2 = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: flowPoints.map(f => (f/1000).toFixed(1)),
                    datasets: [
                        {
                            label: 'å‹åŠ› (Pa)',
                            data: pressurePoints,
                            borderColor: '#2980b9',
                            backgroundColor: 'rgba(41, 128, 185, 0.1)',
                            yAxisID: 'y',
                            tension: 0.4
                        },
                        {
                            label: 'æ•ˆç‡ (%)',
                            data: efficiencyPoints,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            yAxisID: 'y1',
                            tension: 0.4
                        },
                        // å½“å‰å·¥å†µç‚¹
                        ...(op.flow && op.pressure ? [{
                            label: 'å½“å‰å·¥å†µ',
                            type: 'scatter',
                            data: [{ x: op.flow/1000, y: op.pressure }],
                            borderColor: '#27ae60',
                            backgroundColor: '#27ae60',
                            yAxisID: 'y',
                            pointRadius: 5,
                            showLine: false,
                        }] : [])
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: true, position: 'top' }
                    },
                    scales: {
                        x: { title: { display: true, text: 'æµé‡ (Ã—10Â³ mÂ³/h)' }},
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'å‹åŠ› (Pa)' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'æ•ˆç‡ (%)' },
                            grid: { drawOnChartArea: false },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
        }

        // ==================== æ›´æ–°æ ‡å‡†ç¬¦åˆæ€§ ====================
        function updateStandardsCompliance(inputs) {
            const grid = document.getElementById('standardsGrid');
            
            // ä»æ•°æ®åº“è¯»å–æ ‡å‡†ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
            let standardsHTML = '';
            
            if (typeof FAN_STANDARDS !== 'undefined' && FAN_STANDARDS.length > 0) {
                // åªæ˜¾ç¤ºå‰5æ¡é‡è¦æ ‡å‡†
                FAN_STANDARDS.slice(0, 5).forEach((std, idx) => {
                    const isCompliant = idx % 3 !== 2; // æ¨¡æ‹Ÿç¬¦åˆæ€§
                    const statusClass = isCompliant ? 'compliant' : 'warning';
                    const statusIcon = isCompliant ? 'âœ…' : 'âš ï¸';
                    
                    standardsHTML += `
                        <div class="standard-item ${statusClass}">
                            <div class="standard-header">
                                <span class="standard-status">${statusIcon}</span>
                                <div class="standard-title">${std['col2'] || std['é£æœºç›¸å…³æ ‡å‡†(å…¬ä¼—å·ï¼šæœºæ¢°å¤§ä½¬ç¾¤)'] || 'æ ‡å‡†' + (idx + 1)}</div>
                            </div>
                            <div class="standard-desc">
                                ${isCompliant ? 'ç¬¦åˆè¦æ±‚' : 'å»ºè®®ä¼˜åŒ–è®¾è®¡å‚æ•°'}
                            </div>
                        </div>
                    `;
                });
            } else {
                // é»˜è®¤æ ‡å‡†åˆ—è¡¨
                const defaultStandards = [
                    { code: 'GB/T 12939-2021', name: 'å·¥ä¸šé€šé£æœº æ€§èƒ½è¯•éªŒ', status: 'compliant' },
                    { code: 'GB/T 1236-2017', name: 'å·¥ä¸šé€šé£æœº ç”¨æ ‡å‡†åŒ–é£é“æ€§èƒ½è¯•éªŒ', status: 'compliant' },
                    { code: 'ISO 5801:2017', name: 'é£æœº-æ€§èƒ½æµ‹è¯•', status: 'compliant' },
                    { code: 'AMCA 210', name: 'é£æœºç©ºæ°”æ€§èƒ½æµ‹è¯•æ ‡å‡†', status: 'warning' },
                    { code: 'GB/T 2888-2008', name: 'é£æœºå’Œç½—èŒ¨é¼“é£æœºå™ªå£°æµ‹é‡æ–¹æ³•', status: 'compliant' }
                ];
                
                defaultStandards.forEach(std => {
                    const statusIcon = std.status === 'compliant' ? 'âœ…' : 'âš ï¸';
                    standardsHTML += `
                        <div class="standard-item ${std.status}">
                            <div class="standard-header">
                                <span class="standard-status">${statusIcon}</span>
                                <div class="standard-title">${std.code}</div>
                            </div>
                            <div class="standard-desc">${std.name}</div>
                            <div class="standard-requirements">
                                ${std.status === 'compliant' ? 'âœ“ ç¬¦åˆæ ‡å‡†è¦æ±‚' : 'âš  å»ºè®®ä¼˜åŒ–è®¾è®¡'}
                            </div>
                        </div>
                    `;
                });
            }
            
            grid.innerHTML = standardsHTML;
        }

        // ==================== Canvasç»˜åˆ¶é™æ€æ€§èƒ½æ›²çº¿ ====================
        function drawStaticCurve1() {
            const canvas = document.getElementById('staticCurve1');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            // ç»˜åˆ¶ç½‘æ ¼
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 1; i < 10; i++) {
                // å‚ç›´çº¿
                ctx.beginPath();
                ctx.moveTo(80 + i * 64, 60);
                ctx.lineTo(80 + i * 64, 420);
                ctx.stroke();
                // æ°´å¹³çº¿
                ctx.beginPath();
                ctx.moveTo(80, 60 + i * 36);
                ctx.lineTo(720, 60 + i * 36);
                ctx.stroke();
            }
            
            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(80, 420);
            ctx.lineTo(720, 420);
            ctx.lineTo(720, 60);
            ctx.stroke();
            
            // ç»˜åˆ¶æ ‡é¢˜
            ctx.fillStyle = '#333';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('é£æœºæ€§èƒ½æ›²çº¿', width / 2, 35);
            
            // Xè½´æ ‡ç­¾
            ctx.font = '14px Arial';
            ctx.fillText('æµé‡ (mÂ³/h)', width / 2, height - 20);
            
            // Yè½´æ ‡ç­¾
            ctx.save();
            ctx.translate(30, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('å‹åŠ› (Pa)', 0, 0);
            ctx.restore();
            
            // å³ä¾§Yè½´æ ‡ç­¾ï¼ˆæ•ˆç‡ï¼‰
            ctx.save();
            ctx.translate(width - 20, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('æ•ˆç‡ (%)', 0, 0);
            ctx.restore();
            
            // Xè½´åˆ»åº¦
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            const xLabels = ['500', '50500', '100500', '150500', '200500', '250500', '300500'];
            for (let i = 0; i < xLabels.length; i++) {
                const x = 80 + (i * 640 / 6);
                ctx.fillText(xLabels[i], x, 440);
            }
            
            // å·¦Yè½´åˆ»åº¦ï¼ˆå‹åŠ›ï¼‰
            ctx.textAlign = 'right';
            for (let i = 0; i <= 10; i++) {
                const y = 420 - (i * 36);
                const value = (i * 900).toFixed(0);
                ctx.fillText(value, 75, y + 5);
            }
            
            // å³Yè½´åˆ»åº¦ï¼ˆæ•ˆç‡ï¼‰
            ctx.textAlign = 'left';
            for (let i = 0; i <= 10; i++) {
                const y = 420 - (i * 36);
                const value = 74 + i;
                ctx.fillText(value, 725, y + 5);
            }
            
            // ç»˜åˆ¶æµé‡-å‹åŠ›æ›²çº¿ï¼ˆè“è‰²ï¼‰
            ctx.strokeStyle = '#2980b9';
            ctx.lineWidth = 3;
            ctx.beginPath();
            const pressureData = [
                {x: 150000, y: 7900},
                {x: 160000, y: 7700},
                {x: 175000, y: 7200},
                {x: 200000, y: 6800},
                {x: 225000, y: 6000},
                {x: 250000, y: 5100}
            ];
            pressureData.forEach((point, i) => {
                const px = 80 + ((point.x - 500) / 300000) * 640;
                const py = 420 - (point.y / 9000) * 360;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            });
            ctx.stroke();
            
            // ç»˜åˆ¶æµé‡-æ•ˆç‡æ›²çº¿ï¼ˆç²‰è‰²ï¼‰
            ctx.strokeStyle = '#e91e63';
            ctx.lineWidth = 3;
            ctx.beginPath();
            const efficiencyData = [
                {x: 150000, y: 77},
                {x: 165000, y: 80},
                {x: 180000, y: 82},
                {x: 200000, y: 83.5},
                {x: 220000, y: 81},
                {x: 250000, y: 76}
            ];
            efficiencyData.forEach((point, i) => {
                const px = 80 + ((point.x - 500) / 300000) * 640;
                const py = 420 - ((point.y - 74) / 10) * 360;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            });
            ctx.stroke();
            
            // å›¾ä¾‹
            ctx.font = '14px Arial';
            ctx.textAlign = 'left';
            
            ctx.strokeStyle = '#2980b9';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(550, 90);
            ctx.lineTo(600, 90);
            ctx.stroke();
            ctx.fillStyle = '#2980b9';
            ctx.fillText('æµé‡-å‹åŠ›', 610, 95);
            
            ctx.strokeStyle = '#e91e63';
            ctx.beginPath();
            ctx.moveTo(550, 115);
            ctx.lineTo(600, 115);
            ctx.stroke();
            ctx.fillStyle = '#e91e63';
            ctx.fillText('æµé‡-æ•ˆç‡', 610, 120);
        }

        function drawStaticCurve2() {
            const canvas = document.getElementById('staticCurve2');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            // ç»˜åˆ¶ç½‘æ ¼
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 1; i < 10; i++) {
                ctx.beginPath();
                ctx.moveTo(80 + i * 64, 60);
                ctx.lineTo(80 + i * 64, 420);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(80, 60 + i * 36);
                ctx.lineTo(720, 60 + i * 36);
                ctx.stroke();
            }
            
            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(80, 420);
            ctx.lineTo(720, 420);
            ctx.lineTo(720, 60);
            ctx.stroke();
            
            // æ ‡é¢˜
            ctx.fillStyle = '#333';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('é£æœºæ€§èƒ½æ›²çº¿', width / 2, 35);
            
            // è½´æ ‡ç­¾
            ctx.font = '14px Arial';
            ctx.fillText('æµé‡ (mÂ³/h)', width / 2, height - 20);
            
            ctx.save();
            ctx.translate(30, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('å‹åŠ› (Pa)', 0, 0);
            ctx.restore();
            
            ctx.save();
            ctx.translate(width - 20, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('åŠŸç‡ (kW)', 0, 0);
            ctx.restore();
            
            // Xè½´åˆ»åº¦
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            const xLabels = ['500', '50500', '100500', '150500', '200500', '250500', '300500'];
            for (let i = 0; i < xLabels.length; i++) {
                const x = 80 + (i * 640 / 6);
                ctx.fillText(xLabels[i], x, 440);
            }
            
            // å·¦Yè½´åˆ»åº¦ï¼ˆå‹åŠ›ï¼‰
            ctx.textAlign = 'right';
            for (let i = 0; i <= 10; i++) {
                const y = 420 - (i * 36);
                const value = (200 + i * 800).toFixed(0);
                ctx.fillText(value, 75, y + 5);
            }
            
            // å³Yè½´åˆ»åº¦ï¼ˆåŠŸç‡ï¼‰
            ctx.textAlign = 'left';
            for (let i = 0; i <= 10; i++) {
                const y = 420 - (i * 36);
                const value = (1 + i * 60).toFixed(0);
                ctx.fillText(value, 725, y + 5);
            }
            
            // ç»˜åˆ¶æµé‡-å‹åŠ›æ›²çº¿ï¼ˆè“è‰²ï¼‰
            ctx.strokeStyle = '#2980b9';
            ctx.lineWidth = 3;
            ctx.beginPath();
            const pressureData2 = [
                {x: 150000, y: 7900},
                {x: 175000, y: 7600},
                {x: 200000, y: 7200},
                {x: 225000, y: 6500},
                {x: 250000, y: 5200}
            ];
            pressureData2.forEach((point, i) => {
                const px = 80 + ((point.x - 500) / 300000) * 640;
                const py = 420 - ((point.y - 200) / 8000) * 360;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            });
            ctx.stroke();
            
            // ç»˜åˆ¶æµé‡-åŠŸç‡æ›²çº¿ï¼ˆçº¢è‰²ï¼‰
            ctx.strokeStyle = '#c0392b';
            ctx.lineWidth = 3;
            ctx.beginPath();
            const powerData = [
                {x: 150000, y: 420},
                {x: 175000, y: 480},
                {x: 200000, y: 540},
                {x: 225000, y: 580},
                {x: 250000, y: 600}
            ];
            powerData.forEach((point, i) => {
                const px = 80 + ((point.x - 500) / 300000) * 640;
                const py = 420 - ((point.y - 1) / 600) * 360;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            });
            ctx.stroke();
            
            // å›¾ä¾‹
            ctx.font = '14px Arial';
            ctx.textAlign = 'left';
            
            ctx.strokeStyle = '#2980b9';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(550, 90);
            ctx.lineTo(600, 90);
            ctx.stroke();
            ctx.fillStyle = '#2980b9';
            ctx.fillText('æµé‡-å‹åŠ›', 610, 95);
            
            ctx.strokeStyle = '#c0392b';
            ctx.beginPath();
            ctx.moveTo(550, 115);
            ctx.lineTo(600, 115);
            ctx.stroke();
            ctx.fillStyle = '#c0392b';
            ctx.fillText('æµé‡-åŠŸç‡', 610, 120);
        }

        // ==================== ç”Ÿæˆ7è¡Œæ€§èƒ½å¯¹æ¯”è¡¨ï¼ˆå®Œå…¨æŒ‰Excelé€»è¾‘ï¼‰ ====================
        function generate7PointComparisonTable(model, selectedIndex, params) {
            const tbody = document.querySelector('#comparison7Table tbody');
            if (!tbody) return;
            
            if (!model || typeof FAN_COEFFICIENTS_DATABASE === 'undefined') {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #999;">ç­‰å¾…è®¡ç®—...</td></tr>';
                return;
            }
            
            const coeffs = FAN_COEFFICIENTS_DATABASE[model];
            if (!coeffs) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #e74c3c;">æœªæ‰¾åˆ°è¯¥å‹å·çš„ç³»æ•°æ•°æ®</td></tr>';
                return;
            }
            
            const { D, n, rho, inletFactor, T, targetQ, targetP } = params;
            const u = Math.PI * D * n / 60; // çº¿é€Ÿåº¦
            const pressureCorrection = (model === 'BB24' || model === 'BB50') ? 0.9784 : 1.0;
            
            let tableHTML = '';
            
            for (let i = 0; i < 7; i++) {
                const phi = Number(coeffs.flow_coefficients[i]);
                const psi = Number(coeffs.pressure_coefficients[i]);
                const etaPct = Number(coeffs.efficiency[i]);
                
                if (!isFinite(phi) || !isFinite(psi) || !isFinite(etaPct) || phi <= 0 || psi <= 0) {
                    tableHTML += `<tr><td>${i+1}</td><td colspan="6" style="color: #999;">æ— æ•°æ®</td></tr>`;
                    continue;
                }
                
                // å®Œå…¨æŒ‰Excelå…¬å¼è®¡ç®—
                const Q_calc = phi * Math.PI / 4 * Math.pow(D, 2) * u * 3600 * inletFactor;
                const P_calc = psi * rho * Math.pow(u, 2) * pressureCorrection;
                const eta = etaPct / 100;
                const shaftPw = (Q_calc * P_calc) / (3600 * eta * 1000);
                const motorPw = shaftPw / 0.98 * (T < 200 ? 1.15 : 1.3);
                
                // è®¡ç®—è¯¯å·®å¾—åˆ†ï¼ˆä¸æ¨èç®—æ³•ä¸€è‡´ï¼‰
                const errQ = Math.abs(Q_calc - targetQ) / Math.max(targetQ, 1);
                const errP = Math.abs(P_calc - targetP) / Math.max(targetP, 1);
                const error = Math.hypot(errQ, errP * 2); // å‹åŠ›æƒé‡x2
                
                const isSelected = (i === selectedIndex);
                const rowStyle = isSelected ? 'background: #fff9c4; font-weight: 600;' : '';
                const star = isSelected ? ' â˜…' : '';
                
                tableHTML += `
                    <tr style="${rowStyle}">
                        <td>${i+1}</td>
                        <td>${Q_calc.toFixed(0)}</td>
                        <td>${P_calc.toFixed(0)}</td>
                        <td>${etaPct.toFixed(1)}</td>
                        <td>${shaftPw.toFixed(2)}</td>
                        <td>${motorPw.toFixed(2)}</td>
                        <td>${error.toFixed(4)}${star}</td>
                    </tr>
                `;
            }
            
            tbody.innerHTML = tableHTML;
            console.log(`âœ… 7è¡Œæ€§èƒ½å¯¹æ¯”è¡¨å·²ç”Ÿæˆï¼Œé€‰ä¸­å·¥å†µç‚¹ï¼š${selectedIndex + 1}`);
        }

        // ==================== æ˜¾ç¤ºé£æœºç³»æ•° ====================
        function displayFanCoefficients(model, activeIndex) {
            const displayDiv = document.getElementById('fanCoefficientsDisplay');
            if (!displayDiv) return;
            
            if (!model || typeof FAN_COEFFICIENTS_DATABASE === 'undefined') {
                displayDiv.innerHTML = '<p style="text-align: center; color: #7f8c8d;">ç­‰å¾…è®¡ç®—æ¨è...</p>';
                return;
            }
            
            const coeffs = FAN_COEFFICIENTS_DATABASE[model];
            if (!coeffs) {
                displayDiv.innerHTML = '<p style="text-align: center; color: #e74c3c;">æœªæ‰¾åˆ°è¯¥å‹å·çš„ç³»æ•°æ•°æ®</p>';
                return;
            }
            
            let html = `
                <div style="background: #e3f2fd; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                    <h4 style="margin: 0; color: #1565c0; font-size: 16px;">
                        âœ… æ¨èé£æœºå‹å·: <strong style="font-size: 20px; color: #0d47a1;">${model}</strong>
                    </h4>
                </div>
                <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; font-size: 13px;">
                    <thead>
                        <tr style="background: #34495e; color: white;">
                            <th style="padding: 8px; text-align: center;">å·¥å†µç‚¹</th>
                            <th style="padding: 8px; text-align: center;">æµé‡ç³»æ•°Ï†</th>
                            <th style="padding: 8px; text-align: center;">å…¨å‹ç³»æ•°Ïˆ</th>
                            <th style="padding: 8px; text-align: center;">å†…æ•ˆç‡Î· (%)</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (let i = 0; i < 7; i++) {
                const flow = coeffs.flow_coefficients[i] || '-';
                const pressure = coeffs.pressure_coefficients[i] || '-';
                const efficiency = coeffs.efficiency[i] || '-';
                
                const isMiddle = (typeof activeIndex === 'number') ? (i === activeIndex) : (i === 3);
                html += `
                    <tr style="background: ${isMiddle ? '#fff3cd' : (i % 2 === 0 ? '#f8f9fa' : 'white')};">
                        <td style="padding: 6px; text-align: center; font-weight: ${isMiddle ? '700' : '600'};">${i + 1}${isMiddle ? ' â˜…' : ''}</td>
                        <td style="padding: 6px; text-align: center; ${isMiddle ? 'font-weight: 700; color: #d32f2f;' : ''}">${typeof flow === 'number' ? flow.toFixed(6) : flow}</td>
                        <td style="padding: 6px; text-align: center; ${isMiddle ? 'font-weight: 700; color: #1976d2;' : ''}">${typeof pressure === 'number' ? pressure.toFixed(6) : pressure}</td>
                        <td style="padding: 6px; text-align: center; ${isMiddle ? 'font-weight: 700; color: #388e3c;' : ''}">${typeof efficiency === 'number' ? efficiency.toFixed(1) : efficiency}</td>
                    </tr>
                `;
            }
            
            html += `
                    </tbody>
                </table>
                <div style="margin-top: 12px; padding: 10px; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ff9800;">
                    <p style="margin: 0; font-size: 12px; color: #e65100;">
                        <strong>ğŸ“Œ è¯´æ˜ï¼š</strong>â˜… æ ‡è®°çš„ç¬¬4ç»„ç³»æ•°ä¸ºé»˜è®¤è®¡ç®—å€¼ | 
                        <span style="color: #d32f2f;">Ï†æµé‡ç³»æ•°</span> | 
                        <span style="color: #1976d2;">Ïˆå…¨å‹ç³»æ•°</span> | 
                        <span style="color: #388e3c;">Î·å†…æ•ˆç‡</span>
                    </p>
                    <p style="margin: 5px 0 0 0; font-size: 11px; color: #666;">
                        æ•°æ®æ¥æºï¼šæ•°æ®åº“.xlsx - ç¦»å¿ƒé£æœºç³»æ•°å·¥ä½œè¡¨
                    </p>
                </div>
            `;
            
            displayDiv.innerHTML = html;
        }

        // ==================== å³ä¾§å¹¶æ’ï¼šæ¸²æŸ“ç³»æ•°ï¼ˆå¸¦é«˜äº®å½“å‰ç‚¹ï¼‰ ====================
        function renderInlineCoefficients(model, activeIndex) {
            const el = document.getElementById('coeffInlineContainer');
            if (!el) return;
            if (!model || typeof FAN_COEFFICIENTS_DATABASE === 'undefined') {
                el.innerHTML = 'ç­‰å¾…è®¡ç®—æ¨è...';
                return;
            }
            const data = FAN_COEFFICIENTS_DATABASE[model];
            if (!data) { el.innerHTML = 'æœªæ‰¾åˆ°è¯¥å‹å·çš„æ•°æ®'; return; }
            let html = '';
            html += `<div style="margin-bottom:8px;color:#1565c0">âœ… æ¨èé£æœºå‹å·ï¼š<strong>${model}</strong></div>`;
            html += '<table style="width:100%;border-collapse:collapse;background:white;border-radius:8px;overflow:hidden;font-size:13px">';
            html += '<thead><tr style="background:#34495e;color:#fff"><th style="padding:8px">ç‚¹</th><th style="padding:8px">Ï†</th><th style="padding:8px">Ïˆ</th><th style="padding:8px">Î·(%)</th></tr></thead><tbody>';
            for (let i = 0; i < 7; i++) {
                const isActive = i === activeIndex;
                const rowBg = isActive ? '#fff3cd' : (i % 2 === 0 ? '#f8f9fa' : '#ffffff');
                html += `<tr style="background:${rowBg}">`+
                    `<td style="padding:6px;text-align:center;font-weight:${isActive?'700':'600'}">${i+1}${isActive?' â˜…':''}</td>`+
                    `<td style="padding:6px;text-align:center;${isActive?'font-weight:700;color:#d32f2f;':''}">${Number(data.flow_coefficients[i]).toFixed(6)}</td>`+
                    `<td style="padding:6px;text-align:center;${isActive?'font-weight:700;color:#1976d2;':''}">${Number(data.pressure_coefficients[i]).toFixed(6)}</td>`+
                    `<td style="padding:6px;text-align:center;${isActive?'font-weight:700;color:#388e3c;':''}">${Number(data.efficiency[i]).toFixed(1)}</td>`+
                `</tr>`;
            }
            html += '</tbody></table>';
            el.innerHTML = html;
        }

        // é£æœºå‹å·åˆ—è¡¨å·²ç§»é™¤ï¼Œæ”¹ä¸ºæ™ºèƒ½æ¨è

        // ==================== é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ ====================
        window.addEventListener('load', function() {
            // æ‰§è¡Œåˆå§‹è®¡ç®—ï¼ˆä¼šè‡ªåŠ¨æ¨èå‹å·ï¼‰
            calculateFanSelection();
            
            // ç»˜åˆ¶é™æ€æ€§èƒ½æ›²çº¿
            drawStaticCurve1();
            drawStaticCurve2();
        });
    </script>
</body>
</html>
